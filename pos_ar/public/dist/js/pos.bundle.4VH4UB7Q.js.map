{
  "version": 3,
  "sources": ["../../../../../apps/pos_ar/pos_ar/pos_ar/page/myaccessories/AccessoriesController.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pricing/PricingController.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pricing/remote/fetcher.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/posController.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_item_selector.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_customer_box.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_selected_item_cart.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_item_details.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_payment_cart.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_history.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_db.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_settings.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_check_in_out.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_debt_cart.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/pos_unsynced_cart.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/data/posSettingsData.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/data/posAppData.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/remoteApi/FetchHandler.js", "../../../../../apps/pos_ar/pos_ar/pos_ar/page/pos/manager/ScreenManager.js"],
  "sourcesContent": ["frappe.provide(\"pos_ar.myaccessories\");\n\npos_ar.myaccessories.AccessoriesController = class {\n    constructor(wrapper) {\n        this.wrapper = $(wrapper).find(\".layout-main-section\");\n        this.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/accessories_page/main.css\">');\n        this.selectedCompany = frappe.defaults.get_user_default('company');\n        this.selectedPOSOpening = '';\n        this.selectedBrand = '';\n        this.brandList = [];\n        this.make();\n    }\n\n    make() {\n        this.createLayout();\n    }\n\n    createLayout() {\n        // Create the main container\n        const container = $('<div class=\"accessories-container\">').appendTo(this.wrapper);\n\n        // Create top bar with modern design\n        const topBar = $('<div class=\"top-bar shadow\">').appendTo(container);\n        \n        // Left side of top bar with logo and title\n        const leftSection = $('<div class=\"top-bar-left\">').appendTo(topBar);\n        $('<div class=\"page-icon\"><i class=\"fa fa-box-open fa-lg\"></i></div>').appendTo(leftSection);\n        $('<h2>').text('Accessories').appendTo(leftSection);\n\n        // Center section with filters\n        const centerSection = $('<div class=\"top-bar-center\">').appendTo(topBar);\n        \n        // Create filter container with modern design\n        const filterContainer = $('<div class=\"filter-container\">').appendTo(centerSection);\n        \n        // Add company filter\n        const companyWrapper = $('<div class=\"filter-group\">').appendTo(filterContainer);\n        this.companySelect = $('<select>')\n            .addClass('form-control')\n            .change(() => {\n                this.selectedCompany = this.companySelect.val();\n                this.loadPOSOpenings();\n                this.loadItems(container.find('.items-container'));\n            })\n            .appendTo(companyWrapper);\n\n        // Add POS Opening Entry filter\n        const posOpeningWrapper = $('<div class=\"filter-group\">').appendTo(filterContainer);\n        this.posOpeningSelect = $('<select>')\n            .addClass('form-control')\n            .change(() => {\n                this.selectedPOSOpening = this.posOpeningSelect.val();\n                this.loadItems(container.find('.items-container'));\n            })\n            .appendTo(posOpeningWrapper);\n\n        // Add Brand filter with autocomplete\n        const brandWrapper = $('<div class=\"filter-group\">').appendTo(filterContainer);\n        const brandInputWrapper = $('<div class=\"brand-input-wrapper\">').appendTo(brandWrapper);\n        \n        // Create the brand input using Frappe's Link field\n        this.brandField = frappe.ui.form.make_control({\n            parent: brandInputWrapper,\n            df: {\n                fieldtype: 'Link',\n                options: 'Brand',\n                placeholder: 'Type to search brands...',\n                only_select: false,\n                filter_fields: ['name'],\n                get_query: () => {\n                    return {\n                        filters: {}\n                    };\n                }\n            },\n            render_input: true\n        });\n        \n        this.brandField.refresh();\n        \n        // Style the input\n        this.brandField.$input\n            .addClass('brand-filter-input')\n            .removeClass('input-with-feedback');\n\n        // Add clear button\n        const clearBtn = $('<button>')\n            .addClass('clear-brand-btn')\n            .html('<i class=\"fa fa-times\"></i>')\n            .click(() => {\n                this.brandField.set_value('');\n                this.selectedBrand = '';\n                this.loadItems(container.find('.items-container'));\n            })\n            .appendTo(brandInputWrapper);\n\n        // Handle brand selection\n        this.brandField.$input.on('change', () => {\n            const newValue = this.brandField.get_value();\n            if (this.selectedBrand !== newValue) {\n                this.selectedBrand = newValue;\n                console.log(\"Brand changed to:\", this.selectedBrand);\n                // Add a small delay to ensure the value is properly set\n                setTimeout(() => {\n                    this.loadItems(container.find('.items-container'));\n                }, 100);\n            }\n        });\n\n        // Also handle the awesomplete-selectcomplete event\n        this.brandField.$input.on('awesomplete-selectcomplete', () => {\n            const newValue = this.brandField.get_value();\n            if (this.selectedBrand !== newValue) {\n                this.selectedBrand = newValue;\n                console.log(\"Brand selected from dropdown:\", this.selectedBrand);\n                this.loadItems(container.find('.items-container'));\n            }\n        });\n\n        // Load companies\n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Company',\n                fields: ['name'],\n                limit: 0\n            },\n            callback: (response) => {\n                if (response.message) {\n                    this.companySelect.empty();\n                    response.message.forEach(company => {\n                        this.companySelect.append(\n                            $('<option></option>')\n                                .val(company.name)\n                                .text(company.name)\n                        );\n                    });\n                    this.companySelect.val(this.selectedCompany);\n                    this.loadPOSOpenings();\n                }\n            }\n        });\n\n        // Right side of top bar with export button\n        const rightSection = $('<div class=\"top-bar-right\">').appendTo(topBar);\n        $('<button class=\"btn btn-primary btn-export\">')\n            .html('<i class=\"fa fa-download mr-2\"></i>Export')\n            .click(() => this.exportData())\n            .appendTo(rightSection);\n\n        // Create items list container\n        const listContainer = $('<div class=\"items-container\">').appendTo(container);\n        \n        // Add header row\n        const headerRow = $('<div class=\"item-row header\">').html(`\n            <div class=\"item-col name\">Name</div>\n            <div class=\"item-col qty\">Quantity</div>\n            <div class=\"item-col total\">Total</div>\n        `).appendTo(listContainer);\n\n        // Add items\n        this.loadItems(listContainer);\n    }\n\n    formatCurrency(amount) {\n        return amount.toFixed(2) + ' DA';\n    }\n\n    loadPOSOpenings() {\n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'POS Opening Entry',\n                filters: {\n                    company   : this.selectedCompany,\n                    docstatus : 1\n                },\n                fields: ['name', 'pos_profile'],\n                limit: 0\n            },\n            callback: (response) => {\n                if (response.message) {\n                    this.posOpeningSelect.empty();\n                    this.posOpeningSelect.append(\n                        $('<option></option>')\n                            .val('')\n                            .text('All POS Sessions')\n                    );\n                    response.message.forEach(entry => {\n                        this.posOpeningSelect.append(\n                            $('<option></option>')\n                                .val(entry.name)\n                                .text(`${entry.name} (${entry.pos_profile})`)\n                        );\n                    });\n                    this.posOpeningSelect.val(this.selectedPOSOpening);\n                }\n            }\n        });\n    }\n\n\n    loadItems(container) {\n        // Clear any previous content\n        container.find('.item-row:not(.header)').remove();\n        container.find('.loading-spinner, .error-message, .no-items-message').remove();\n\n        // Add loading spinner\n        const loadingSpinner = $(`\n            <div class=\"loading-spinner\">\n                <div class=\"spinner\"></div>\n                <div class=\"loading-text\">Loading items...</div>\n            </div>\n        `).appendTo(container);\n\n        console.log(\"Loading items with filters:\", {\n            company: this.selectedCompany,\n            pos_opening_entry: this.selectedPOSOpening,\n            brand: this.selectedBrand\n        });\n\n        frappe.call({\n            method: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_saled_item',\n            args: {\n                company: this.selectedCompany,\n                pos_opening_entry: this.selectedPOSOpening,\n                brand: this.selectedBrand || ''\n            },\n            callback: (response) => {\n                loadingSpinner.remove();\n                console.log(\"Response:\", response);\n                if (response.message && response.message.items && Object.keys(response.message.items).length > 0) {\n                    this.data = response.message.items;\n                    this.renderItems(container, this.data);\n                } else {\n                    $('<div class=\"no-items-message\">').text('No items found').appendTo(container);\n                }\n            },\n            error: (err) => {\n                loadingSpinner.remove();\n                $('<div class=\"error-message\">')\n                    .text('Error loading items. Please try again.')\n                    .appendTo(container);\n                console.error(\"Error loading items:\", err);\n            }\n        });\n    }\n    \n\n    renderItems(container, items) {\n        container.find('.item-row:not(.header)').remove();\n    \n        // Check if there are no items\n        if (Object.keys(items).length === 0) {\n            $('<div class=\"item-row no-data\">')\n                .html('<div class=\"item-col name\">No sales data found for selected date</div>')\n                .appendTo(container);\n            return;\n        }\n    \n        let grandTotal = 0;\n    \n        Object.entries(items).forEach(([itemName, item]) => {\n            grandTotal += item.rate * item.qty;\n    \n            $('<div class=\"item-row\">')\n                .html(`\n                    <div class=\"item-col name\">${frappe.utils.escape_html(itemName)}</div>\n                    <div class=\"item-col qty\">${item.qty}</div>\n                    <div class=\"item-col total\">${this.formatCurrency(item.rate * item.qty)}</div>\n                `)\n                .appendTo(container);\n        });\n    \n        $('<div class=\"item-row grand-total\">')\n            .html(`\n                <div class=\"item-col name\">Grand Total</div>\n                <div class=\"item-col qty\"></div>\n                <div class=\"item-col total\">${this.formatCurrency(grandTotal)}</div>\n            `)\n            .appendTo(container);\n    }\n    \n    exportData() {\n        // Convert this.data to an array if it's an object\n        const dataArray = Object.entries(this.data || {}).map(([key, value]) => ({\n            name: key,\n            qty: value.qty,\n            total: value.rate * value.qty\n        }));\n    \n        // Check if dataArray is not empty\n        if (dataArray.length === 0) {\n            frappe.msgprint(\"No data to export.\");\n            return;\n        }\n    \n        // Calculate totals\n        const totalRecords = dataArray.length;\n        const totalQty = dataArray.reduce((sum, item) => sum + (item.qty || 0), 0);\n        const totalCost = dataArray.reduce((sum, item) => sum + (item.total || 0), 0);\n    \n        // Add the totals row\n        dataArray.push({\n            name: \"Total\",\n            qty: totalQty,\n            total: totalCost\n        });\n    \n        // Create a new workbook and add the sheet\n        const wb = XLSX.utils.book_new();\n        const ws = XLSX.utils.json_to_sheet(dataArray);\n    \n        // Add the total records in the first column of the last row\n        const lastRowIndex = dataArray.length;\n        ws[`A${lastRowIndex + 1}`] = { t: 's', v: 'Total Records' };\n        ws[`B${lastRowIndex + 1}`] = { t: 'n', v: totalRecords };\n    \n        XLSX.utils.book_append_sheet(wb, ws, \"Sheet1\");\n    \n        // Use type 'array' instead of 'blob'\n        const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\n    \n        // Create a Blob from the array buffer\n        const blob = new Blob([wbout], { type: 'application/octet-stream' });\n    \n        // Create download link and trigger download\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = \"data.xlsx\";\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n};\n", "frappe.provide(\"pos_ar.Pricing\");\n\npos_ar.Pricing.PricingController = class {\n    constructor(wrapper) {\n        this.wrapper = $(wrapper).find(\".layout-main-section\");\n        this.current_screen = 'pricing'; // Default screen\n        this.fetcher = new pos_ar.Pricing.PricingFetcher();\n        this.setup_page();\n        this.add_style();\n        this.setup_events();\n        this.load_companies();\n\n\n        //global data \n        this.priceLists = [];\n        this.brands = [];\n        this.priceMap = {}\n\n    }\n\n    setup_page() {\n        this.page_content = $(`\n            <div class=\"pricing-container\">\n                <!-- Loading Popover -->\n                <div id=\"loadingPopover\" popover=\"manual\">\n                    <div class=\"loading-content\">\n                        <div class=\"loading-spinner\"></div>\n                        <div class=\"loading-text\">Loading Prices</div>\n                    </div>\n                </div>\n\n                <!-- Top App Bar -->\n                <div class=\"pricing-top-bar\">\n                    <div class=\"top-bar-left\">\n                        <h2>Pricing Management</h2>\n                    </div>\n                    <div class=\"top-bar-filters\">\n                        <div class=\"filter-item\">\n                            <select class=\"form-control company-filter\" placeholder=\"Company\">\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"top-bar-right\">\n                        <button class=\"btn btn-primary\">New Price</button>\n                        <button class=\"btn btn-default\">Import</button>\n                        <button class=\"btn btn-default\">Export</button>\n                    </div>\n                </div>\n\n                <!-- Main Content Area with Sidebar -->\n                <div class=\"pricing-main-content\">\n                    <!-- Sidebar Navigation -->\n                    <div class=\"pricing-sidebar\">\n                        <div class=\"sidebar-nav\">\n                            <div class=\"nav-item active\" data-screen=\"pricing\">\n                                <i class=\"fa fa-tag\"></i>\n                                <span>Pricing</span>\n                            </div>\n                            <div class=\"nav-item\" data-screen=\"fixing\">\n                                <i class=\"fa fa-wrench\"></i>\n                                <span>Fixing</span>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!-- Content Area -->\n                    <div class=\"pricing-content\">\n                        <div class=\"screen pricing-screen active\">\n                            <!-- Pricing screen content will be loaded here -->\n                        </div>\n                        <div class=\"screen fixing-screen\">\n                            <!-- Fixing screen content will be loaded here -->\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `).appendTo(this.wrapper);\n\n        // Initialize the popover\n        this.loadingPopover = document.getElementById('loadingPopover');\n    }\n\n    setup_events() {\n        // Handle navigation clicks\n        this.wrapper.find('.nav-item').on('click', (e) => {\n            const screen = $(e.currentTarget).data('screen');\n            this.switch_screen(screen);\n        });\n\n        // Handle company filter change\n        this.wrapper.find('.company-filter').on('change', (e) => {\n            const company = $(e.currentTarget).val();\n            this.filter_by_company(company);\n        });\n\n        // Handle new price list button click\n        this.wrapper.find('.btn-primary').on('click', () => {\n            this.create_new_item_price();\n        });\n\n        // Handle export button click\n        this.wrapper.find('.btn-default:contains(\"Export\")').on('click', () => {\n            this.export_pricing_data();\n        });\n\n        // Handle price fixing\n        this.wrapper.on('click', '.fix-prices', (e) => {\n            const $button = $(e.currentTarget);\n            const brand = $button.data('brand');\n            const priceList = $button.data('price-list');\n            \n            // Get prices from the priceMap for this brand and price list\n            const prices = this.priceMap[`${brand}_${priceList}`];\n            \n            // Get unique prices\n            const uniquePrices = [...new Set(prices.map(p => p.price))];\n            \n            // Create dialog showing current prices and new price field\n            const d = new frappe.ui.Dialog({\n                title: __(`Fix Prices for ${brand}`),\n                fields: [\n                    {\n                        fieldtype: 'HTML',\n                        fieldname: 'current_prices',\n                        label: __('Current Prices'),\n                        options: `\n                            <div class=\"current-prices-table\">\n                                <table class=\"table table-bordered\">\n                                    <thead>\n                                        <tr>\n                                            <th>${__('Current Price')}</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        ${uniquePrices.map(price => `\n                                            <tr>\n                                                <td>${price}</td>\n                                            </tr>\n                                        `).join('')}\n                                    </tbody>\n                                </table>\n                            </div>\n                        `\n                    },\n                    {\n                        fieldtype: 'Currency',\n                        fieldname: 'new_price',\n                        label: __('New Price'),\n                        reqd: 1,\n                        description: __('This price will be applied to all items shown above')\n                    }\n                ],\n                primary_action_label: __('Update Prices'),\n                primary_action: (values) => {\n                    frappe.call({\n                        method: 'pos_ar.pos_ar.page.pricing.pricing.fix_prices',\n                        args: {\n                            brand: brand,\n                            price_list: priceList,\n                            new_price: values.new_price\n                        },\n                        freeze: true,\n                        freeze_message: __('Fixing Prices...'),\n                        callback: (r) => {\n                            console.log(\"r : \",r);\n                            if (!r.exc) {\n                                d.hide();\n                                frappe.show_alert({\n                                    message: __('Prices fixed successfully'),\n                                    indicator: 'green'\n                                });\n                                // Refresh the current view\n                                const company = $('.company-filter').val();\n                                if (this.current_screen === 'fixing') {\n                                    this.load_fixing_data(company);\n                                } else {\n                                    this.load_pricing_data(company);\n                                }\n                            }\n                        }\n                    });\n                }\n            });\n            \n            d.show();\n        });\n\n        // Edit price button handler using event delegation\n        $(document).off('click', '.edit-price').on('click', '.edit-price', function (e) {\n            const itemName = $(this).data('name');\n            if (itemName) {\n                this.show_price_editor(itemName);\n            }\n        }.bind(this));\n    }\n\n    switch_screen(screen) {\n        // Update navigation active state\n        this.wrapper.find('.nav-item').removeClass('active');\n        this.wrapper.find(`.nav-item[data-screen=\"${screen}\"]`).addClass('active');\n\n        // Update screen visibility\n        this.wrapper.find('.screen').removeClass('active');\n        this.wrapper.find(`.${screen}-screen`).addClass('active');\n\n        this.current_screen = screen;\n        \n        // Reload data based on current screen\n        const company = this.wrapper.find('.company-filter').val();\n        if (screen === 'fixing') {\n            this.load_fixing_data(company);\n        } else {\n            this.load_pricing_data(company);\n        }\n    }\n\n    load_companies() {\n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Company',\n                fields: ['name', 'company_name'],\n                order_by: 'company_name asc'\n            },\n            callback: (response) => {\n                if (response.message) {\n                    const companies = response.message;\n                    const $companyFilter = this.wrapper.find('.company-filter');\n                    $companyFilter.empty();\n\n                    // Add companies without a default option\n                    companies.forEach(company => {\n                        $companyFilter.append(`<option value=\"${company.name}\">${company.company_name}</option>`);\n                    });\n\n                    // Set default company if available\n                    if (frappe.defaults.get_default('company')) {\n                        $companyFilter.val(frappe.defaults.get_default('company'));\n                        this.filter_by_company(frappe.defaults.get_default('company'));\n                    } else {\n                        this.filter_by_company(companies[0].name);\n                    }\n\n                    // Initialize select2 with placeholder\n                    $companyFilter.select2({\n                        placeholder: 'Company',\n                        allowClear: true\n                    });\n                }\n            }\n        });\n    }\n\n    filter_by_company(company) {\n        if (this.current_screen === 'pricing') {\n            this.load_pricing_data(company);\n        } else if (this.current_screen === 'fixing') {\n            this.load_fixing_data(company);\n        }\n    }\n\n    async load_pricing_data(company) {\n\n        if (!company) return;\n\n        try {\n            // Get or initialize loading popover\n            if (!this.loadingPopover) {\n                this.loadingPopover = document.getElementById('loadingPopover');\n            }\n\n            // Close any existing popover\n            if (this.loadingPopover.matches(':popover-open')) {\n                this.loadingPopover.hidePopover();\n            }\n\n            // Show the popover\n            requestAnimationFrame(() => {\n                this.loadingPopover.showPopover();\n            });\n\n            const result = await this.fetcher.fetchItemPrices(company);\n            const data = result.prices;\n            this.priceLists = result.price_lists;\n            this.brands = result.brands;\n\n            // Hide loading popover\n            this.loadingPopover.hidePopover();\n\n            this.render_pricing_data(data, this.priceLists, this.brands);\n        } catch (error) {\n            // Hide loading popover in case of error\n            if (this.loadingPopover) {\n                this.loadingPopover.hidePopover();\n            }\n\n            frappe.msgprint({\n                title: __('Error'),\n                indicator: 'red',\n                message: __('Failed to load item prices')\n            });\n            console.error('Error loading item prices:', error);\n        }\n    }\n\n    render_pricing_data(data, priceLists, brands) {\n        const $pricingScreen = this.wrapper.find('.pricing-screen');\n        $pricingScreen.empty();\n\n        if (!data || data.length === 0) {\n            $pricingScreen.html(`\n                <div class=\"no-data-state\">\n                    <div class=\"no-data-icon\">\n                        <i class=\"fa fa-tag\"></i>\n                    </div>\n                    <div class=\"no-data-message\">\n                        No item prices found for this company\n                    </div>\n                </div>\n            `);\n            return;\n        }\n\n        // Load and apply saved column order\n        const savedOrder = JSON.parse(localStorage.getItem('priceListOrder') || '[]');\n        if (savedOrder.length > 0) {\n            priceLists.sort((a, b) => {\n                const aIndex = savedOrder.indexOf(a.name);\n                const bIndex = savedOrder.indexOf(b.name);\n                if (aIndex === -1 && bIndex === -1) return 0;\n                if (aIndex === -1) return 1;\n                if (bIndex === -1) return -1;\n                return aIndex - bIndex;\n            });\n        } else {\n            // First time, save the current order\n            localStorage.setItem('priceListOrder', JSON.stringify(priceLists.map(pl => pl.name)));\n        }\n\n        // Create a map for quick price lookup\n        this.priceMap = {};\n        data.forEach(item => {\n            const key = `${item.brand || 'No Brand'}_${item.price_list}`;\n            if (!this.priceMap[key]) {\n                this.priceMap[key] = [];\n            }\n            this.priceMap[key].push({\n                name: item.name,\n                price: item.price_list_rate,\n                item_code: item.item_code,\n            });\n        });\n\n        const $content = $(`\n            <div class=\"pricing-data\">\n                <div class=\"pricing-controls\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-md-6\">\n                            <div class=\"search-wrapper\">\n                                <div class=\"search-field\">\n                                    <i class=\"fa fa-search search-icon\"></i>\n                                    <input type=\"text\" class=\"form-control global-search\" placeholder=\"Search across all columns...\">\n                                    <button class=\"btn btn-link btn-clear-search\" style=\"display: none;\">\n                                        <i class=\"fa fa-times\"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-md-6 text-right\">\n                            <button class=\"btn btn-default toggle-filters\">\n                                <i class=\"fa fa-filter\"></i> Filters\n                            </button>\n                            <button class=\"btn btn-default clear-filters\">\n                                <i class=\"fa fa-times\"></i> Clear\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"pricing-table\">\n                    <table class=\"table table-bordered table-hover\">\n                        <thead>\n                            <tr class=\"headers\">\n                                <th class=\"sortable\" data-sort=\"brand\">\n                                    Brand <i class=\"fa fa-sort\"></i>\n                                </th>\n                                ${priceLists.map(pl => `\n                                    <th class=\"sortable draggable-header\" data-sort=\"price\" data-price-list=\"${pl.name}\" draggable=\"true\">\n                                        <div class=\"header-content\">\n                                            <i class=\"fa fa-grip-vertical drag-handle\"></i>\n                                            ${pl.name} <i class=\"fa fa-sort\"></i>\n                                        </div>\n                                    </th>\n                                `).join('')}\n                            </tr>\n                            <tr class=\"filters\" style=\"display: none;\">\n                                <td>\n                                    <input type=\"text\" class=\"form-control brand-filter\" placeholder=\"Filter Brand...\">\n                                </td>\n                                ${priceLists.map(() => `\n                                    <td>\n                                        <input type=\"text\" class=\"form-control price-filter\" placeholder=\"Filter Price...\">\n                                    </td>\n                                `).join('')}\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${brands.map(brand => `\n                                <tr>\n                                    <td>${brand.brand || brand.name}</td>\n                                    ${priceLists.map(pl => {\n                                        const priceData = this.priceMap[`${brand.name}_${pl.name}`] || [];\n                                        const hasDifferentPrices = priceData.length > 1 && \n                                            !priceData.every(item => item.price === priceData[0].price);\n                                        \n                                        // Get all prices for this brand across all price lists\n                                        const allPricesForBrand = priceLists.map(plist => {\n                                            const data = this.priceMap[`${brand.name}_${plist.name}`] || [];\n                                            return data.length > 0 ? data[0].price : 0;\n                                        }).filter(price => price > 0);\n\n                                        // Calculate price range\n                                        const currentPrice = priceData.length > 0 ? priceData[0].price : 0;\n                                        let priceClass = '';\n                                        \n                                        if (currentPrice > 0 && allPricesForBrand.length > 0) {\n                                            const max = Math.max(...allPricesForBrand);\n                                            const min = Math.min(...allPricesForBrand);\n                                            const range = max - min;\n                                            const threshold = range / 6;\n\n                                            if (currentPrice >= max - threshold) {\n                                                priceClass = 'price-highest';\n                                            } else if (currentPrice >= max - 2 * threshold) {\n                                                priceClass = 'price-high';\n                                            } else if (currentPrice >= max - 3 * threshold) {\n                                                priceClass = 'price-medium-high';\n                                            } else if (currentPrice >= max - 4 * threshold) {\n                                                priceClass = 'price-medium-low';\n                                            } else if (currentPrice >= max - 5 * threshold) {\n                                                priceClass = 'price-low';\n                                            } else {\n                                                priceClass = 'price-lowest';\n                                            }\n                                        }\n                                        \n                                        return `\n                                            <td>\n                                                ${priceData.length > 0 ?\n                                                    `<div class=\"price-cell ${hasDifferentPrices ? 'different-prices' : ''} ${priceClass}\">\n                                                        <div class=\"price-value\">\n                                                            ${frappe.format(priceData[0].price, { fieldtype: 'Currency' })}\n                                                            <button class=\"btn btn-xs btn-default edit-price\" \n                                                                data-name=\"${priceData[0].name}\"\n                                                                title=\"Edit Price\">\n                                                                <i class=\"fa fa-pencil\"></i>\n                                                            </button>\n                                                        </div>\n                                                    </div>` :\n                                                    ''\n                                                }\n                                            </td>\n                                        `;\n                                    }).join('')}\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `);\n\n        // Add event handlers\n        this.setupTableEvents($content);\n\n        // Add some custom styles for the matrix layout\n        const style = $(`\n            <style>\n                .pricing-table {\n                    height: calc(100vh - 300px);\n                    overflow: auto;\n                }\n                .pricing-table table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin-bottom: 0;\n                }\n                .pricing-table th, .pricing-table td {\n                    text-align: center;\n                    padding: 12px;\n                    vertical-align: middle;\n                }\n                .pricing-table th:first-child, \n                .pricing-table td:first-child {\n                    text-align: left;\n                    font-weight: bold;\n                    position: sticky;\n                    left: 0;\n                    background: var(--bg-color);\n                    z-index: 1;\n                }\n                .pricing-table .headers th {\n                    background-color: var(--bg-gray);\n                    position: sticky;\n                    top: 0;\n                    z-index: 2;\n                }\n                .pricing-table .headers th:first-child {\n                    z-index: 3;\n                }\n                .pricing-table .sortable {\n                    cursor: pointer;\n                }\n                .pricing-table .sortable:hover {\n                    background-color: var(--bg-light-gray);\n                }\n                .pricing-table .filters input {\n                    width: 100%;\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                }\n                .price-cell {\n                    display: flex;\n                    flex-direction: column;\n                    gap: var(--margin-xs);\n                    align-items: center;\n                }\n                .price-value {\n                    display: flex;\n                    align-items: center;\n                    gap: var(--margin-xs);\n                    font-weight: 500;\n                    color: var(--text-color);\n                }\n                .no-price {\n                    color: var(--text-muted);\n                    font-style: italic;\n                }\n                .edit-price {\n                    visibility: hidden;\n                    padding: var(--padding-xs) !important;\n                    min-width: 28px;\n                    min-height: 28px;\n                    border: 1px solid var(--border-color);\n                    background: var(--control-bg);\n                    color: var(--text-color);\n                    border-radius: var(--border-radius-sm);\n                    transition: all 0.2s;\n                }\n                .price-cell:hover .edit-price {\n                    visibility: visible;\n                }\n                .pricing-controls {\n                    padding: var(--padding-md);\n                    margin-bottom: var(--margin-lg);\n                }\n                .search-wrapper {\n                    max-width: 500px;\n                }\n                .search-field {\n                    position: relative;\n                    display: flex;\n                    align-items: center;\n                    background: var(--control-bg);\n                    border: 1px solid var(--border-color);\n                    border-radius: var(--border-radius-lg);\n                    transition: all 0.2s;\n                }\n                .search-field:focus-within {\n                    border-color: var(--primary-color);\n                    box-shadow: 0 0 0 3px var(--primary-color-light);\n                }\n                .search-icon {\n                    color: var(--text-muted);\n                    padding: 0 var(--padding-sm);\n                    font-size: 14px;\n                }\n                .search-field .form-control {\n                    border: none;\n                    box-shadow: none;\n                    padding: var(--padding-sm) var(--padding-xs);\n                    background: transparent;\n                    height: 40px;\n                    font-size: var(--text-base);\n                }\n                .search-field .form-control:focus {\n                    outline: none;\n                }\n                .btn-clear-search {\n                    color: var(--text-muted);\n                    padding: var(--padding-xs) var(--padding-sm);\n                    margin-right: 2px;\n                }\n                .btn-clear-search:hover {\n                    color: var(--text-color);\n                }\n                .toggle-filters, .clear-filters {\n                    padding: var(--padding-sm) var(--padding-md);\n                    font-weight: 500;\n                    border-radius: var(--border-radius-lg);\n                    margin-left: var(--margin-sm);\n                    transition: all 0.2s ease;\n                }\n                .toggle-filters:hover, .clear-filters:hover {\n                    background-color: var(--fg-hover-color);\n                    border-color: var(--gray-600);\n                }\n                .price-cell.different-prices {\n                    border: 2px solid red !important;\n                }\n                .price-warning {\n                    color: red;\n                    font-size: 0.8em;\n                    margin-top: 2px;\n                }\n                .price-highest {\n                    background-color: rgba(0, 255, 0, 0.35) !important;\n                }\n                .price-high {\n                    background-color: rgba(100, 255, 0, 0.35) !important;\n                }\n                .price-medium-high {\n                    background-color: rgba(200, 255, 0, 0.35) !important;\n                }\n                .price-medium-low {\n                    background-color: rgba(255, 165, 0, 0.35) !important;\n                }\n                .price-low {\n                    background-color: rgba(255, 100, 0, 0.35) !important;\n                }\n                .price-lowest {\n                    background-color: rgba(255, 0, 0, 0.35) !important;\n                }\n                .price-cell {\n                    padding: 8px;\n                    border-radius: 4px;\n                }\n                .header-content {\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    cursor: grab;\n                }\n                .drag-handle {\n                    color: var(--text-muted);\n                    cursor: grab;\n                }\n                .draggable-header.dragging {\n                    opacity: 0.5;\n                    background: var(--bg-light-gray);\n                }\n            </style>\n        `);\n\n        $pricingScreen.append(style).append($content);\n    }\n\n\n    \n    async load_fixing_data(company) {\n\n        if (!company) return;\n\n        try {\n            // Get or initialize loading popover\n            if (!this.loadingPopover) {\n                this.loadingPopover = document.getElementById('loadingPopover');\n            }\n\n            // Close any existing popover\n            if (this.loadingPopover.matches(':popover-open')) {\n                this.loadingPopover.hidePopover();\n            }\n\n            // Show the popover\n            requestAnimationFrame(() => {\n                this.loadingPopover.showPopover();\n            });\n\n            const result = await this.fetcher.fetchAllItemPrices(company);\n            const data = result.prices;\n            this.priceLists = result.price_lists;\n            this.brands = result.brands;\n\n            // Hide loading popover\n            this.loadingPopover.hidePopover();\n\n            this.render_Fixing_data(data, this.priceLists, this.brands);\n        } catch (error) {\n            // Hide loading popover in case of error\n            if (this.loadingPopover) {\n                this.loadingPopover.hidePopover();\n            }\n\n            frappe.msgprint({\n                title: __('Error'),\n                indicator: 'red',\n                message: __('Failed to load item prices')\n            });\n            console.error('Error loading item prices:', error);\n        }\n\n    }\n\n    render_Fixing_data(data, priceLists, brands) {\n        const $fixingScreen = this.wrapper.find('.fixing-screen');\n        $fixingScreen.empty();\n\n        if (!data || data.length === 0) {\n            $fixingScreen.html(`\n                <div class=\"no-data-state\">\n                    <div class=\"no-data-icon\">\n                        <i class=\"fa fa-tag\"></i>\n                    </div>\n                    <div class=\"no-data-message\">\n                        No item prices found for this company\n                    </div>\n                </div>\n            `);\n            return;\n        }\n\n        // Load and apply saved column order\n        const savedOrder = JSON.parse(localStorage.getItem('priceListOrder') || '[]');\n        if (savedOrder.length > 0) {\n            priceLists.sort((a, b) => {\n                const aIndex = savedOrder.indexOf(a.name);\n                const bIndex = savedOrder.indexOf(b.name);\n                if (aIndex === -1 && bIndex === -1) return 0;\n                if (aIndex === -1) return 1;\n                if (bIndex === -1) return -1;\n                return aIndex - bIndex;\n            });\n        } else {\n            // First time, save the current order\n            localStorage.setItem('priceListOrder', JSON.stringify(priceLists.map(pl => pl.name)));\n        }\n\n        // Create a map for quick price lookup\n        this.priceMap = {};\n        data.forEach(item => {\n            const key = `${item.brand || 'No Brand'}_${item.price_list}`;\n            if (!this.priceMap[key]) {\n                this.priceMap[key] = [];\n            }\n            this.priceMap[key].push({\n                name: item.name,\n                price: item.price_list_rate,\n                item_code: item.item_code,\n            });\n        });\n\n        const $content = $(`\n            <div class=\"pricing-data\">\n                <div class=\"pricing-controls\">\n                    <div class=\"row align-items-center\">\n                        <div class=\"col-md-6\">\n                            <div class=\"search-wrapper\">\n                                <div class=\"search-field\">\n                                    <i class=\"fa fa-search search-icon\"></i>\n                                    <input type=\"text\" class=\"form-control global-search\" placeholder=\"Search across all columns...\">\n                                    <button class=\"btn btn-link btn-clear-search\" style=\"display: none;\">\n                                        <i class=\"fa fa-times\"></i>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"col-md-6 text-right\">\n                            <button class=\"btn btn-default toggle-filters\">\n                                <i class=\"fa fa-filter\"></i> Filters\n                            </button>\n                            <button class=\"btn btn-default clear-filters\">\n                                <i class=\"fa fa-times\"></i> Clear\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"pricing-table\">\n                    <table class=\"table table-bordered table-hover\">\n                        <thead>\n                            <tr class=\"headers\">\n                                <th class=\"sortable\" data-sort=\"brand\">\n                                    Brand <i class=\"fa fa-sort\"></i>\n                                </th>\n                                ${priceLists.map(pl => `\n                                    <th class=\"sortable draggable-header\" data-sort=\"price\" data-price-list=\"${pl.name}\" draggable=\"true\">\n                                        <div class=\"header-content\">\n                                            <i class=\"fa fa-grip-vertical drag-handle\"></i>\n                                            ${pl.name} <i class=\"fa fa-sort\"></i>\n                                        </div>\n                                    </th>\n                                `).join('')}\n                            </tr>\n                            <tr class=\"filters\" style=\"display: none;\">\n                                <td>\n                                    <input type=\"text\" class=\"form-control brand-filter\" placeholder=\"Filter Brand...\">\n                                </td>\n                                ${priceLists.map(() => `\n                                    <td>\n                                        <input type=\"text\" class=\"form-control price-filter\" placeholder=\"Filter Price...\">\n                                    </td>\n                                `).join('')}\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${brands.map(brand => `\n                                <tr>\n                                    <td>\n                                        ${brand.brand || brand.name}\n                                        <button class=\"btn btn-xs btn-primary btn-modern set-brand-prices\" style=\"display:none;\"\n                                            data-brand=\"${brand.name}\"\n                                            title=\"Set Prices for All Items\">\n                                            Set Prices\n                                        </button>\n                                    </td>\n                                    ${priceLists.map(pl => {\n                                        const priceData = this.priceMap[`${brand.name}_${pl.name}`] || [];\n                                        const hasDifferentPrices = priceData.length > 1 && \n                                            !priceData.every(item => item.price === priceData[0].price);\n                                        \n                                        // Get all prices for this brand across all price lists\n                                        const allPricesForBrand = priceLists.map(plist => {\n                                            const data = this.priceMap[`${brand.name}_${plist.name}`] || [];\n                                            return data.length > 0 ? data[0].price : 0;\n                                        }).filter(price => price > 0);\n\n                                        // Calculate price range\n                                        const currentPrice = priceData.length > 0 ? priceData[0].price : 0;\n                                        let priceClass = '';\n                                        \n                                        if (currentPrice > 0 && allPricesForBrand.length > 0) {\n                                            const max = Math.max(...allPricesForBrand);\n                                            const min = Math.min(...allPricesForBrand);\n                                            const range = max - min;\n                                            const threshold = range / 6;\n\n                                            if (currentPrice >= max - threshold) {\n                                                priceClass = 'price-highest';\n                                            } else if (currentPrice >= max - 2 * threshold) {\n                                                priceClass = 'price-high';\n                                            } else if (currentPrice >= max - 3 * threshold) {\n                                                priceClass = 'price-medium-high';\n                                            } else if (currentPrice >= max - 4 * threshold) {\n                                                priceClass = 'price-medium-low';\n                                            } else if (currentPrice >= max - 5 * threshold) {\n                                                priceClass = 'price-low';\n                                            } else {\n                                                priceClass = 'price-lowest';\n                                            }\n                                        }\n                                        \n                                        return `\n                                            <td>\n                                                ${priceData.length > 0 ?\n                                                    `<div class=\"price-cell ${hasDifferentPrices ? 'different-prices' : ''} ${priceClass}\">\n                                                        <div class=\"price-value\">\n                                                            ${frappe.format(priceData[0].price, { fieldtype: 'Currency' })}\n                                                            ${hasDifferentPrices ? `\n                                                                <div class=\"price-warning\">(Multiple prices)</div>\n                                                                <button class=\"btn btn-xs btn-danger btn-modern fix-prices\" \n                                                                    data-brand=\"${brand.name}\"\n                                                                    data-price-list=\"${pl.name}\"\n                                                                    title=\"Fix Price Discrepancy\">\n                                                                    Fix\n                                                                </button>` : ''}\n                                                            <button class=\"btn btn-xs btn-default btn-modern edit-price\" \n                                                                data-name=\"${priceData[0].name}\"\n                                                                title=\"Edit Price\">\n                                                                <i class=\"fa fa-pencil\"></i>\n                                                            </button>\n                                                        </div>\n                                                    </div>` :\n                                                    ''\n                                                }\n                                            </td>\n                                        `;\n                                    }).join('')}\n                                </tr>\n                            `).join('')}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `);\n\n        // Add event handlers\n        this.setupTableEvents($content);\n\n        // Add some custom styles for the matrix layout\n        const style = $(`\n            <style>\n                .pricing-table {\n                    height: calc(100vh - 300px);\n                    overflow: auto;\n                }\n                .pricing-table table {\n                    width: 100%;\n                    border-collapse: collapse;\n                    margin-bottom: 0;\n                }\n                .pricing-table th, .pricing-table td {\n                    text-align: center;\n                    padding: 12px;\n                    vertical-align: middle;\n                }\n                .pricing-table th:first-child, \n                .pricing-table td:first-child {\n                    text-align: left;\n                    font-weight: bold;\n                    position: sticky;\n                    left: 0;\n                    background: var(--bg-color);\n                    z-index: 1;\n                }\n                .pricing-table .headers th {\n                    background-color: var(--bg-gray);\n                    position: sticky;\n                    top: 0;\n                    z-index: 2;\n                }\n                .pricing-table .headers th:first-child {\n                    z-index: 3;\n                }\n                .pricing-table .sortable {\n                    cursor: pointer;\n                }\n                .pricing-table .sortable:hover {\n                    background-color: var(--bg-light-gray);\n                }\n                .pricing-table .filters input {\n                    width: 100%;\n                    padding: 4px 8px;\n                    border-radius: 4px;\n                }\n                .price-cell {\n                    display: flex;\n                    flex-direction: column;\n                    gap: var(--margin-xs);\n                    align-items: center;\n                }\n                .price-value {\n                    display: flex;\n                    align-items: center;\n                    gap: var(--margin-xs);\n                    font-weight: 500;\n                    color: var(--text-color);\n                }\n                .no-price {\n                    color: var(--text-muted);\n                    font-style: italic;\n                }\n                .edit-price {\n                    visibility: hidden;\n                    padding: var(--padding-xs) !important;\n                    min-width: 28px;\n                    min-height: 28px;\n                    border: 1px solid var(--border-color);\n                    background: var(--control-bg);\n                    color: var(--text-color);\n                    border-radius: var(--border-radius-sm);\n                    transition: all 0.2s;\n                }\n                .price-cell:hover .edit-price {\n                    visibility: visible;\n                }\n                .pricing-controls {\n                    padding: var(--padding-md);\n                    margin-bottom: var(--margin-lg);\n                }\n                .search-wrapper {\n                    max-width: 500px;\n                }\n                .search-field {\n                    position: relative;\n                    display: flex;\n                    align-items: center;\n                    background: var(--control-bg);\n                    border: 1px solid var(--border-color);\n                    border-radius: var(--border-radius-lg);\n                    transition: all 0.2s;\n                }\n                .search-field:focus-within {\n                    border-color: var(--primary-color);\n                    box-shadow: 0 0 0 3px var(--primary-color-light);\n                }\n                .search-icon {\n                    color: var(--text-muted);\n                    padding: 0 var(--padding-sm);\n                    font-size: 14px;\n                }\n                .search-field .form-control {\n                    border: none;\n                    box-shadow: none;\n                    padding: var(--padding-sm) var(--padding-xs);\n                    background: transparent;\n                    height: 40px;\n                    font-size: var(--text-base);\n                }\n                .search-field .form-control:focus {\n                    outline: none;\n                }\n                .btn-clear-search {\n                    color: var(--text-muted);\n                    padding: var(--padding-xs) var(--padding-sm);\n                    margin-right: 2px;\n                }\n                .btn-clear-search:hover {\n                    color: var(--text-color);\n                }\n                .toggle-filters, .clear-filters {\n                    padding: var(--padding-sm) var(--padding-md);\n                    font-weight: 500;\n                    border-radius: var(--border-radius-lg);\n                    margin-left: var(--margin-sm);\n                    transition: all 0.2s ease;\n                }\n                .toggle-filters:hover, .clear-filters:hover {\n                    background-color: var(--fg-hover-color);\n                    border-color: var(--gray-600);\n                }\n                .price-cell.different-prices {\n                    border: 2px solid red !important;\n                }\n                .price-warning {\n                    color: red;\n                    font-size: 0.8em;\n                    margin-top: 2px;\n                    margin-bottom: 4px;\n                }\n                .fix-prices {\n                    margin-top: 4px;\n                    margin-left: 4px;\n                }\n                .edit-price {\n                    margin-left: 4px;\n                }\n                .btn-modern {\n                    border: none;\n                    padding: 6px 12px;\n                    border-radius: 4px;\n                    font-weight: 500;\n                    transition: all 0.2s ease;\n                    display: inline-flex;\n                    align-items: center;\n                    gap: 6px;\n                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n                }\n\n                .btn-modern:hover {\n                    transform: translateY(-1px);\n                    box-shadow: 0 4px 6px rgba(0,0,0,0.15);\n                }\n\n                .btn-modern:active {\n                    transform: translateY(0);\n                    box-shadow: 0 1px 2px rgba(0,0,0,0.1);\n                }\n\n                .btn-modern.btn-danger {\n                    background: #ff4d4d;\n                    color: white;\n                }\n\n                .btn-modern.btn-danger:hover {\n                    background: #ff3333;\n                }\n\n                .btn-modern.btn-default {\n                    background: var(--surface-color);\n                    border: 1px solid var(--border-color);\n                    color: var(--text-primary);\n                }\n\n                .btn-modern.btn-default:hover {\n                    background: var(--surface-color);\n                }\n\n                .btn-modern.btn-xs {\n                    padding: 4px 8px;\n                    font-size: 12px;\n                }\n                .price-highest {\n                    background-color: rgba(0, 255, 0, 0.35) !important;\n                }\n                .price-high {\n                    background-color: rgba(100, 255, 0, 0.35) !important;\n                }\n                .price-medium-high {\n                    background-color: rgba(200, 255, 0, 0.35) !important;\n                }\n                .price-medium-low {\n                    background-color: rgba(255, 165, 0, 0.35) !important;\n                }\n                .price-low {\n                    background-color: rgba(255, 100, 0, 0.35) !important;\n                }\n                .price-lowest {\n                    background-color: rgba(255, 0, 0, 0.35) !important;\n                }\n                .price-cell {\n                    padding: 8px;\n                    border-radius: 4px;\n                }\n                .header-content {\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    cursor: grab;\n                }\n                .drag-handle {\n                    color: var(--text-muted);\n                    cursor: grab;\n                }\n                .draggable-header.dragging {\n                    opacity: 0.5;\n                    background: var(--bg-light-gray);\n                }\n            </style>\n        `);\n\n        $fixingScreen.append(style).append($content);\n    }\n\n    setupTableEvents($content) {\n        const self = this;\n\n        // Toggle filters\n        $content.find('.toggle-filters').on('click', function () {\n            $content.find('.filters').toggle();\n        });\n\n        // Clear filters\n        $content.find('.clear-filters').on('click', function () {\n            $content.find('.filters input, .global-search').val('');\n            $content.find('tbody tr').show();\n        });\n\n        // Global search\n        $content.find('.global-search').on('input', function () {\n            const searchTerm = $(this).val().toLowerCase();\n            $content.find('tbody tr').each(function () {\n                const $row = $(this);\n                const text = $row.text().toLowerCase();\n                $row.toggle(text.includes(searchTerm));\n            });\n        });\n\n        // Column filters\n        $content.find('.brand-filter, .price-filter').on('input', function () {\n            const $filters = $content.find('.filters input');\n            const filterValues = $filters.map(function () {\n                return {\n                    column: $(this).closest('td').index(),\n                    value: $(this).val().toLowerCase()\n                };\n            }).get();\n\n            $content.find('tbody tr').each(function () {\n                const $row = $(this);\n                const visible = filterValues.every(filter => {\n                    const cellText = $row.find(`td:eq(${filter.column})`).text().toLowerCase();\n                    return !filter.value || cellText.includes(filter.value);\n                });\n                $row.toggle(visible);\n            });\n        });\n\n        // Sorting\n        let currentSort = { column: null, direction: 'asc' };\n\n        $content.find('.sortable').on('click', function () {\n            const column = $(this).data('sort');\n            const priceList = $(this).data('price-list');\n            const columnIndex = $(this).index();\n\n            // Update sort direction\n            if (currentSort.column === columnIndex) {\n                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';\n            } else {\n                currentSort = { column: columnIndex, direction: 'asc' };\n            }\n\n            // Update sort icons\n            $content.find('.sortable i').attr('class', 'fa fa-sort');\n            $(this).find('i').attr('class', `fa fa-sort-${currentSort.direction}`);\n\n            // Sort rows\n            const rows = $content.find('tbody tr').get();\n            rows.sort((a, b) => {\n                let aVal = $(a).find(`td:eq(${columnIndex})`).text();\n                let bVal = $(b).find(`td:eq(${columnIndex})`).text();\n\n                if (column === 'price') {\n                    // Extract numeric values for price sorting\n                    aVal = parseFloat(aVal.replace(/[^0-9.-]+/g, '')) || 0;\n                    bVal = parseFloat(bVal.replace(/[^0-9.-]+/g, '')) || 0;\n                }\n\n                if (currentSort.direction === 'asc') {\n                    return aVal > bVal ? 1 : -1;\n                } else {\n                    return aVal < bVal ? 1 : -1;\n                }\n            });\n\n            $content.find('tbody').html(rows);\n        });\n\n        // Set prices button handler\n        $content.on('click', '.set-brand-prices', (e) => {\n            const brand = $(e.currentTarget).data('brand');\n            frappe.confirm(\n                `This will set prices for all items of brand \"${brand}\". Do you want to continue?`,\n                () => {\n                    frappe.call({\n                        method: 'pos_ar.pos_ar.page.pricing.pricing.add_price_for_all_item_by_brand2',\n                        args: {\n                            brand: brand\n                        },\n                        freeze: true,\n                        freeze_message: __('Setting Prices...'),\n                        callback: (r) => {\n                            if (!r.exc) {\n                                frappe.show_alert({\n                                    message: __('Prices set successfully'),\n                                    indicator: 'green'\n                                });\n                                // Refresh the current view\n                                const company = $('.company-filter').val();\n                                if (this.current_screen === 'fixing') {\n                                    this.load_fixing_data(company);\n                                } else {\n                                    this.load_pricing_data(company);\n                                }\n                            }\n                        }\n                    });\n                }\n            );\n        });\n\n        // Handle price cell clicks for editing\n        $content.on('click', '.edit-price', (e) => {\n            e.stopPropagation();\n            const itemName = $(e.currentTarget).data('name');\n            this.show_price_editor(itemName);\n        });\n\n        // Setup drag and drop for price list columns\n        const $headers = $content.find('.draggable-header');\n        let draggedHeader = null;\n\n        $headers.each((_, header) => {\n            $(header).on('dragstart', (e) => {\n                draggedHeader = header;\n                $(header).addClass('dragging');\n                e.originalEvent.dataTransfer.setData('text/plain', $(header).data('priceList'));\n            });\n\n            $(header).on('dragend', () => {\n                $(draggedHeader).removeClass('dragging');\n                draggedHeader = null;\n            });\n\n            $(header).on('dragover', (e) => {\n                e.preventDefault();\n            });\n\n            $(header).on('drop', (e) => {\n                e.preventDefault();\n                if (!draggedHeader || draggedHeader === header) return;\n\n                const $allHeaders = $content.find('.draggable-header');\n                const draggedIndex = $allHeaders.index(draggedHeader);\n                const dropIndex = $allHeaders.index(header);\n\n                // Reorder the columns in the table\n                const $rows = $content.find('tr');\n                $rows.each((_, row) => {\n                    const $cells = $(row).find('td, th');\n                    const $draggedCell = $cells.eq(draggedIndex + 1); // +1 for brand column\n                    const $dropCell = $cells.eq(dropIndex + 1);\n\n                    // Store the HTML and data\n                    const draggedHtml = $draggedCell.html();\n                    const dropHtml = $dropCell.html();\n                    const draggedData = {\n                        sort: $draggedCell.data('sort'),\n                        priceList: $draggedCell.data('priceList')\n                    };\n                    const dropData = {\n                        sort: $dropCell.data('sort'),\n                        priceList: $dropCell.data('priceList')\n                    };\n\n                    // Swap contents\n                    $draggedCell.html(dropHtml);\n                    $dropCell.html(draggedHtml);\n\n                    // Swap data attributes for headers\n                    if ($(row).hasClass('headers')) {\n                        $draggedCell.data(dropData);\n                        $dropCell.data(draggedData);\n                    }\n                });\n\n                // Update localStorage with new order\n                const currentOrder = JSON.parse(localStorage.getItem('priceListOrder') || '[]');\n                const draggedPriceList = $(draggedHeader).data('priceList');\n                const dropPriceList = $(header).data('priceList');\n                const newOrder = currentOrder.filter(pl => pl !== draggedPriceList && pl !== dropPriceList);\n                const baseIndex = Math.min(currentOrder.indexOf(dropPriceList), currentOrder.indexOf(draggedPriceList));\n                newOrder.splice(baseIndex, 0, dropPriceList, draggedPriceList);\n                localStorage.setItem('priceListOrder', JSON.stringify(newOrder));\n            });\n        });\n    }\n\n    create_new_item_price() {\n        const company = this.wrapper.find('.company-filter').val();\n        if (!company) {\n            frappe.throw(__('Please select a company first'));\n            return;\n        }\n\n        frappe.prompt([\n            {\n                label: 'Brand',\n                fieldname: 'brand',\n                fieldtype: 'Link',\n                options: 'Brand',\n                reqd: 1\n            },\n            {\n                label: 'Price List',\n                fieldname: 'price_list',\n                fieldtype: 'Link',\n                options: 'Price List',\n                reqd: 1\n            },\n            {\n                label: 'Price List Rate',\n                fieldname: 'price_list_rate',\n                fieldtype: 'Currency',\n                reqd: 1\n            }\n        ], (values) => {\n            // Check if an item with the specified brand exists\n            frappe.db.get_list('Item', {\n                filters: {\n                    brand: values.brand\n                }\n            }).then(items => {\n                if (items.length > 0) {\n                    // Item with the specified brand exists, create a new item price\n                    const item_code = items[0].name;\n                    frappe.call({\n                        method: 'frappe.client.insert',\n                        args: {\n                            doc: {\n                                doctype: 'Item Price',\n                                item_code: item_code,\n                                price_list: values.price_list,\n                                price_list_rate: values.price_list_rate,\n                                company: company\n                            }\n                        },\n                        callback: (r) => {\n                            if (r.message) {\n                                frappe.show_alert({\n                                    message: __('Item Price created successfully'),\n                                    indicator: 'green'\n                                });\n                                this.load_pricing_data(company);\n                            }\n                        }\n                    });\n                } else {\n                    // No item with the specified brand exists, display a message\n                    frappe.msgprint({\n                        title: __('Error'),\n                        indicator: 'red',\n                        message: __('No item with the specified brand exists. Please create an item with the specified brand first.')\n                    });\n                }\n            });\n        }, 'Create New Item Price', 'Create');\n    }\n\n    show_price_editor(itemPriceName) {\n        frappe.db.get_doc('Item Price', itemPriceName)\n            .then(doc => {\n                frappe.prompt([\n                    {\n                        label: 'Current Price',\n                        fieldname: 'current_price',\n                        fieldtype: 'Currency',\n                        read_only: 1,\n                        default: doc.price_list_rate\n                    },\n                    {\n                        label: 'New Price',\n                        fieldname: 'new_price',\n                        fieldtype: 'Currency',\n                        reqd: 1\n                    }\n                ], (values) => {\n                    frappe.call({\n                        method: 'pos_ar.pos_ar.page.pricing.pricing.fix_prices',\n                        args: {\n                            brand: doc.brand,\n                            price_list: doc.price_list,\n                            new_price: values.new_price\n                        },\n                        freeze: true,\n                        freeze_message: __('Updating Price...'),\n                        callback: (r) => {\n                            if (r.exc) {\n                                frappe.msgprint({\n                                    title: __('Error'),\n                                    indicator: 'red',\n                                    message: __('Failed to update price')\n                                });\n                                return;\n                            }\n\n                            frappe.show_alert({\n                                message: __('Price updated successfully'),\n                                indicator: 'green'\n                            });\n\n                            // Find the button element first, then traverse up to find the price cell\n                            const $editButton = $(`.edit-price[data-name=\"${itemPriceName}\"]`);\n                            if ($editButton.length) {\n                                // Find the price cell and completely replace its content\n                                const $priceCell = $editButton.closest('.price-cell');\n                                if ($priceCell.length) {\n                                    const formattedPrice = frappe.format(values.new_price, { fieldtype: 'Currency' });\n                                    $priceCell.html(`\n                                        <div class=\"price-value\">\n                                            ${formattedPrice}\n                                            <button class=\"btn btn-xs btn-default edit-price\" \n                                                data-name=\"${itemPriceName}\"\n                                                title=\"Edit Price\">\n                                                <i class=\"fa fa-pencil\"></i>\n                                            </button>\n                                        </div>\n                                    `);\n                                }\n                            }\n                        }\n                    });\n                }, __('Update Price'), __('Update'));\n            })\n            .catch(err => {\n                console.error(err);\n                frappe.msgprint({\n                    title: __('Error'),\n                    indicator: 'red',\n                    message: __('Failed to fetch price details')\n                });\n            });\n    }\n\n    export_pricing_data() {\n\n        const company = this.wrapper.find('.company-filter').val();\n        if (!company) {\n            frappe.msgprint({\n                title: __('Error'),\n                indicator: 'red',\n                message: __('Please select a company first')\n            });\n            return;\n        }\n\n        // Create the CSV content//+\n        let csvContent = \"data:text/csv;charset=utf-8,\";//+\n\n        // Add the header row//+\n        csvContent += \"Brand,\" + this.priceLists.map(pl => pl.name).join(\",\") + \"\\n\";//+\n        console.log(\"the price lists : \", csvContent)\n        //+\n        // Add the pricing data//+\n        this.brands.forEach(brand => {//+\n            let row = brand.brand;//+\n            this.priceLists.forEach(pl => {//+\n                const data_price = this.priceMap[`${brand.name}_${pl.name}`] || [];//+\n\n                row += \",\" + (data_price.length > 0 ? data_price.map(pd => pd.price).join(',') : \"empty\");//+\n            });//+\n            csvContent += row + \"\\n\";//+\n        });//+\n        //+\n        // Create a temporary link and trigger a download//+\n        const encodedUri = encodeURI(csvContent);//+\n        const link = document.createElement(\"a\");//+\n        link.setAttribute(\"href\", encodedUri);//+\n        link.setAttribute(\"download\", `pricing_matrix_${company}.csv`);//+\n        document.body.appendChild(link);//+\n        link.click();//+\n    }\n\n    add_style() {\n        this.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/pricing_page/main.css\">');\n\n        const style = `\n            <style>\n                :root {\n                    --primary-color: #4f46e5;\n                    --primary-hover: #4338ca;\n                    --bg-color: #f8fafc;\n                    --surface-color: #ffffff;\n                    --text-primary: #1e293b;\n                    --text-secondary: #64748b;\n                    --border-color: #e2e8f0;\n                }\n\n                .pricing-container {\n                    display: flex;\n                    flex-direction: column;\n                    height: 100vh;\n                    overflow: hidden;\n                    background: var(--bg-color);\n                    padding: 1.5rem;\n                    gap: 1.5rem;\n                }\n\n                .pricing-top-bar {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    padding: 1rem 1.5rem;\n                    background: var(--surface-color);\n                    border-radius: 1rem;\n                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);\n                    gap: 2rem;\n                }\n\n                .top-bar-left h2 {\n                    font-size: 1.5rem;\n                    font-weight: 600;\n                    color: var(--text-primary);\n                    margin: 0;\n                    letter-spacing: -0.025em;\n                }\n\n                .top-bar-filters {\n                    display: flex;\n                    gap: 1rem;\n                    flex: 1;\n                    position: relative;\n                }\n\n                .filter-item {\n                    min-width: 240px;\n                    position: relative;\n                }\n\n                .filter-item::before {\n                    content: '';\n                    position: absolute;\n                    inset: 0;\n                    border-radius: 14px;\n                    padding: 2px;\n                    background: linear-gradient(135deg, var(--primary-color), #818cf8);\n                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n                    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n                    -webkit-mask-composite: xor;\n                    mask-composite: exclude;\n                    opacity: 0;\n                    transition: opacity 0.3s;\n                }\n\n                .filter-item:hover::before {\n                    opacity: 0.5;\n                }\n\n                .filter-item .select2-container {\n                    width: 100% !important;\n                }\n\n                .filter-item .select2-container .select2-selection--single {\n                    height: 48px;\n                    background: var(--surface-color);\n                    border: 1px solid var(--border-color);\n                    border-radius: 14px;\n                    display: flex;\n                    align-items: center;\n                    transition: all 0.2s;\n                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);\n                }\n\n                .filter-item .select2-container .select2-selection--single:hover {\n                    border-color: var(--text-secondary);\n                    transform: translateY(-1px);\n                }\n\n                .filter-item .select2-container.select2-container--focus .select2-selection--single {\n                    border-color: var(--primary-color);\n                    box-shadow: 0 0 0 4px var(--primary-color-light);\n                }\n\n                .filter-item .select2-container .select2-selection--single .select2-selection__rendered {\n                    line-height: 48px;\n                    padding: 0 1.25rem;\n                    color: var(--text-primary);\n                    font-weight: 500;\n                    font-size: 0.9375rem;\n                }\n\n                .filter-item .select2-container .select2-selection--single .select2-selection__placeholder {\n                    color: var(--text-secondary);\n                    font-weight: 400;\n                }\n\n                .filter-item .select2-container .select2-selection--single .select2-selection__arrow {\n                    height: 48px;\n                    width: 48px;\n                    position: absolute;\n                    right: 0;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n\n                .filter-item .select2-container .select2-selection--single .select2-selection__arrow b {\n                    display: none;\n                }\n\n                .filter-item .select2-container .select2-selection--single .select2-selection__arrow::after {\n                    content: '';\n                    width: 10px;\n                    height: 10px;\n                    border: 2px solid var(--text-secondary);\n                    border-left: 0;\n                    border-top: 0;\n                    transform: rotate(45deg) translateY(-2px);\n                    transition: all 0.2s;\n                }\n\n                .filter-item .select2-container.select2-container--open .select2-selection--single .select2-selection__arrow::after {\n                    transform: rotate(-135deg) translateY(-2px);\n                    border-color: var(--primary-color);\n                }\n\n                .top-bar-right {\n                    display: flex;\n                    gap: 0.75rem;\n                }\n\n                .btn {\n                    height: 42px;\n                    padding: 0 1.5rem;\n                    border-radius: 0.75rem;\n                    font-weight: 500;\n                    transition: all 0.2s;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 0.5rem;\n                }\n\n                .btn-primary {\n                    background: var(--primary-color);\n                    color: white;\n                    border: none;\n                }\n\n                .btn-primary:hover {\n                    background: var(--primary-hover);\n                    transform: translateY(-1px);\n                }\n\n                .btn-default {\n                    background: var(--surface-color);\n                    border: 1px solid var(--border-color);\n                    color: var(--text-primary);\n                }\n\n                .btn-default:hover {\n                    border-color: var(--text-secondary);\n                    transform: translateY(-1px);\n                }\n\n                .pricing-main-content {\n                    display: flex;\n                    flex: 1;\n                    gap: 1.5rem;\n                    height: calc(100vh - 120px);\n                    overflow: hidden;\n                }\n\n                .pricing-sidebar {\n                    width: 280px;\n                    background: var(--surface-color);\n                    border-radius: 1rem;\n                    padding: 1.25rem 1rem;\n                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);\n                }\n\n                .sidebar-nav {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 0.5rem;\n                }\n\n                .nav-item {\n                    display: flex;\n                    align-items: center;\n                    gap: 0.75rem;\n                    padding: 0.875rem 1rem;\n                    border-radius: 0.75rem;\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    color: var(--text-secondary);\n                }\n\n                .nav-item:hover {\n                    color: var(--text-primary);\n                    background: var(--bg-color);\n                }\n\n                .nav-item.active {\n                    color: var(--primary-color);\n                    background: rgba(79, 70, 229, 0.1);\n                    font-weight: 500;\n                }\n\n                .nav-item i {\n                    font-size: 1.25rem;\n                    width: 24px;\n                }\n\n                .pricing-content {\n                    flex: 1;\n                    background: var(--surface-color);\n                    border-radius: 1rem;\n                    padding: 1.5rem;\n                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);\n                    overflow-y: auto;\n                }\n\n                .screen {\n                    display: none;\n                }\n\n                .screen.active {\n                    display: block;\n                }\n\n                /* Custom scrollbar */\n                .pricing-content::-webkit-scrollbar {\n                    width: 6px;\n                }\n\n                .pricing-content::-webkit-scrollbar-track {\n                    background: transparent;\n                }\n\n                .pricing-content::-webkit-scrollbar-thumb {\n                    background: var(--border-color);\n                    border-radius: 3px;\n                }\n\n                .pricing-content::-webkit-scrollbar-thumb:hover {\n                    background: var(--text-secondary);\n                }\n\n                /* Loading Popover Styles */\n                #loadingPopover {\n                    position: fixed;\n                    inset: 0;\n                    margin: auto;\n                    width: max-content;\n                    height: max-content;\n                    background: rgba(255, 255, 255, 0.98);\n                    padding: 2.5rem 3rem;\n                    border-radius: 1.2rem;\n                    box-shadow: 0 8px 16px -1px rgba(0, 0, 0, 0.1), \n                               0 4px 8px -1px rgba(0, 0, 0, 0.06);\n                    border: none;\n                    z-index: 1000;\n                }\n\n                #loadingPopover::backdrop {\n                    background: rgba(0, 0, 0, 0.25);\n                    backdrop-filter: blur(6px);\n                }\n\n                .loading-content {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 1.25rem;\n                }\n\n                .loading-spinner {\n                    width: 48px;\n                    height: 48px;\n                    border: 3px solid var(--border-color);\n                    border-top-color: var(--primary-color);\n                    border-radius: 50%;\n                    animation: spin 0.8s linear infinite;\n                }\n\n                .loading-text {\n                    color: var(--text-primary);\n                    font-weight: 500;\n                    font-size: 1.1rem;\n                    letter-spacing: -0.01em;\n                }\n\n                @keyframes spin {\n                    to { transform: rotate(360deg); }\n                }\n                .price-highest {\n                    background-color: rgba(0, 255, 0, 0.35) !important;\n                }\n                .price-high {\n                    background-color: rgba(100, 255, 0, 0.35) !important;\n                }\n                .price-medium-high {\n                    background-color: rgba(200, 255, 0, 0.35) !important;\n                }\n                .price-medium-low {\n                    background-color: rgba(255, 165, 0, 0.35) !important;\n                }\n                .price-low {\n                    background-color: rgba(255, 100, 0, 0.35) !important;\n                }\n                .price-lowest {\n                    background-color: rgba(255, 0, 0, 0.35) !important;\n                }\n                .price-cell {\n                    padding: 8px;\n                    border-radius: 4px;\n                }\n                .header-content {\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    cursor: grab;\n                }\n                .drag-handle {\n                    color: var(--text-muted);\n                    cursor: grab;\n                }\n                .draggable-header.dragging {\n                    opacity: 0.5;\n                    background: var(--bg-light-gray);\n                }\n            </style>\n        `;\n\n        this.wrapper.append(style);\n    }\n};\n", "pos_ar.Pricing.PricingFetcher = class {\r\n\r\n    constructor(){\r\n        console.log(\"PricingFetcher initialized\");\r\n    }\r\n\r\n\r\n\tasync fetchItemPrices( company ) {\r\n\t\ttry {\r\n\t\t\tconst response = await frappe.call({\r\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_item_prices',\r\n\t\t\t\targs: { company }\r\n\t\t\t});\r\n\t\t\tconsole.log(\"fetched item prices\" , response.message);\r\n\t\t\treturn response.message || [];  // The fetched item prices\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error fetching item prices:', error);\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t//that is for the fixing scene to resolve the conflicting prices\r\n\tasync fetchAllItemPrices( company ) {\r\n\t\ttry {\r\n\t\t\tconst response = await frappe.call({\r\n\t\t\t\tmethod: 'pos_ar.pos_ar.page.pricing.pricing.get_all_item_prices',\r\n\t\t\t\targs: { company }\r\n\t\t\t});\r\n\t\t\tconsole.log(\"fetched item prices\" , response.message);\r\n\t\t\treturn response.message || [];  // The fetched item prices\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error fetching item prices:', error);\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\r\n}", "pos_ar.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\t//principales variable\n\t\tthis.wrapper = $(wrapper).find(\".layout-main-section\");\n\t\tthis.page = wrapper.page;\n\n\n\t\tthis.selectedItemMaps = new Map()\n\n\t\tthis.selectedItem = { \"name\": \"\" }\n\t\tthis.selectedField = { \"field_name\": \"\" }\n\t\tthis.selectedTab = { \"tabName\": \"\" }\n\t\tthis.selectedPaymentMethod = { \"methodName\": \"\" }\n\t\tthis.defaultCustomer = { \"name\": \"\", \"customer_name\": \"\" }\n\t\tthis.defaultPriceList = { \"name\": \"\" }\n\t\tthis.taxes_and_charges_template = null;\n\t\tthis.taxes_and_charges = [];\n\t\tthis.payment_methods = []\n\n\t\t//sell invoice\n\t\tthis.POSOpeningEntry = {}\n\n\t\tthis.invoiceData = { netTotal: 0, grandTotal: 0, paidAmount: 0, toChange: 0, discount: 0 }\n\t\tthis.db = null;\n\n\t\tthis.syncInput = false\n\n\n\t\tfrappe.db.get_list('Customer', {\n\t\t\tfilters: { custom_company: 'Optilens BISKRA' },\n\t\t\tfields: ['name'],\n\t\t}).then(record => {\n\t\t\tconsole.log(\" customers ::: \", record)\n\t\t})\n\n\n\n\t\tthis.start_app();\n\t}\n\n\tasync start_app() {\n\t\ttry {\n\t\t\t//init db\n\t\t\tthis.db = await pos_ar.PointOfSale.pos_db.openDatabase();\n\t\t\t//data classes\n\t\t\tthis.settings_data = new pos_ar.PointOfSale.posSettingsData(this.db)\n\t\t\t//api fetch handler\n\t\t\tthis.dataHandler = new pos_ar.PointOfSale.FetchHandler()\n\n\t\t\tconsole.log(\"warehouse ::::::::\", await this.dataHandler.fetchStockBalance())\n\t\t\t//local app data\n\t\t\tthis.appData = new pos_ar.PointOfSale.posAppData(this.db, this.dataHandler)\n\t\t\tawait this.appData.getAllData()\n\n\t\t\t//init screen manager\n\t\t\tthis.screenManager = new pos_ar.PointOfSale.ScreenManager(this.settings_data);\n\n\t\t\tthis.toggleKeyboardMode(!this.settings_data.settings.showItemDetails);\n\n\t\t\tthis.prepare_container();\n\t\t\t//prepare app data\n\t\t\tawait this.prepare_app_data();\n\n\t\t\t//proceed with other initialization only if app data are set correctly\n\t\t\tawait this.checkForPOSEntry()\n\t\t\tawait this.prepare_components();\n\t\t\tthis.checkUnSyncedPos();\n\t\t\tthis.setListeners();\n\n\t\t\tconst openedPos = await this.appData.getAllOpenedPosInvoice()\n\t\t\tthis.restorePosInvoices(openedPos)\n\n\t\t} catch (err) {\n\t\t\tconsole.error(\"halfware POS Err ==> \", err)\n\t\t}\n\t}\n\n\tasync prepare_app_data() {\n\t\ttry {\n\n\t\t\tawait this.handleAppData();\n\n\n\t\t\tlet priceList = this.getCustomerDefaultPriceList(this.defaultCustomer.name)\n\t\t\tif (priceList == \"\" || priceList == null || priceList == undefined) {\n\t\t\t\tpriceList = this.defaultPriceList.name\n\t\t\t}\n\n\n\t\t\tlet new_pos_invoice = frappe.model.get_new_doc('POS Invoice');\n\t\t\tnew_pos_invoice.customer = this.defaultCustomer.name\n\t\t\tnew_pos_invoice.pos_profile = this.appData.appData.pos_profile.name\n\t\t\tnew_pos_invoice.items = [];\n\t\t\tnew_pos_invoice.taxes_and_charges = this.appData.appData.pos_profile.taxes_and_charges\n\t\t\tnew_pos_invoice.additional_discount_percentage = 0\n\t\t\tnew_pos_invoice.paid_amount = 0\n\t\t\tnew_pos_invoice.base_paid_amount = 0\n\t\t\tnew_pos_invoice.creation_time = frappe.datetime.now_datetime()\n\t\t\tnew_pos_invoice.payments = this.getPaymentMethods()\n\t\t\tnew_pos_invoice.is_pos = 1\n\t\t\tnew_pos_invoice.update_stock = 1\n\t\t\tnew_pos_invoice.docstatus = 0\n\t\t\tnew_pos_invoice.status = 'Draft'\n\t\t\tnew_pos_invoice.priceList = priceList\n\t\t\tnew_pos_invoice.opened = 1\n\t\t\t//build refNm   posProfile-date-time\n\t\t\tconst date = new Date()\n\t\t\tconst [year, month, day] = date.toISOString().split('T')[0].split('-')\n\t\t\tconst hour = date.getHours()\n\t\t\tconst minutes = date.getMinutes()\n\t\t\tconst seconds = date.getMilliseconds()\n\t\t\tnew_pos_invoice.refNum = this.appData.appData.pos_profile.name + \"-\" + year + '-' + month + '-' + day + '-' + hour + minutes + seconds\n\t\t\tnew_pos_invoice.custom_cach_name = new_pos_invoice.refNum\n\n\t\t\tthis.selectedItemMaps.set(\"C1\", new_pos_invoice)\n\t\t\tthis.selectedTab.tabName = `C1`\n\n\t\t} catch (err) {\n\t\t\tconsole.error(\"Hlafware POS Error ==> \", err)\n\t\t\tthrow err;\n\t\t}\n\n\t}\n\n\n\tasync handleAppData() {\n\t\t//check pos profile\n\t\tif (this.appData.appData.pos_profile == null) {\n\t\t\tfrappe.set_route(\"Form\", \"POS Profile\");\n\t\t\tthrow new Error(\"there is no pos profile\")\n\t\t}\n\n\t\t//check takes and get it if it exist on pos profile\n\t\tif (this.appData.appData.pos_profile.taxes_and_charges != null && this.appData.appData.pos_profile.taxes_and_charges != \"\") {\n\t\t\tthis.taxes_and_charges_template = await this.dataHandler.fetchSalesTaxesAndChargesTemplate(this.appData.appData.pos_profile.taxes_and_charges)\n\t\t\tthis.taxes_and_charges = this.taxes_and_charges_template.taxes\n\t\t}\n\t\t//check company and get it if it exist on pos profile\n\t\tif (this.appData.appData.pos_profile.company != null && this.appData.appData.pos_profile.company != '') {\n\t\t\tthis.company = await this.dataHandler.fetchCompany(this.appData.appData.pos_profile.company)\n\t\t}\n\n\t\t//check customer\n\t\tif (this.appData.appData.customers.length > 0) {\n\t\t\tthis.defaultCustomer = structuredClone(this.appData.appData.customers[0])\n\t\t} else {\n\t\t\tfrappe.warn(\n\t\t\t\t'You dont have a customer',\n\t\t\t\t'please create a customer to continue',\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Customer\");\n\t\t\t\t},\n\t\t\t\t'Create',\n\t\t\t\tfalse\n\t\t\t)\n\t\t\tthrow new Error(\"there is no customer\")\n\t\t}\n\t\t//check price list\n\t\tif (this.appData.appData.price_lists.length > 0) {\n\t\t\tthis.defaultPriceList.name = this.appData.appData.pos_profile.selling_price_list\n\t\t} else {\n\t\t\tfrappe.warn(\n\t\t\t\t'You dont have a single price list',\n\t\t\t\t'please create a priceList to continue',\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.set_route(\"Form\", \"Price List\");\n\t\t\t\t},\n\t\t\t\t'Create',\n\t\t\t\tfalse\n\t\t\t)\n\t\t\tthrow new Error(\"there is no price list\")\n\t\t}\n\t}\n\n\t/***********************  ui ******************************************/\n\n\tprepare_container() {\n\t\t//append css styles\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/selectorBox.css\">')\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/checkInOutCart.css\">')\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/itemDetailsCart.css\">')\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/paymentMethodCart.css\">')\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/customerBox.css\">')\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/cartBox.css\">')\n\t\tthis.wrapper.append('<link rel=\"stylesheet\" type=\"text/css\" href=\"/assets/pos_ar/css/historyCarts.css\">')\n\n\t\tthis.wrapper.append('<div id=\"MainContainer\" class=\"rowBoxReverse\"></div>');\n\t\tthis.$components_wrapper = this.wrapper.find(\"#MainContainer\");\n\t}\n\n\tprepare_components() {\n\t\tthis.set_right_and_left_sections();\n\t\tthis.init_item_selector();\n\t\tthis.init_customer_box();\n\t\tthis.init_selected_item();\n\t\tthis.init_item_details();\n\t\tthis.init_paymentCart();\n\t\tthis.init_historyCart();\n\t\tthis.init_checkInOutCart();\n\t\tthis.init_debtCart();\n\t\tthis.init_settingsCart();\n\t\tthis.init_unsyncedPosCart();\n\t}\n\n\tasync checkForPOSEntry() {\n\t\tconst user = frappe.session.user;\n\t\tlet posProfile = frappe.defaults.get_default(\"POS Profile\");\n\n\n\t\t// Check if POS Profile is set\n\t\tif (!posProfile) {\n\t\t\t// Clear main container\n\t\t\tthis.wrapper.html(\"\");\n\t\t\t\n\t\t\t// Create and append dialog\n\t\t\tconst dialog = $(`\n\t\t\t\t<div class=\"pos-profile-dialog d-flex flex-column align-items-center justify-content-center\" style=\"height: 100vh;\">\n\t\t\t\t\t<div class=\"alert alert-warning text-center\">\n\t\t\t\t\t\t<h3>${__('POS Profile Not Set')}</h3>\n\t\t\t\t\t\t<p>${__('Please set a default POS Profile to continue using the POS.')}</p>\n\t\t\t\t\t\t<button class=\"btn btn-primary mt-3\" onclick=\"\">\n\t\t\t\t\t\t\t${__('Set POS Profile')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\t\n\t\t\tthis.wrapper.append(dialog);\n\t\t\treturn false;\n\t\t}\n\n\t\t// Fetch POS Profile details\n\t\tlet profile = await frappe.db.get_doc('POS Profile' , posProfile);\n\n\t\tthis.appData.appData.pos_profile = profile;\n\n\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.check_opening_entry',\n\t\t\t\targs: { user, posProfile }\n\t\t\t});\n\t\t\tconsole.log(\"the result is :::: \" , response , \" user : \" , user , \" posProfile : \"  , posProfile)\n\t\t\tconst r = response.message;\n\t\t\tif (r.length === 0) {\n\t\t\t\tthis.create_opening_voucher()\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//copy data\n\t\t\tObject.assign(this.POSOpeningEntry, r[0])\n\t\t\tthis.db.updateCheckInOutSync(this.POSOpeningEntry.period_start_date)\n\t\t\treturn true\n\t\t} catch (error) {\n\t\t\tconsole.error('error occured : ', error);\n\t\t\tfrappe.throw('Error checking for POS Opening Entry.')\n\t\t\treturn false;\n\t\t}\n\n\n\t}\n\n\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst denominations = [5, 10, 20, 50, 100, 200, 500, 1000, 2000];\n\t\n\t\t// Fetch default company and POS profile\n\t\tconst default_company = frappe.defaults.get_default(\"company\");\n\t\tconst default_pos_profile = frappe.defaults.get_default(\"pos_profile\");\n\t\n\t\tlet default_payment_method = null;  // To store the default payment method\n\t\n\t\t// Fetch default payment method\n\t\tconst fetch_default_payment_method = () => {\n\t\t\tif (!default_pos_profile) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tmessage: __('Default POS Profile is not set.'),\n\t\t\t\t\tindicator: 'red'\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\n\t\t\tfrappe.db.get_doc(\"POS Profile\", default_pos_profile).then(({ payments }) => {\n\t\t\t\tconsole.log(\"Available payment methods:\", payments);\n\t\t\t\tif (!payments || payments.length === 0) {\n\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\ttitle: __('No Payment Methods'),\n\t\t\t\t\t\tmessage: __('No payment methods found for the default POS Profile.'),\n\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\t// Identify the default payment method\n\t\t\t\tconst default_method = payments.find(pay => pay.default);\n\t\t\t\tif (default_method) {\n\t\t\t\t\tdefault_payment_method = default_method.mode_of_payment;\n\t\t\t\t\tconsole.log(\"Default payment method:\", default_payment_method);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\t\tmessage: __('No default payment method is set.'),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.error(\"Error fetching POS Profile:\", err);\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\tmessage: __('Failed to fetch payment methods. Please try again.'),\n\t\t\t\t\tindicator: 'red'\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t\n\t\t// Table for Denominations\n\t\tconst denomination_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"denomination\",\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tlabel: \"Denomination (DA)\",\n\t\t\t\tin_list_view: 1,\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"quantity\",\n\t\t\t\tfieldtype: \"Int\",\n\t\t\t\tlabel: \"Quantity\",\n\t\t\t\tin_list_view: 1,\n\t\t\t\tdefault: 0,\n\t\t\t\tonchange: function () {\n\t\t\t\t\tconsole.log(\"on change\")\n\t\t\t\t\tconst total = dialog.fields_dict.denomination_details.grid.get_data().reduce((sum, row) => {\n\t\t\t\t\t\treturn sum + (parseInt(row.denomination) * (row.quantity || 0));\n\t\t\t\t\t}, 0);\n\t\t\t\t\tdialog.fields_dict.total_amount.set_value(total);\n\t\t\t\t},\n\t\t\t\tonblur: function () {  // Trigger when leaving the cell\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(\"on blur\")\n\t\t\t\t\tconst total = dialog.fields_dict.denomination_details.grid.get_data().reduce((sum, row) => {\n\t\t\t\t\t\treturn sum + (parseInt(row.denomination) * (row.quantity || 0));\n\t\t\t\t\t}, 0);\n\t\t\t\t\tdialog.fields_dict.total_amount.set_value(total);\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Create POS Opening Entry\"),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"denomination_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Denomination Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: denominations.map(denom => ({\n\t\t\t\t\t\tdenomination: denom.toString(),\n\t\t\t\t\t\tquantity: 0,\n\t\t\t\t\t})),\n\t\t\t\t\tfields: denomination_fields,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\tfieldname: \"total_amount\",\n\t\t\t\t\tlabel: \"Total Amount\",\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tdefault: 0,\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: async function () {\n\t\t\t\tconst total_amount = dialog.fields_dict.total_amount.get_value();\n\t\n\t\t\t\tif (!default_payment_method) {\n\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\t\tmessage: __('No default payment method set. Please configure it in POS Profile.'),\n\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\n\t\t\t\tif (total_amount <= 0) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Please enter quantities for denominations.\"),\n\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t});\n\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t}\n\t\n\t\t\t\tconst balance_details = [{\n\t\t\t\t\tmode_of_payment: default_payment_method,\n\t\t\t\t\topening_amount: total_amount\n\t\t\t\t}];\n\t\n\t\t\t\tconst method = \"erpnext.selling.page.point_of_sale.point_of_sale.create_opening_voucher\";\n\t\t\t\tconst res = await frappe.call({\n\t\t\t\t\tmethod,\n\t\t\t\t\targs: { \n\t\t\t\t\t\tpos_profile: default_pos_profile, \n\t\t\t\t\t\tcompany: default_company, \n\t\t\t\t\t\tbalance_details \n\t\t\t\t\t},\n\t\t\t\t\tfreeze: true,\n\t\t\t\t});\n\t\n\t\t\t\tif (!res.exc) {\n\t\t\t\t\tme.prepare_app_data(res.message);\n\t\t\t\t\tObject.assign(me.POSOpeningEntry, { \n\t\t\t\t\t\t'name': res.message.name, \n\t\t\t\t\t\t'pos_profile': res.message.pos_profile, \n\t\t\t\t\t\t'period_start_date': res.message.period_start_date, \n\t\t\t\t\t\t'company': res.message.company \n\t\t\t\t\t});\n\t\t\t\t\tme.db.updateCheckInOutSync(me.POSOpeningEntry.period_start_date);\n\t\t\t\t\tme.check_in_out_cart.getAllCheckInOut();\n\t\t\t\t\tdialog.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t});\n\t\t\n\n\n\n\t\t\n\t\tdialog.show();\n\n\n\t\tdialog.get_field(\"denomination_details\").grid.wrapper.on(\"keydown\", \"input[data-fieldname='quantity']\", (e) => {\n\t\t\tconsole.log(\"Keydown event outside => \", e.key  ,  \"which : \" , e.which);\n\t\t\tif (e.which === 40 || e.which === 38) {  // 40 = ArrowDown, 38 = ArrowUp\n\t\t\t\tconsole.log(\"Keydown event:\", e.key);\n\n\t\t\t\tconst grid = dialog.get_field(\"denomination_details\").grid;\n\t\t\t\tconst row = $(e.target).closest(\".grid-row\");\n\t\t\t\tconst doc = grid.get_row(row.attr(\"data-idx\") - 1).doc;\n\t\t\t\tconst value = parseInt(e.target.value) || 0;\n\t\t\n\t\t\t\tconsole.log(\"Saving value:\", value, \"for denomination:\", doc.denomination);\n\t\t\n\t\t\t\t// Directly update the doc and refresh field to save the value\n\t\t\t\tdoc.quantity = value;\n\t\t\t\tgrid.refresh_field(\"quantity\");  // Force-save the current field value\n\t\t\n\t\t\t\t// Update the total amount immediately\n\t\t\t\tconst total = grid.get_data().reduce((sum, row) => {\n\t\t\t\t\treturn sum + (parseInt(row.denomination) * (row.quantity || 0));\n\t\t\t\t}, 0);\n\t\t\t\tdialog.fields_dict.total_amount.set_value(total);\n\t\t\t}\n\t\t});\n\t\t\n\t\n\t\t// Fetch default payment method immediately after dialog is shown\n\t\tfetch_default_payment_method();\n\t}\n\n\t\n\n\tset_right_and_left_sections() {\n\t\tthis.$components_wrapper.append('<div id=\"LeftSection\" class=\"columnBoxReverse\"></div>')\n\t\tthis.$components_wrapper.append('<div id=\"RightSection\" class=\"columnBox\"></div>')\n\n\t\tthis.$rightSection = this.$components_wrapper.find(\"#RightSection\")\n\t\tthis.$leftSection = this.$components_wrapper.find(\"#LeftSection\")\n\n\t}\n\n\n\tinit_customer_box() {\n\t\tthis.customer_box = new pos_ar.PointOfSale.pos_customer_box(\n\t\t\tthis.$leftSection,\n\t\t\tthis.appData.appData.customers,\n\t\t\tthis.defaultCustomer,\n\t\t\t() => {\n\t\t\t\tthis.screenManager.navigate(\"home\");\n\t\t\t},\n\t\t\tthis.onSync.bind(this),\n\t\t\tthis.saveCheckInOut.bind(this),\n\t\t\tthis.onMenuClick.bind(this),\n\t\t\t() => {\n\t\t\t\tthis.screenManager.navigate(\"debt_cart\");\n\t\t\t},\n\t\t\t(pos)=>{\n\t\t\t\tthis.history_cart.print_receipt(pos)\n\t\t\t}\n\t\t)\n\n\t\tthis.screenManager.registerScreen(\"customer_box\", this.customer_box);\n\t\tthis.screenManager.customer_box = this.customer_box;\n\t}\n\n\n\tinit_item_selector() {\n\n\t\tthis.item_selector = new pos_ar.PointOfSale.pos_item_selector(\n\t\t\tthis.$leftSection,\n\t\t\tthis.appData.appData.items,\n\t\t\tthis.appData.appData.item_barcodes,\n\t\t\tthis.appData.appData.item_groups,\n\t\t\tthis.appData.appData.item_prices,\n\t\t\tthis.settings_data.settings,\n\t\t\tthis.defaultPriceList,\n\t\t\tthis.getItemPrice.bind(this),\n\t\t\tthis.auto_select.bind(this),\n\t\t\titem => { this.itemClick_selector(item) }\n\t\t)\n\n\t\tthis.screenManager.registerScreen(\"item_selector\", this.item_selector);\n\t\tthis.screenManager.item_selector = this.item_selector;\n\t}\n\n\tinit_selected_item() {\n\t\tthis.selected_item_cart = new pos_ar.PointOfSale.pos_selected_item_cart(\n\t\t\tthis.$rightSection,\n\t\t\tthis.settings_data,\n\t\t\tthis.selectedItemMaps,\n\t\t\tthis.appData.appData.price_lists,\n\t\t\tthis.appData.appData.customers,\n\t\t\tthis.appData.brands,\n\t\t\tthis.taxes_and_charges,\n\t\t\tthis.invoiceData,\n\t\t\tthis.selectedTab,\n\t\t\tthis.selectedItem,\n\t\t\tthis.selectedField,\n\t\t\tthis.getItemPrice.bind(this),\n\t\t\titem => {\n\t\t\t\tthis.onSelectedItemClick(item)\n\t\t\t},\n\t\t\ttab => {\n\t\t\t\tthis.screenManager.navigate('home')\n\t\t\t},\n\t\t\t(action, key) => {\n\t\t\t\tthis.onKeyPressed(action, key)\n\t\t\t},\n\t\t\tthis.createNewTab.bind(this),\n\t\t\t() => {\n\t\t\t\tthis.savePosInvoice()\n\t\t\t\tthis.screenManager.navigate(\"payment_cart\");\n\t\t\t},\n\t\t\tthis.savePosInvoice.bind(this),\n\t\t\tthis.db\n\t\t)\n\t\tthis.screenManager.registerScreen(\"selected_item_cart\", this.selected_item_cart);\n\t\tthis.screenManager.selected_item_cart = this.selected_item_cart;\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new pos_ar.PointOfSale.pos_item_details(\n\t\t\tthis.$leftSection,\n\t\t\tthis.appData.appData.pos_profile.warehouse,\n\t\t\tthis.appData.appData.price_lists,\n\t\t\tthis.appData.appData.item_prices,\n\t\t\tthis.appData.appData.bins,\n\t\t\tthis.selectedItem,\n\t\t\tthis.selectedField,\n\t\t\t(event, field, value) => {\n\t\t\t\tthis.onInput(event, field, value);\n\t\t\t},\n\t\t\t() => {\n\t\t\t\tthis.screenManager.navigate('home');\n\t\t\t}\n\t\t)\n\t\tthis.screenManager.registerScreen(\"item_details\", this.item_details);\n\t\tthis.screenManager.item_details = this.item_details;\n\t}\n\n\n\tinit_paymentCart() {\n\t\tthis.payment_cart = new pos_ar.PointOfSale.pos_payment_cart(\n\t\t\tthis.$leftSection,\n\t\t\tthis.selectedItemMaps,\n\t\t\tthis.selectedTab,\n\t\t\tthis.appData.appData,\n\t\t\tthis.appData.appData.pos_profile.payments,\n\t\t\tthis.selectedPaymentMethod,\n\t\t\tthis.invoiceData,\n\t\t\t() => {\n\t\t\t\tthis.screenManager.navigate('home');\n\t\t\t},\n\t\t\tthis.onCompleteOrder.bind(this),\n\t\t\t(event, field, value) => {\n\t\t\t\tthis.onInput(event, field, value);\n\t\t\t},\n\t\t)\n\t\tthis.screenManager.registerScreen(\"payment_cart\", this.payment_cart);\n\t\tthis.screenManager.payment_cart = this.payment_cart;\n\t}\n\n\tinit_historyCart() {\n\t\tthis.history_cart = new pos_ar.PointOfSale.pos_history(\n\t\t\tthis.wrapper,\n\t\t\tthis.db,\n\t\t\tthis.appData.appData.pos_profile,\n\t\t\tthis.appData,\n\t\t\tthis.settings_data,\n\t\t\tthis.company,\n\t\t\tthis.taxes_and_charges,\n\t\t\tthis.historyCartClick.bind(this)\n\t\t)\n\t\tthis.screenManager.registerScreen(\"history_cart\", this.history_cart);\n\t\tthis.screenManager.history_cart = this.history_cart;\n\t}\n\n\tinit_checkInOutCart() {\n\t\tthis.check_in_out_cart = new pos_ar.PointOfSale.pos_check_in_out(\n\t\t\tthis.wrapper,\n\t\t\tthis.db\n\t\t)\n\t\tthis.screenManager.registerScreen(\"check_in_out_cart\", this.check_in_out_cart);\n\t\tthis.screenManager.check_in_out_cart = this.check_in_out_cart;\n\t}\n\n\tinit_debtCart() {\n\t\tthis.debt_cart = new pos_ar.PointOfSale.pos_debt_cart(\n\t\t\tthis.wrapper,\n\t\t\tthis.appData,\n\t\t\t() => {\n\t\t\t\tthis.check_in_out_cart.getAllCheckInOut();\n\t\t\t}\n\t\t)\n\t\tthis.screenManager.registerScreen(\"debt_cart\", this.debt_cart);\n\t\tthis.screenManager.debt_cart = this.debt_cart;\n\t}\n\n\n\tinit_settingsCart() {\n\t\tthis.settings_cart = new pos_ar.PointOfSale.pos_settings(\n\t\t\tthis.wrapper,\n\t\t\tthis.settings_data,\n\t\t\tthis.appData.appData.pos_profile,\n\t\t\tthis.onSettingsChange.bind(this)\n\t\t)\n\t\tthis.screenManager.registerScreen(\"settings_cart\", this.settings_cart);\n\t\tthis.screenManager.settings_cart = this.settings_cart;\n\t}\n\n\tinit_unsyncedPosCart() {\n\t\tthis.unsynced_pos_cart = new pos_ar.PointOfSale.pos_unsynced_cart(\n\t\t\tthis.wrapper,\n\t\t\tthis.appData,\n\t\t\tthis.db,\n\t\t\t(invoice) => {\n\t\t\t\tconst tab = this.selected_item_cart.createTabForEditPOS()\n\n\t\t\t\tthis.selectedItemMaps.set(`C${tab}`, invoice)\n\t\t\t\tthis.selectedTab.tabName = `C${tab}`\n\n\t\t\t\tthis.screenManager.navigate('home')\n\t\t\t}, () => {\n\t\t\t\tif (this.unsyncedPos >= 1) {\n\t\t\t\t\tthis.customer_box.setSynced();\n\t\t\t\t\tthis.unsyncedPos = 0\n\t\t\t\t} else {\n\t\t\t\t\tthis.unsyncedPos -= 1;\n\t\t\t\t\tthis.customer_box.setNotSynced(this.unsyncedPos);\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\tthis.screenManager.registerScreen(\"unsynced_pos_cart\", this.unsynced_pos_cart);\n\t\tthis.screenManager.unsynced_pos_cart = this.unsynced_pos_cart;\n\t}\n\n\n\n\t/**************************  callbacks functions ******************************/\n\n\n\titemClick_selector(item, refresh) {\n\n\t\tthis.syncInput = false\n\n\t\tconst itemCloned = structuredClone(item);\n\n\t\titemCloned.discount_amount = 0;\n\t\titemCloned.discount_percentage = 0;\n\n\t\tObject.assign(this.selectedItem, itemCloned)\n\n\t\tthis.addItemToPosInvoice(itemCloned)\n\n\t\tthis.selected_item_cart.calculateNetTotal();\n\t\tthis.selected_item_cart.calculateVAT();\n\t\tthis.selected_item_cart.calculateQnatity();\n\t\tthis.selected_item_cart.calculateGrandTotal();\n\t\tthis.selected_item_cart.refreshSelectedItem();\n\n\t\tif (refresh) {\n\t\t\tthis.item_selector.refreshItemSelector()\n\t\t}\n\n\t\tthis.selectedField.field_name = \"quantity\"\n\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\n\t\tthis.selected_item_cart.scrollToBottom()\n\n\t\tthis.savePosInvoice()\n\t}\n\n\n\tonSelectedItemClick(item) {\n\t\tthis.syncInput = false\n\t\tconst clonedItem = structuredClone(item)\n\t\tObject.assign(this.selectedItem, clonedItem)\n\n\t\tthis.selectedField.field_name = \"quantity\"\n\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\n\t\tthis.screenManager.navigate(\"item_details\");\n\n\t\t//refresh data\n\t\tthis.item_details.refreshDate(item);\n\t}\n\n\n\tsaveCheckInOut(checkInOut) {\n\t\tcheckInOut.is_sync = 0;\n\t\tthis.appData.saveCheckInOut(\n\t\t\tcheckInOut,\n\t\t\t(res) => {\n\t\t\t\tthis.check_in_out_cart.getAllCheckInOut();\n\t\t\t}, (err) => {\n\t\t\t\tconsole.log('err to save checkInOut : ', err)\n\t\t\t}\n\t\t)\n\t}\n\n\n\tonSettingsChange(settingName) {\n\t\t\t//refreshing selected_item_cart and item_selector_cart\n\t\t\tthis.item_selector.refreshItemSelector();\n\t\t\t//recalculate price\n\t\t\tthis.selected_item_cart.resetItemRateBaseOnPriceList()\n\t\t\t//redraw\n\t\t\tthis.selected_item_cart.refreshSelectedItem()\n\t}\n\n\n\tsavePosInvoice(saveWithZeroRate) {\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).synced = false;\n\t\tconsole.log(\"savePosInvoice : \", this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\tthis.appData.savePosInvoice(this.selectedItemMaps.get(this.selectedTab.tabName))\n\n\t}\n\n\n\tauto_select(item) {\n\t\tthis.itemClick_selector(item)\n\t\tthis.item_selector.refresh()\n\t}\n\n\n\n\tonMenuClick(menu) {\n\t\tif (menu == 'recent_pos') {\n\t\t\tthis.screenManager.navigate(\"history_cart\");\n\t\t}\n\t\telse if (menu == 'close_pos') {\n\t\t\tthis.onClosePOS()\n\t\t}\n\t\telse if (menu == 'unsenced_invoices') {\n\t\t\tthis.screenManager.navigate(\"unsynced_pos_cart\");\n\t\t}\n\t\telse if (menu == 'settings') {\n\t\t\tthis.screenManager.navigate(\"settings_cart\");\n\t\t}\n\t\telse if (menu == 'checkInOut') {\n\t\t\tthis.screenManager.navigate(\"check_in_out_cart\");\n\t\t}\n\t}\n\n\tgetDefaultPaymentMethod() {\n\t\tlet result = null;\n\t\tthis.appData.appData.pos_profile.payments.forEach(method => {\n\t\t\tif (method.default) {\n\t\t\t\tresult = method\n\t\t\t}\n\t\t})\n\n\t\treturn result\n\t}\n\n\tgetPaymentMethods() {\n\t\tlet result = [];\n\t\tthis.appData.appData.pos_profile.payments.forEach(method => {\n\t\t\tresult.push({ 'mode_of_payment': method.mode_of_payment, 'default': method.default, 'amount': 0 })\n\t\t})\n\t\treturn result\n\t}\n\n\trestorePosInvoices(posInvoices) {\n\t\tposInvoices.forEach((pos) => {\n\t\t\tconst tab = this.selected_item_cart.createTabForEditPOS()\n\t\t\tthis.selectedItemMaps.set(`C${tab}`, pos)\n\t\t\tthis.selectedTab.tabName = `C${tab}`\n\t\t})\n\t\tthis.screenManager.navigate('home')\n\t}\n\n\tcreateNewTab(counter) {\n\n\t\tlet new_pos_invoice = frappe.model.get_new_doc('POS Invoice');\n\t\tnew_pos_invoice.customer = this.defaultCustomer.name\n\t\tnew_pos_invoice.pos_profile = this.appData.appData.pos_profile.name\n\t\tnew_pos_invoice.items = [];\n\t\tnew_pos_invoice.taxes_and_charges = this.appData.appData.pos_profile.taxes_and_charges\n\t\tnew_pos_invoice.additional_discount_percentage = 0\n\t\tnew_pos_invoice.paid_amount = 0\n\t\tnew_pos_invoice.base_paid_amount = 0\n\t\tnew_pos_invoice.creation_time = frappe.datetime.now_datetime()\n\t\tnew_pos_invoice.payments = this.getPaymentMethods()\n\t\tnew_pos_invoice.is_pos = 1\n\t\tnew_pos_invoice.update_stock = 1\n\t\tnew_pos_invoice.docstatus = 0\n\t\tnew_pos_invoice.synced = false\n\t\tnew_pos_invoice.status = 'Draft'\n\t\tnew_pos_invoice.priceList = this.defaultPriceList.name\n\t\tnew_pos_invoice.opened = 1\n\t\t//build refNm   posProfile-date-time\n\t\tconst date = new Date()\n\t\tconst [year, month, day] = date.toISOString().split('T')[0].split('-')\n\t\tconst hour = date.getHours()\n\t\tconst minutes = date.getMinutes()\n\t\tconst seconds = date.getMilliseconds()\n\t\tnew_pos_invoice.refNum = this.appData.appData.pos_profile.name + \"-\" + year + '-' + month + '-' + day + '-' + hour + minutes + seconds\n\t\tnew_pos_invoice.custom_cach_name = new_pos_invoice.refNum\n\n\t\tthis.selectedItemMaps.set(`C${counter}`, new_pos_invoice)\n\t\tthis.selectedTab.tabName = `C${counter}`\n\n\n\t\tthis.screenManager.navigate('home')\n\t}\n\n\n\thistoryCartClick(event, message) {\n\t\t//go back to edit pos draft\n\t\tif (event == 'edit') {\n\t\t\tconst tab = this.selected_item_cart.createTabForEditPOS()\n\n\t\t\tthis.selectedItemMaps.set(`C${tab}`, message)\n\t\t\tthis.selectedTab.tabName = `C${tab}`\n\n\t\t\tthis.screenManager.navigate('home')\n\t\t} else if (event == 'duplicate') {\n\t\t\tconst tab = this.selected_item_cart.createTabForEditPOS()\n\n\t\t\tmessage.name = frappe.model.get_new_doc('POS Invoice').name;\n\t\t\tmessage.pos_profile = this.appData.appData.pos_profile.name\n\t\t\tmessage.taxes_and_charges = this.appData.appData.pos_profile.taxes_and_charges\n\t\t\tmessage.creation_time = frappe.datetime.now_datetime()\n\t\t\tmessage.payments = this.getPaymentMethods()\n\t\t\tmessage.priceList = this.defaultPriceList.name\n\t\t\t//build refNm   posProfile-date-time\n\t\t\tconst date = new Date()\n\t\t\tconst [year, month, day] = date.toISOString().split('T')[0].split('-')\n\t\t\tconst hour = date.getHours()\n\t\t\tconst minutes = date.getMinutes()\n\t\t\tconst seconds = date.getMilliseconds()\n\t\t\tmessage.refNum = this.appData.appData.pos_profile.name + \"-\" + year + '-' + month + '-' + day + '-' + hour + minutes + seconds\n\t\t\tmessage.custom_cach_name = message.refNum\n\n\t\t\tthis.selectedItemMaps.set(`C${tab}`, message)\n\t\t\tthis.selectedTab.tabName = `C${tab}`\n\n\t\t\tthis.screenManager.navigate('home')\n\t\t}\n\t\telse if (event == 'return') {\n\t\t\tconst tab = this.selected_item_cart.createTabForEditPOS()\n\n\t\t\tconst returnedPosInvoice = this.makePosInvoiceReturn(message)\n\t\t\tthis.selectedItemMaps.set(`C${tab}`, returnedPosInvoice)\n\t\t\tthis.selectedTab.tabName = `C${tab}`\n\n\t\t\tthis.screenManager.navigate('home')\n\t\t}\n\t}\n\n\tonInput(event, field, value) {\n\n\t\tif (event == \"focus\" || event == \"blur\") {\n\t\t\tif (event == \"focus\")\n\t\t\t\tObject.assign(this.selectedField, { field_name: field })\n\t\t\tif (event == \"blur\")\n\t\t\t\tObject.assign(this.selectedField, { field_name: null })\n\n\t\t\tthis.item_details.makeSelectedFieldHighlighted()\n\t\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (field == \"quantity\") {\n\t\t\tthis.selectedItem.qty = parseFloat(value);\n\t\t\tthis.editPosItemQty(this.selectedItem.name, this.selectedItem.qty);\n\n\t\t\t//redrawing\n\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t}\n\t\telse if (field == \"rate\") {\n\t\t\tthis.selectedItem.rate = parseFloat(value);\n\n\t\t\t//recalculate the rate\n\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\tlet persont = this.selectedItem.discount_percentage\n\t\t\tlet montant = oldRate * (persont / 100)\n\n\t\t\tthis.selectedItem.discount_percentage = persont;\n\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\tthis.editPosItemRate(this.selectedItem.name, this.selectedItem.rate);\n\n\t\t\t//redrawing\n\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\tthis.item_details.refreshDate(this.selectedItem);\n\n\t\t}\n\t\telse if (field == \"discount_percentage\") {\n\n\t\t\t//recalculate the rate\n\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\tlet montant = oldRate * (parseFloat(value) / 100)\n\n\t\t\tthis.selectedItem.discount_percentage = parseFloat(value);\n\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\tthis.editPosItemDiscountPercentage(this.selectedItem.name, this.selectedItem.discount_percentage);\n\n\t\t\t//redrawing\n\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\tthis.item_details.refreshDate(this.selectedItem);\n\t\t}\n\t\telse if (field == \"discount_amount\") {\n\n\t\t\t//recalculate the rate\n\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\tlet persent = ((parseFloat(value) * 100) / oldRate).toFixed(2);\n\t\t\tlet montant = parseFloat(value);\n\t\t\t//prevent negatif result\n\t\t\tif (persent > 100) {\n\t\t\t\tpersent = 100;\n\t\t\t}\n\t\t\tif (parseFloat(value) > oldRate) {\n\t\t\t\tmontant = oldRate;\n\t\t\t}\n\n\t\t\tthis.selectedItem.discount_percentage = parseFloat(persent);\n\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\tthis.editPosItemDiscountPercentage(this.selectedItem.name, this.selectedItem.discount_percentage);\n\n\t\t\t//redrawing\n\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\tthis.item_details.refreshDate(this.selectedItem);\n\n\t\t}\n\n\t\tthis.savePosInvoice()\n\t}\n\n\n\n\n\tonKeyPressed(action, key) {\n\n\t\tif (action == \"quantity\") {\n\t\t\tthis.selectedField.field_name = \"quantity\"\n\t\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\t\t\t//this.item_details.requestFocus(\"quantity\")\n\t\t}\n\t\telse if (action == \"rate\") {\n\t\t\tthis.selectedField.field_name = \"rate\"\n\t\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\t\t\t//this.item_details.requestFocus(\"rate\")\n\t\t}\n\t\telse if (action == \"minus\") {\n\t\t\tthis.syncInput = true\n\t\t\tconst newValue = parseFloat(this.selectedItem.qty) * -1\n\t\t\tthis.selectedItem.qty = parseFloat(newValue);\n\t\t\tthis.editPosItemQty(this.selectedItem.name, this.selectedItem.qty);\n\t\t\t//redrawing\n\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t}\n\t\telse if (action == \"print\") {\n\t\t\tthis.history_cart.print_receipt(structuredClone(this.selectedItemMaps.get(this.selectedTab.tabName)))\n\n\n\t\t\t//update the ui\n\t\t\tthis.selected_item_cart.refreshSelectedItem()\n\t\t\tthis.item_details.refreshDate(this.selectedItem);\n\n\t\t\tthis.savePosInvoice()\n\n\t\t\treturn\n\t\t\t//this.item_details.requestFocus(\"discount_percentage\")\n\t\t}\n\t\telse if (action == \"remove\") {\n\t\t\tthis.syncInput = false;\n\n\t\t\tthis.deleteItemFromPOsInvoice(this.selectedItem.name);\n\n\t\t}\n\t\telse if (action == \"delete\") {\n\n\n\t\t\t//check if the details cart is appear\n\t\t\tif (!this.settings_data.settings.showItemDetails) {\n\t\t\t\tif (this.selectedField.field_name == \"quantity\") {\n\t\t\t\t\tconst oldValue = parseFloat(this.selectedItem.qty)\n\t\t\t\t\tconst newValue = `${oldValue}`.slice(0, -1)\n\t\t\t\t\tthis.selectedItem.qty = parseFloat(newValue) || 0;\n\t\t\t\t}\n\t\t\t\telse if (this.selectedField.field_name == \"rate\") {\n\t\t\t\t\tconst oldValue = parseFloat(this.selectedItem.rate)\n\t\t\t\t\tconst newValue = `${oldValue}`.slice(0, -1)\n\n\t\t\t\t\tthis.selectedItem.rate = parseFloat(newValue) || 0;\n\n\t\t\t\t\t//recalculate the rate\n\t\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\t\tlet persont = this.selectedItem.discount_percentage\n\t\t\t\t\tlet montant = oldRate * (persont / 100)\n\n\t\t\t\t\tthis.selectedItem.discount_percentage = persont;\n\t\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\t\t\tthis.editPosItemRate(this.selectedItem.name, this.selectedItem.rate);\n\n\t\t\t\t}\n\t\t\t\telse if (this.selectedField.field_name == \"discount_percentage\") {\n\t\t\t\t\t//recalculate the rate\n\t\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\t\tlet old_percentage = this.selectedItem.discount_percentage ?? 0;\n\t\t\t\t\tlet input = `${old_percentage}` + key;\n\t\t\t\t\tlet discount_percentage = parseFloat(input);\n\t\t\t\t\tif (discount_percentage > 100) {\n\t\t\t\t\t\tdiscount_percentage = 100;\n\t\t\t\t\t}\n\t\t\t\t\tlet montant = oldRate * (discount_percentage / 100)\n\t\t\t\t\tlet newRate = oldRate - montant\n\n\n\t\t\t\t\tthis.selectedItem.discount_percentage = (discount_percentage);\n\t\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\n\t\t\tlet newValue = parseFloat(this.item_details.deleteCharacter())\n\n\t\t\tif (this.selectedField.field_name == \"quantity\") {\n\t\t\t\tthis.selectedItem.qty = newValue;\n\t\t\t}\n\t\t\telse if (this.selectedField.field_name == \"rate\") {\n\n\t\t\t\tthis.selectedItem.rate = newValue;\n\n\t\t\t\t//recalculate the rate\n\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\tlet persont = this.selectedItem.discount_percentage\n\t\t\t\tlet montant = oldRate * (persont / 100)\n\n\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t}\n\t\t\telse if (this.selectedField.field_name == \"discount_percentage\") {\n\t\t\t\t//recalculate the rate\n\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\tlet montant = oldRate * (newValue / 100)\n\n\t\t\t\tthis.selectedItem.discount_percentage = newValue;\n\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t}\n\t\t\telse if (this.selectedField.field_name == \"discount_percentage\") {\n\t\t\t\t//recalculate the rate\n\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\tlet montant = oldRate * (newValue / 100)\n\n\t\t\t\t//asign the values to the selectedItem refrence\n\t\t\t\tthis.selectedItem.discount_percentage = newValue;\n\t\t\t\tthis.selectedItem.discount_rate = montant;\n\n\t\t\t}\n\t\t\telse if (this.selectedField.field_name == \"cash\") {\n\t\t\t\tthis.payment_cart.deleteKeyPress();\n\t\t\t}\n\n\n\n\t\t}\n\t\telse if (action == \"addToField\") {\n\n\t\t\tif (this.selectedField.field_name == \"cash\") {\n\t\t\t\tthis.payment_cart.handleInput(key);\n\t\t\t}\n\t\t\telse {\n\n\t\t\t\tif (this.selectedField.field_name == \"quantity\") {\n\t\t\t\t\tlet oldValue = 0\n\t\t\t\t\tif (!this.syncInput) {\n\t\t\t\t\t\toldValue = 0\n\t\t\t\t\t\tthis.syncInput = true\n\t\t\t\t\t} else {\n\t\t\t\t\t\toldValue = parseFloat(this.selectedItem.qty)\n\t\t\t\t\t}\n\t\t\t\t\tconst newValue = `${oldValue}` + key\n\t\t\t\t\tthis.selectedItem.qty = parseFloat(newValue);\n\t\t\t\t}\n\t\t\t\telse if (this.selectedField.field_name == \"rate\") {\n\t\t\t\t\tlet lastValue = 0\n\t\t\t\t\tif (!this.syncInput) {\n\t\t\t\t\t\tlastValue = 0\n\t\t\t\t\t\tthis.syncInput = true\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlastValue = parseFloat(this.selectedItem.rate)\n\t\t\t\t\t}\n\t\t\t\t\tconst newValue = `${lastValue}` + key\n\t\t\t\t\tthis.selectedItem.rate = parseFloat(newValue);\n\n\t\t\t\t\t//recalculate the rate\n\t\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\t\tlet persont = this.selectedItem.discount_percentage\n\t\t\t\t\tlet montant = oldRate * (persont / 100)\n\n\t\t\t\t\tthis.selectedItem.discount_percentage = persont;\n\t\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\t\t\tthis.editPosItemRate(this.selectedItem.name, this.selectedItem.rate);\n\n\t\t\t\t}\n\t\t\t\telse if (this.selectedField.field_name == \"discount_percentage\") {\n\t\t\t\t\t//recalculate the rate\n\t\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\t\tlet old_percentage = this.selectedItem.discount_percentage ?? 0;\n\t\t\t\t\tlet input = `${old_percentage}` + key;\n\t\t\t\t\tlet discount_percentage = parseFloat(input);\n\t\t\t\t\tif (discount_percentage > 100) {\n\t\t\t\t\t\tdiscount_percentage = 100;\n\t\t\t\t\t}\n\t\t\t\t\tlet montant = oldRate * (discount_percentage / 100)\n\t\t\t\t\tlet newRate = oldRate - montant\n\n\n\t\t\t\t\tthis.selectedItem.discount_percentage = (discount_percentage);\n\t\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\n\t\t}\n\n\n\t\t//update the posInvoice\n\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\tthis.editPosItemRate(this.selectedItem.name, this.selectedItem.rate);\n\t\tthis.editPosItemQty(this.selectedItem.name, this.selectedItem.qty);\n\n\t\t//update the ui\n\t\tthis.selected_item_cart.refreshSelectedItem()\n\t\tthis.item_details.refreshDate(this.selectedItem);\n\n\t\tthis.savePosInvoice()\n\n\n\t}\n\n\n\tonCompleteOrder() {\n\n\t\tthis.payment_cart.show_waiting()\n\n\t\tthis.savePosInvoice()\n\n\t\t//check if they set a customer\n\t\tif (this.defaultCustomer.name == \"\") {\n\t\t\tfrappe.warn(\n\t\t\t\t'Customer didnt selected!',\n\t\t\t\t'you have to select a customer',\n\t\t\t\t() => {\n\t\t\t\t},\n\t\t\t\t'Done',\n\t\t\t\tfalse\n\t\t\t)\n\t\t\treturn;\n\t\t}\n\t\tlet items = []\n\t\tlet is_return = 1;\n\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).items.forEach(item => {\n\t\t\t// we still didnt implement the  base_paid_amount and amount_eligible_for_commissionseen\n\t\t\t// value in deafault pos ==>  [\"Administrator\"]. i think it is an array.\n\t\t\tlet newItem = {\n\t\t\t\t'item_name': item.item_name,\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'rate': item.rate,\n\t\t\t\t'qty': item.qty,\n\t\t\t\t'description': item.description,\n\t\t\t\t'image': item.image,\n\t\t\t\t'use_serial_batch_fields': 1,\n\t\t\t\t'cost_center': this.appData.appData.pos_profile.cost_center,\n\t\t\t\t'discount_percentage': item.discount_percentage,\n\t\t\t\t'discount_amount': item.discount_amount,\n\t\t\t\t'warehouse': this.appData.appData.pos_profile.warehouse,\n\t\t\t\t'income_account': this.appData.appData.pos_profile.income_account,\n\t\t\t}\n\t\t\titems.push(newItem)\n\t\t\tif (item.qty > 0)\n\t\t\t\tis_return = 0\n\t\t})\n\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).is_return = is_return\n\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).items = items\n\t\tif (items.length == 0)\n\t\t\treturn\n\n\t\tlet total = 0\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).items.forEach(item => {\n\t\t\ttotal += item.rate * item.qty\n\t\t})\n\n\t\tif (this.calculatePaidAmount(this.selectedItemMaps.get(this.selectedTab.tabName)) > total) {\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).paid_amount = total\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).base_paid_amount = total\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).outstanding_amount = 0\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).total_customer_payment = this.calculatePaidAmount(this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\t} else {\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).paid_amount = this.calculatePaidAmount(this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).base_paid_amount = this.calculatePaidAmount(this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).outstanding_amount = this.invoiceData.grandTotal - this.calculatePaidAmount(this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).total_customer_payment = this.calculatePaidAmount(this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\t}\n\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).docstatus = 1\n\n\t\t//set status\n\t\tconst status = this.checkIfPaid(this.selectedItemMaps.get(this.selectedTab.tabName))\n\t\tthis.selectedItemMaps.get(this.selectedTab.tabName).status = status\n\n\t\t//copy the pos is important otherwise it will deleted and the selectedTab change and then it will save the\n\t\t//wrong one. because insert take a while after the callback will called.\n\t\t//console.log(\"debuging rayan :::: \" , this.selected_item_cart)\n\n\n\t\tconst pos = structuredClone(this.selectedItemMaps.get(this.selectedTab.tabName))\n\n\t\t// Set custom_is_shared based on sendInvoiceToOtherPos setting\n\t\tpos.custom_is_shared = this.settings_data.settings.sendInvoiceToOtherPos ? 1 : 0;\n\n\t\tif (status == 'Unpaid') {\n\t\t\tpos.synced = true\n\n\t\t\tconsole.log(\"debuging rayan :::: \" , pos)\n\n\t\t\tfrappe.db.insert(\n\t\t\t\tpos\n\t\t\t).then(r => {\n\n\t\t\t\tthis.payment_cart.hide_waiting()\n\n\t\t\t\tpos.opened = 0;\n\t\t\t\tpos.real_name = r.name\n\n\t\t\t\tthis.history_cart.print_receipt(pos)\n\t\t\t\tthis.appData.updatePosInvoice(pos)\n\n\t\t\t\t/*** START : deleting pos when finishing **/\n\t\t\t\t//print the pos\n\n\t\t\t\tthis.selectedItemMaps.delete(this.selectedTab.tabName)\n\n\t\t\t\t//tabs\n\t\t\t\tlet tabs = Array.from(this.selectedItemMaps.keys())\n\t\t\t\t//if there are still tabs it will just set the first as selected\n\t\t\t\t//otherwise it will create one using the selected_item_cart class and set it as selected\n\t\t\t\tif (tabs.length > 0) {\n\t\t\t\t\tthis.selectedTab.tabName = tabs[0]\n\t\t\t\t\tthis.selected_item_cart.refreshTabs();\n\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.selected_item_cart.createNewTab();\n\t\t\t\t}\n\t\t\t\tthis.screenManager.navigate('home')\n\t\t\t\t/*** END   : deleting pos when finishing **/\n\n\n\t\t\t}).catch(err => {\n\t\t\t\tconsole.log(\"debuging rayan 22222222 :::: \" , pos)\n\t\t\t\tthis.payment_cart.hide_waiting()\n\t\t\t\tconsole.log(\"cant push pos invoice : \", err);\n\t\t\t})\n\t\t}\n\t\telse {\n\n\t\t\tthis.payment_cart.hide_waiting()\n\t\t\t/*** START : deleting pos when finishing **/\n\t\t\t//print the pos\n\t\t\tthis.history_cart.print_receipt(pos)\n\n\t\t\tthis.selectedItemMaps.delete(this.selectedTab.tabName)\n\n\t\t\t//tabs\n\t\t\tlet tabs = Array.from(this.selectedItemMaps.keys())\n\t\t\t//if there are still tabs it will just set the first as selected\n\t\t\t//otherwise it will create one using the selected_item_cart class and set it as selected\n\t\t\tif (tabs.length > 0) {\n\t\t\t\tthis.selectedTab.tabName = tabs[0]\n\t\t\t\tthis.selected_item_cart.refreshTabs();\n\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.selected_item_cart.createNewTab();\n\t\t\t}\n\t\t\tthis.screenManager.navigate('home')\n\t\t\t/*** END : deleting pos when finishing **/\n\n\n\t\t\tpos.synced = false;\n\t\t\tpos.opened = 0;\n\t\t\tthis.appData.updatePosInvoice(pos)\n\n\t\t\tthis.unsyncedPos += 1;\n\t\t\tthis.customer_box.setNotSynced(this.unsyncedPos);\n\t\t}\n\t}\n\n\n\tonSync() {\n\t\tif (this.POSOpeningEntry.name == '') {\n\t\t\tthis.checkForPOSEntry();\n\t\t\treturn;\n\t\t}\n\n\t\t//check if there is a pos to sync\n\t\tif (this.unsyncedPos <= 0) {\n\t\t\t// with options\n\t\t\tfrappe.msgprint({\n\t\t\t\ttitle: __('Sync Complete'),\n\t\t\t\tindicator: 'green',\n\t\t\t\tmessage: __('All data is already synchronized.')\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tlet counter = 0;\n\t\tlet failure = 0;\n\n\t\tthis.appData.getNotSyncedPos(\n\t\t\t(allUnsyncedPos) => {\n\t\t\t\t//create progress bar\n\t\t\t\tfrappe.show_progress('Syncing Invoices...', 0, allUnsyncedPos.length, 'syncing')\n\n\t\t\t\tallUnsyncedPos.forEach(pos => {\n\t\t\t\t\t// we still didnt implement the  base_paid_amount and amount_eligible_for_commissionseen\n\t\t\t\t\t// value in deafault pos ==>  [\"Administrator\"]. i think it is an array.\n\t\t\t\t\tfrappe.db.insert(\n\t\t\t\t\t\tpos\n\t\t\t\t\t).then(r => {\n\t\t\t\t\t\tconst updatedPos = structuredClone(pos)\n\t\t\t\t\t\tupdatedPos.synced = true;\n\t\t\t\t\t\tupdatedPos.real_name = r.name\n\t\t\t\t\t\tthis.appData.updatePosInvoice(updatedPos)\n\t\t\t\t\t\tcounter += 1;\n\t\t\t\t\t\tfrappe.show_progress('Syncing Invoices...', counter, allUnsyncedPos.length, 'syncing')\n\t\t\t\t\t\t//if the last pos save seccessfully then hide the progress bar\n\t\t\t\t\t\tif (counter == allUnsyncedPos.length) {\n\t\t\t\t\t\t\tfrappe.hide_progress();\n\t\t\t\t\t\t\tthis.customer_box.setSynced();\n\t\t\t\t\t\t\tthis.unsyncedPos = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(err => {\n\t\t\t\t\t\tcounter += 1;\n\t\t\t\t\t\tfailure += 1;\n\n\t\t\t\t\t\t//if the last pos save seccessfully then hide the progress bar\n\t\t\t\t\t\tif (counter == allUnsyncedPos.length) {\n\t\t\t\t\t\t\tfrappe.hide_progress();\n\t\t\t\t\t\t\tthis.customer_box.setSynced();\n\t\t\t\t\t\t\tthis.unsyncedPos = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tconsole.log(\"cant get the unseced POS from local\")\n\t\t\t}\n\t\t);\n\n\n\t}\n\n\n\t/***********************************************   tools  *************************************************/\n\n\tgetCustomerDefaultPriceList(customerId) {\n\t\tlet priceList = \"\"\n\t\tthis.appData.appData.customers.forEach(customer => {\n\t\t\tif (customer.name == customerId) {\n\t\t\t\tpriceList = customer.default_price_list\n\t\t\t}\n\t\t})\n\t\treturn priceList\n\t}\n\tcheckIfPaid(pos) {\n\n\t\tlet netTotal = 0;\n\t\tlet grandTotal = 0;\n\t\tlet allTaxes = 0;\n\t\tlet discount = 0;\n\n\t\t//net total\n\t\tpos.items.forEach(item => {\n\t\t\tnetTotal += item.qty * item.rate\n\t\t})\n\n\t\tthis.taxes_and_charges.forEach(tax => {\n\t\t\tallTaxes += (tax.rate / 100) * netTotal\n\t\t})\n\n\t\t//discount\n\t\tdiscount = (pos.additional_discount_percentage / 100) * netTotal\n\n\t\tgrandTotal = netTotal + allTaxes - discount\n\n\t\tif (pos.paid_amount == 0) {\n\t\t\treturn \"Unpaid\"\n\t\t}\n\t\telse if (pos.paid_amount < grandTotal) {\n\t\t\treturn \"Unpaid\"\n\t\t}\n\t\telse {\n\t\t\treturn \"Paid\"\n\t\t}\n\n\t}\n\n\n\tcheckIfRateZero(pos) {\n\t\treturn pos.items.some(item => item.rate == 0)\n\t}\n\n\n\tonClosePOS() {\n\t\t//check if you still have an invoice to sync\n\t\tif (this.unsyncedPos > 0) {\n\t\t\tfrappe.throw(__(`you have  some invoices to sync first.`))\n\t\t}\n\t\t//otherwise you can close the voucher\n\t\tlet voucher = frappe.model.get_new_doc(\"POS Closing Entry\");\n\t\tvoucher.pos_opening_entry = this.POSOpeningEntry.name;\n\t\tvoucher.pos_profile = this.POSOpeningEntry.pos_profile;\n\t\tvoucher.company = this.POSOpeningEntry.company;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\tvoucher.posting_time = frappe.datetime.now_time();\n\n\t\tconst unsyncedChecks = this.check_in_out_cart.checkList.filter(check => check.is_sync === 0);\n\t\tunsyncedChecks.forEach(check => {\n\t\t\tlet child = frappe.model.add_child(voucher, 'check_in_out', 'custom_check_in_out')\n\t\t\tchild.check_type = check.check_type\n\t\t\tchild.creation_time = check.creation_time\n\t\t\tchild.amount = check.amount\n\t\t\tchild.reason_note = check.reason_note\n\t\t\tchild.user = check.owner\n\t\t})\n\n\t\t//delete the open entry because you create the closing entry\n\t\tthis.POSOpeningEntry.name = '';\n\n\t\t// Clear main container and show refresh dialog\n\t\tthis.wrapper.html(\"\");\n\t\tconst dialog = $(`\n\t\t\t<div class=\"pos-profile-dialog d-flex flex-column align-items-center justify-content-center\" style=\"height: 100vh;\">\n\t\t\t\t<div class=\"alert alert-warning text-center\">\n\t\t\t\t\t<h3>${__('POS is Closed')}</h3>\n\t\t\t\t\t<p>${__('Please refresh the page after trying to close.')}</p>\n\t\t\t\t\t<button class=\"btn btn-primary mt-3\" onclick=\"location.reload()\">\n\t\t\t\t\t\t${__('Refresh Page')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t\tthis.wrapper.append(dialog);\n\n\t\t// Navigate to POS Closing Entry form\n\t\tfrappe.set_route(\"Form\", \"POS Closing Entry\", voucher.name).then(() => {\n\t\t\t// Block back navigation\n\t\t\twindow.addEventListener('popstate', (event) => {\n\t\t\t\tfrappe.set_route(\"Form\", \"POS Closing Entry\", voucher.name);\n\t\t\t});\n\t\t});\n\t}\n\n\n\t/****************************  listeners *******************************/\n\n\tsetListeners() {\n\t\twindow.addEventListener('offline', function () {\n\t\t\tfrappe.msgprint('you lose the connection (offline mode)')\n\t\t})\n\n\t\twindow.addEventListener('online', function () {\n\t\t\tfrappe.msgprint('the connection is back (online mode)')\n\t\t}\n\t\t)\n\t}\n\n\t/*****************************  tools  **********************************/\n\n\tmakePosInvoiceReturn(posInvoice) {\n\t\tlet invoice = structuredClone(posInvoice)\n\n\t\tlet new_name = frappe.model.get_new_doc('POS Invoice').name;\n\n\t\tinvoice.name = new_name\n\t\tinvoice.is_return = 1;\n\t\tinvoice.return_against = posInvoice.real_name\n\t\tinvoice.real_name = \"\"\n\t\tinvoice.consolidated_invoice = null\n\t\tinvoice.outstanding_amount = 0;\n\n\t\tlet newItems = []\n\t\tinvoice.items.forEach(item => {\n\t\t\tif (item.qty > 0) {\n\t\t\t\tlet newItem = structuredClone(item)\n\t\t\t\tnewItem.qty = newItem.qty * -1\n\t\t\t\tnewItem.description = \"Returned item\"\n\t\t\t\tnewItems.push(newItem)\n\t\t\t}\n\t\t})\n\t\tinvoice.items = newItems\n\n\n\t\tinvoice.pos_profile = this.appData.appData.pos_profile.name\n\t\tinvoice.taxes_and_charges = this.appData.appData.pos_profile.taxes_and_charges\n\t\tinvoice.creation_time = frappe.datetime.now_datetime()\n\t\tinvoice.payments = this.getPaymentMethods()\n\t\tinvoice.priceList = this.defaultPriceList.name\n\t\t//build refNm   posProfile-date-time\n\t\tconst date = new Date()\n\t\tconst [year, month, day] = date.toISOString().split('T')[0].split('-')\n\t\tconst hour = date.getHours()\n\t\tconst minutes = date.getMinutes()\n\t\tconst seconds = date.getMilliseconds()\n\t\tinvoice.refNum = this.appData.appData.pos_profile.name + \"-\" + year + '-' + month + '-' + day + '-' + hour + minutes + seconds\n\t\tinvoice.custom_cach_name = invoice.refNum\n\n\t\treturn invoice\n\t}\n\n\ttoggleKeyboardMode(active) {\n\n\n\t\tif (active) {\n\t\t\tdocument.addEventListener('keydown', event => {\n\t\t\t\t// Check if the user is typing in an input or textarea\n\t\t\t\tconst activeElement = document.activeElement;\n\t\t\t\tconst isInputFocused =\n\t\t\t\t\tactiveElement.tagName === \"INPUT\" ||\n\t\t\t\t\tactiveElement.tagName === \"TEXTAREA\" ||\n\t\t\t\t\tactiveElement.isContentEditable;\n\n\t\t\t\t// Ignore keydown events if the user is typing in a field\n\t\t\t\tif (isInputFocused) return;\n\n\t\t\t\tif (event.key == \"q\") {\n\t\t\t\t\tthis.selectedField.field_name = \"quantity\"\n\t\t\t\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\t\t\t\t} else if (event.key == \"p\") {\n\t\t\t\t\tthis.selectedField.field_name = \"rate\"\n\t\t\t\t\tthis.selected_item_cart.makeSelectedButtonHighlighted();\n\t\t\t\t} else if (event.key == \"Delete\") {\n\t\t\t\t\tthis.deleteItemFromPOsInvoice(this.selectedItem.name)\n\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t\tthis.screenManager.navigate('home')\n\n\t\t\t\t} else if (event.key == \"Backspace\") {\n\t\t\t\t\tif (this.selectedField.field_name == \"quantity\") {\n\t\t\t\t\t\tconst lastValue = parseFloat(this.selectedItem.qty)\n\t\t\t\t\t\tlet newValue = 0\n\n\t\t\t\t\t\t// Remove the last character and parse the remaining value\n\t\t\t\t\t\tnewValue = parseFloat(`${lastValue}`.slice(0, -1)) || 0;\n\n\t\t\t\t\t\tthis.selectedItem.qty = parseFloat(newValue);\n\t\t\t\t\t\tthis.editPosItemQty(this.selectedItem.name, this.selectedItem.qty);\n\t\t\t\t\t\t//redrawing\n\t\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t\t} else if (this.selectedField.field_name == \"rate\") {\n\t\t\t\t\t\tconst lastValue = parseFloat(this.selectedItem.rate)\n\t\t\t\t\t\tlet newValue = parseFloat(`${lastValue}`.slice(0, -1)) || 0;\n\t\t\t\t\t\tthis.selectedItem.rate = parseFloat(newValue);\n\n\t\t\t\t\t\t//recalculate the rate\n\t\t\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\t\t\tlet persont = this.selectedItem.discount_percentage\n\t\t\t\t\t\tlet montant = oldRate * (persont / 100)\n\n\t\t\t\t\t\tthis.selectedItem.discount_percentage = persont;\n\t\t\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\t\t\t\tthis.editPosItemRate(this.selectedItem.name, this.selectedItem.rate);\n\n\t\t\t\t\t\t//redrawing\n\t\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t\t\tthis.item_details.refreshDate(this.selectedItem);\n\t\t\t\t\t}\n\t\t\t\t} else if (this.selectedField.field_name == \"quantity\") {\n\t\t\t\t\tif (parseFloat(event.key) || event.key == \"0\") {\n\t\t\t\t\t\tlet lastValue = 0\n\t\t\t\t\t\tif (!this.syncInput) {\n\t\t\t\t\t\t\tlastValue = 0\n\t\t\t\t\t\t\tthis.syncInput = true\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlastValue = parseFloat(this.selectedItem.qty)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newValue = `${lastValue}` + event.key\n\t\t\t\t\t\tthis.selectedItem.qty = parseFloat(newValue);\n\t\t\t\t\t\tthis.editPosItemQty(this.selectedItem.name, this.selectedItem.qty);\n\t\t\t\t\t\t//redrawing\n\t\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t\t} else if (event.key == \"-\") {\n\t\t\t\t\t\tthis.syncInput = true\n\t\t\t\t\t\tconst newValue = parseFloat(this.selectedItem.qty) * -1\n\t\t\t\t\t\tthis.selectedItem.qty = parseFloat(newValue);\n\t\t\t\t\t\tthis.editPosItemQty(this.selectedItem.name, this.selectedItem.qty);\n\t\t\t\t\t\t//redrawing\n\t\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t\t}\n\t\t\t\t} else if (this.selectedField.field_name == \"rate\") {\n\t\t\t\t\tif (parseFloat(event.key) || event.key == \"0\") {\n\t\t\t\t\t\tlet lastValue = 0\n\t\t\t\t\t\tif (!this.syncInput) {\n\t\t\t\t\t\t\tlastValue = 0\n\t\t\t\t\t\t\tthis.syncInput = true\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlastValue = parseFloat(this.selectedItem.rate)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newValue = `${lastValue}` + event.key\n\t\t\t\t\t\tthis.selectedItem.rate = parseFloat(newValue);\n\n\t\t\t\t\t\t//recalculate the rate\n\t\t\t\t\t\tlet oldRate = this.selectedItem.rate;\n\t\t\t\t\t\tlet persont = this.selectedItem.discount_percentage\n\t\t\t\t\t\tlet montant = oldRate * (persont / 100)\n\n\t\t\t\t\t\tthis.selectedItem.discount_percentage = persont;\n\t\t\t\t\t\tthis.selectedItem.discount_amount = montant;\n\n\t\t\t\t\t\tthis.editPosItemDiscountAmount(this.selectedItem.name, this.selectedItem.discount_amount);\n\t\t\t\t\t\tthis.editPosItemRate(this.selectedItem.name, this.selectedItem.rate);\n\n\t\t\t\t\t\t//redrawing\n\t\t\t\t\t\tthis.selected_item_cart.refreshSelectedItem();\n\t\t\t\t\t\tthis.item_details.refreshDate(this.selectedItem);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t} else {\n\t\t\tdocument.removeEventListener('keydown', event => { })\n\t\t}\n\t}\n\n\n\tgetItemPrice(item, priceList) {\n\t\t//check the mode\n\t\tconst mode = this.settings_data.settings.itemPriceBasedOn\n\n\t\tif (mode == 'brand') {\n\t\t\tif (item.brand == null)\n\t\t\t\treturn 0;\n\t\t\tconst price = this.appData.appData.item_prices.find(itemPrice => itemPrice.brand == item.brand && itemPrice.price_list == priceList)\n\t\t\treturn price ? price.price_list_rate : 0\n\t\t} else if (mode == 'priceList') {\n\t\t\tconst price = this.appData.appData.item_prices.find(itemPrice => itemPrice.item_code == item.item_name && itemPrice.price_list == priceList)\n\t\t\treturn price ? price.price_list_rate : 0\n\t\t}\n\t}\n\n\tcheckServiceWorker() {\n\n\t\t// Check if service workers are supported\n\t\tif (!('serviceWorker' in navigator)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Register the service worker on window load\n\t\twindow.addEventListener('DOMContentLoaded', () => {\n\t\t\tnavigator.serviceWorker\n\t\t\t\t.register('./sw.js')\n\t\t\t\t.then(reg => console.log(\"Service Worker registered successfully.\"))\n\t\t\t\t.catch(err => console.log(`Service Worker registration failed: ${err}`));\n\t\t});\n\n\n\t\tthis.sw = new pos_ar.PointOfSale.Sw()\n\n\t\t// Additionally, check if DOM is already loaded\n\t\tif (document.readyState === 'complete') {\n\t\t\tnavigator.serviceWorker\n\t\t\t\t.register('../assets/pos_ar/public/js/sw.js')\n\t\t\t\t.then(reg => console.log(\"Service Worker registered successfully.\"))\n\t\t\t\t.catch(err => console.log(`Service Worker registration failed: ${err}`));\n\t\t}\n\n\n\t}\n\n\tcheckUnSyncedPos() {\n\t\tthis.appData.getNotSyncedPosNumber(\n\t\t\t(result) => {\n\t\t\t\tthis.unsyncedPos = result\n\t\t\t\tif (this.unsyncedPos == 0) {\n\t\t\t\t\tthis.customer_box.setSynced(result);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.customer_box.setNotSynced(result);\n\t\t\t\t}\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tconsole.log(`error occured when check unSynced POS : ${err} `)\n\t\t\t}\n\t\t)\n\t}\n\n\taddItemToPosInvoice(clickedItem) {\n\t\tlet clonedItem = structuredClone(clickedItem);\n\n\t\tconst posInvoice = this.selectedItemMaps.get(this.selectedTab.tabName);\n\t\tconst posItems = posInvoice.items;\n\n\t\tlet exist = false;\n\n\t\tposItems.forEach(item => {\n\t\t\tif (item.name == clickedItem.name) {\n\t\t\t\texist = true;\n\t\t\t\titem.qty += 1;\n\t\t\t\tconst clone = structuredClone(item)\n\t\t\t\tObject.assign(this.selectedItem, clone)\n\t\t\t}\n\t\t})\n\n\t\tif (!exist) {\n\t\t\tclonedItem.item_code = clonedItem.name;\n\t\t\tclonedItem.discount_amount = 0;\n\t\t\tclonedItem.discount_percentage = 0;\n\t\t\tclonedItem.qty = 1;\n\t\t\tclonedItem.rate = this.getItemPrice(clickedItem, this.selectedItemMaps.get(this.selectedTab.tabName).priceList);\n\t\t\tposItems.push(clonedItem)\n\n\t\t\tconst clone = structuredClone(clonedItem)\n\t\t\tObject.assign(this.selectedItem, clone)\n\n\t\t}\n\n\t}\n\n\tdeleteItemFromPOsInvoice(itemId) {\n\t\tconst posInvoice = this.selectedItemMaps.get(this.selectedTab.tabName);\n\t\tconst posItems = posInvoice.items;\n\n\t\tposInvoice.items = posItems.filter(item => item.name != itemId)\n\n\t\tthis.selectedItem = structuredClone({ name: \"\" })\n\t}\n\n\teditPosItemQty(itemName, qty) {\n\t\tlet items = this.selectedItemMaps.get(this.selectedTab.tabName).items\n\t\titems.forEach(item => {\n\t\t\tif (item.name == itemName) {\n\t\t\t\titem.qty = qty\n\t\t\t}\n\t\t})\n\t}\n\teditPosItemRate(itemName, rate) {\n\t\tlet items = this.selectedItemMaps.get(this.selectedTab.tabName).items\n\t\titems.forEach(item => {\n\t\t\tif (item.name == itemName) {\n\t\t\t\titem.rate = rate\n\t\t\t}\n\t\t})\n\t}\n\teditPosItemDiscountPercentage(itemName, discountPercentage) {\n\t\tlet items = this.selectedItemMaps.get(this.selectedTab.tabName).items\n\t\titems.forEach(item => {\n\t\t\tif (item.name == itemName) {\n\t\t\t\titem.discount_percentage = discountPercentage\n\t\t\t}\n\t\t})\n\t}\n\teditPosItemDiscountAmount(itemName, discountAmount) {\n\t\tlet items = this.selectedItemMaps.get(this.selectedTab.tabName).items\n\t\titems.forEach(item => {\n\t\t\tif (item.name == itemName) {\n\t\t\t\titem.discount_amount = discountAmount\n\t\t\t}\n\t\t})\n\t}\n\n\tcalculatePaidAmount(posInvoice) {\n\t\tlet paidAmountDA = 0;\n\t\tposInvoice.payments.forEach(mode => {\n\t\t\tpaidAmountDA += mode.amount\n\t\t})\n\t\treturn paidAmountDA\n\t}\n\n};\n", "pos_ar.PointOfSale.pos_item_selector = class {\n\n\tconstructor(\n\t\twrapper           ,\n\t\titem_list         ,\n\t\titemBarcodes      ,\n\t\titem_group_list   ,\n\t\titem_prices       ,\n\t\tsettingsData      ,\n\t\tselectedPriceList ,\n\t\tgetItemPrice      ,\n\t\tautoSelect        ,\n\t\tonItemClick\n\t){\n\t\tthis.wrapper             = wrapper           ;\n\t\tthis.item_list           = item_list         ;\n\t\tthis.item_barcodes       = itemBarcodes      ;\n\t\tthis.item_group_list     = item_group_list   ;\n\t\tthis.item_prices         = item_prices       ;\n\t\tthis.settings_data       = settingsData      ;\n\t\tthis.selected_price_list = selectedPriceList ;\n\t\tthis.get_item_price      = getItemPrice      ;\n\t\tthis.auto_select         = autoSelect        ;\n\t\tthis.on_item_click       = onItemClick       ;\n\n\t\t// Create barcode lookup map for O(1) access, storing arrays of parent IDs\n\t\tthis.barcode_map = {};\n\t\tthis.item_barcodes.forEach(barcode => {\n\t\t\tif (!this.barcode_map[barcode.barcode]) {\n\t\t\t\tthis.barcode_map[barcode.barcode] = [];\n\t\t\t}\n\t\t\tthis.barcode_map[barcode.barcode].push(barcode.parent);\n\t\t});\n\n\t\t//class functions invocation\n\t\tthis.start_item_selector();\n    }\n\n\n\tstart_item_selector(){\n\t\tthis.prepare_select_box();\n\t\tthis.setItemGroupsInList();\n\t\tthis.setItemInFlow(this.getItemByItemGroup(\"\"))\n\t\tthis.setListeners();\n\t}\n\n\trefresh(){\n\t\tthis.setItemInFlow(this.getItemByItemGroup(\"\"))\n\t}\n\n\t/***********************  ui  functions  ***************************************/\n\tprepare_select_box(){\n\t\tthis.wrapper.append('<div id=\"SelectorBox\" class=\"columnBox\" ></div>')\n\n\t\tthis.selectorBox  = this.wrapper.find(\"#SelectorBox\");\n\t\tthis.selectorBox.append('<div id=\"selectorBoxHeader\" class=\"rowBox header\"></div>')\n\n\t\tthis.header       = this.selectorBox.find(\"#selectorBoxHeader\");\n\t\tthis.header.append('<h4 class=\"CartTitle\">Items</h4>')\n\t\tthis.header.append('<div id=\"inputsBox\" class=\"rowBox align_center\"></div>')\n\n\t\tthis.inputBox     = this.header.find(\"#inputsBox\");\n\t\tthis.inputBox.append('<input type=\"text\" autocomplete=\"off\"  maxlength=\"140\" placeholder=\"Search by item code, item name or barcode\" id=\"ItemInput\" name=\"item\" placeHolder=\"Enter the customer\">')\n\t\tthis.inputBox.append('<input list=\"ItemGroupList\"  id=\"ItemGroupInput\" name=\"ItemGroup\" placeHolder=\"Item Group\">')\n\t\tthis.inputBox.append('<datalist id=\"ItemGroupList\"></datalist>')\n\n\t\tthis.itemGroupList = this.inputBox.find(\"#ItemGroupList\");\n\t\tthis.itemGroupList.append('<option>fetching Item Groups ...</option>')\n\n\t\tif(!this.settings_data.search_by_group){\n\t\t\tconsole.log(\" see settings \" , this.settings_data)\n\t\t\tthis.inputBox.find(\"#ItemGroupInput\").hide();\n\t\t}\n\n\t\tthis.selectorBox.append('<div id=\"itemsContainer\" class=\"rowBox row_wrap\"></div>')\n\t\tthis.itemsContainer = this.selectorBox.find('#itemsContainer')\n\t}\n\n\n\tsetItemGroupsInList(){\n\t\tconst groupItemList_html = document.getElementById(\"ItemGroupList\");\n\t\tgroupItemList_html.innerHTML = \"\" ;\n\t\tthis.item_group_list.forEach(group_item =>{\n\t\t\tconst option = document.createElement(\"option\");\n\t\t\toption.value = group_item.name;\n\t\t\toption.textContent = group_item.customer_name;\n\t\t\tgroupItemList_html.appendChild(option);\n\t\t})\n\t}\n\n\trefreshItemSelector(){\n\t\tconst seachField = document.getElementById(\"ItemInput\");\n\t\tseachField.value = \"\";\n\n\t\tconst groupItemListInput = document.getElementById(\"ItemGroupInput\");\n\t\tthis.setItemInFlow(this.getItemByItemGroup(groupItemListInput.value));\n\t}\n\tsetItemInFlow(filtered_item_list){\n        const itemsContainer_html = document.getElementById(\"itemsContainer\");\n        itemsContainer_html.innerHTML = \"\";\n\t\tconst itemInput = document.getElementById(\"ItemInput\");\n\n\t\tif (filtered_item_list.length === 0) {\n\t\t\titemsContainer_html.innerHTML = `\n\t\t\t\t<div class=\"no-items-found\">\n\t\t\t\t\t<svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t<path d=\"M15.5 15.5L19 19\" stroke=\"#9CA3AF\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t\t\t<path d=\"M5 11C5 14.3137 7.68629 17 11 17C12.6597 17 14.1621 16.3261 15.2483 15.2483C16.3261 14.1621 17 12.6597 17 11C17 7.68629 14.3137 5 11 5C7.68629 5 5 7.68629 5 11Z\" stroke=\"#9CA3AF\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<p>No items found</p>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\treturn;\n\t\t}\n\n\t\tfor(let i=0 ; i<filtered_item_list.length && i<300 ; i++){\n\n\t\t\tlet item = filtered_item_list[i];\n                \tconst itemBox = document.createElement(\"div\");\n                \titemBox.classList.add(\"itemBox\");\n                \titemBox.classList.add(\"columnBox\");\n                \titemBox.classList.add(\"C_A_Center\");\n\n                \titemBox.addEventListener('click' , event => {\n\t\t\t\tconst isNotImpty = itemInput.value.length > 0;\n\t\t\t\tthis.on_item_click(item, isNotImpty);\n\t\t\t});\n\n\t\t\tconst imageUrl = item.image || '/assets/pos_ar/images/no_image.png';\n\t\t\tconsole.log(\"selected prce list : \" , this.selected_price_list.name)\n\t\t\tconst price = this.get_item_price(item, frappe.defaults.get_default(\"Price List\"));\n\n            itemBox.innerHTML = `\n\t\t\t\t<img class=\"itemImage\" src=\"${imageUrl}\" alt=\"${item.item_name}\" onerror=\"this.src='/assets/pos_ar/images/no_image.png'\">\n\t\t\t\t<div class=\"itemTitle\">${item.item_name}</div>\n\t\t\t\t<div class=\"itemPrice\">${price} DA</div>\n\t\t\t`;\n\n                \titemsContainer_html.appendChild(itemBox);\n\t\t}\n\n\t\tif (filtered_item_list.length >= 700) {\n\t\t\titemsContainer_html.insertAdjacentHTML('beforeend', `\n\t\t\t\t<div class=\"more-items-notice\">\n\t\t\t\t\t<p>Showing first 700 items. Please refine your search to see more specific results.</p>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t}\n\t}\n\n\n\t//show and hide\n\tshowCart(){\n\t\tthis.selectorBox.css(\"display\" , \"flex\")\n\t}\n\n\thideCart(){\n\t\tthis.selectorBox.css(\"display\" , \"none\")\n\t}\n\n\t//**************** set listeners method ****************************//\n\tsetListeners(){\n\t\tconst groupItemListInput = document.getElementById(\"ItemGroupInput\");\n        \tgroupItemListInput.addEventListener('input' , (even)=>{\n\t\t\tthis.setItemInFlow(this.getItemByItemGroup(event.target.value))\n\t\t})\n\n\t\tconst itemInput = document.getElementById(\"ItemInput\");\n\t\titemInput.addEventListener('input' , (event)=>{\n\t\t\tthis.setItemInFlow(this.filterListByItemData(event.target.value))\n\t\t})\n\t}\n\n\t//**************** tools method ****************************//\n\n\t//filter list by item code or barcode\n\tfilterListByItemData(value){\n\t\t// Direct O(1) lookup from barcode map\n\t\tconst itemIds = this.barcode_map[value];\n\t\tif(itemIds && itemIds.length > 0) {\n\t\t\t// Found barcode match(es)\n\t\t\tconst items = this.item_list.filter(item => itemIds.includes(item.name));\n\t\t\tif(items.length === 1) {\n\t\t\t\t// If only one item, auto-select it\n\t\t\t\tthis.auto_select(items[0]);\n\t\t\t\tconst itemInput = document.getElementById(\"ItemInput\");\n\t\t\t\titemInput.value = '';\n\t\t\t\treturn this.item_list;\n\t\t\t} else if(items.length > 1) {\n\t\t\t\t// If multiple items with same barcode, show only those items\n\t\t\t\treturn items;\n\t\t\t}\n\t\t}\n\n\t\t// If no barcode match or no items found, search by item name\n\t\treturn this.item_list.filter(item => \n\t\t\titem.item_name.toLowerCase().includes(value.toLowerCase())\n\t\t);\n\t}\n\n\n\tgetItemByItemGroup(item_group){\n\n\n\t\tlet groups = [];\n\n\t\tlet getChild = (grp)=>{\n\t\t\tgroups.push(grp);\n\t\t\tthis.item_group_list.forEach(g=>{\n\t\t\t\tif(g.parent_item_group == grp){\n\t\t\t\t\tgroups.push(g.name)\n\t\t\t\t\tif(g.is_group){\n\t\t\t\t\t\tgetChild(g.name)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t};\n\n\n\t\tgetChild(item_group);\n\n\n\t\tlet filtredItemList = [];\n\n\t\tlet getFiltredItems = (group)=>{\n\t\t\tthis.item_list.forEach(item =>{\n\t\t\t\tif(item.item_group == group){\n\t\t\t\t\tfiltredItemList.push(item);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\n\t\tgroups.forEach(group =>{\n\t\t\tgetFiltredItems(group);\n\t\t})\n\n\n\t\treturn filtredItemList ;\n\t}\n}\n", "pos_ar.PointOfSale.pos_customer_box = class{\n\n\tconstructor(\n\t\twrapper          ,\n\t\tcustomersList    ,\n\t\tselectedCustomer ,\n\t\tbackHome         ,\n\t\tonSync           ,\n\t\tsaveCheckInOut   ,\n\t\tonMenuClick      ,\n\t\tonDebtClick      ,\n\t\tonPrintPos       ,\n\t){\n\t\tthis.wrapper           = wrapper          ;\n\t\tthis.customers_list    = customersList    ;\n\t\tthis.selected_customer = selectedCustomer ;\n\t\tthis.back_home         = backHome         ;\n\t\tthis.on_sync           = onSync           ;\n\t\tthis.on_menu_click     = onMenuClick      ;\n\t\tthis.save_check_in_out = saveCheckInOut   ;\n\t\tthis.on_debt_click     = onDebtClick      ;\n\t\tthis.on_print_pos      = onPrintPos       ;\n\n\t\t//local\n\t\tthis.online       = true  ;\n\t\tthis.show_menu    = false ;\n\n\t\tthis.start_work()      ;\n\t}\n\n\tstart_work(){\n\t\tthis.prepare_customer_box();\n\t\tthis.checkForSync();\n\t\tthis.setListeners();\n\t}\n\n\tprepare_customer_box(){\n\n\t\tthis.wrapper.append('<div id=\"ActionsContainerBox\">')\n\t\tthis.actionContainer = this.wrapper.find('#ActionsContainerBox')\n\n\t\t// Sync button\n\t\tthis.actionContainer.append(`\n\t\t\t<div id=\"SyncBox\" class=\"action-btn\">\n\t\t\t\t<span id=\"syncBoxContent\">Sync</span>\n\t\t\t</div>\n\t\t`)\n\n\t\t// Home button\n\t\tthis.actionContainer.append(`\n\t\t\t<div id=\"HomeBox\" class=\"action-btn\" style=\"display:none;\">\n\t\t\t\t<img src=\"/assets/pos_ar/images/home.png\" alt=\"Home\">\n\t\t\t</div>\n\t\t`)\n\n\t\t// Debt button\n\t\tthis.actionContainer.append(`\n\t\t\t<div id=\"DebtBox\" class=\"action-btn\">\n\t\t\t\t<img src=\"/assets/pos_ar/images/debt.png\" alt=\"Debt\">\n\t\t\t</div>\n\t\t`)\n\n\t\t// Exchange button\n\t\tthis.actionContainer.append(`\n\t\t\t<div id=\"exchangeBtn\" class=\"action-btn\">\n\t\t\t\t<img src=\"/assets/pos_ar/images/exchange.png\" alt=\"Exchange\">\n\t\t\t</div>\n\t\t`)\n\n\t\t// Add new custom button with popover\n\t\tthis.actionContainer.append(`\n\t\t\t<div id=\"popupBtn\" class=\"action-btn\" style=\"display: none;\">\n\t\t\t\t<i class=\"fa fa-star\"></i>\n\t\t\t</div>\n\t\t`)\n\n\t\t// Check company and show button if it's OPTILENS TIZIOUZOU\n\t\tfrappe.db.get_value('Company', frappe.defaults.get_default('company'), 'name')\n\t\t\t.then(r => {\n\t\t\t\tif (r.message.name === \"OPTILENS TIZIOUZOU\" || r.message.name === \"Tizi\" ) {\n\t\t\t\t\tdocument.getElementById('popupBtn').style.display = 'flex';\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Add popover element\n\t\tthis.wrapper.append(`\n\t\t\t<div id=\"myPopover\" popover>\n\t\t\t\t<div class=\"popover-header\">\n\t\t\t\t\t<h2>Invoices</h2>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"search-container\">\n\t\t\t\t\t<input type=\"text\" class=\"search-box\" placeholder=\"Search by customer name...\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"popover-content\">\n\t\t\t\t\t<!-- Content will go here -->\n\t\t\t\t</div>\n\t\t\t\t<div class=\"popover-footer\">\n\t\t\t\t\t<button class=\"btn btn-primary\" id=\"confirmBtn\">Done</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)\n\n\t\t// Add styles for the invoice popup\n\t\tconst style = document.createElement('style');\n\t\tstyle.textContent = `\n\t\t\t#myPopover {\n\t\t\t\tmin-width: 600px !important;\n\t\t\t\tmax-width: 80vw !important;\n\t\t\t}\n\t\t\t.search-container {\n\t\t\t\tpadding: 10px 15px;\n\t\t\t\tborder-bottom: 1px solid var(--border-color);\n\t\t\t\tbackground-color: var(--fg-color);\n\t\t\t}\n\t\t\t.search-box {\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding: 8px 12px;\n\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\tborder-radius: 6px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\toutline: none;\n\t\t\t\ttransition: border-color 0.2s;\n\t\t\t}\n\t\t\t.search-box:focus {\n\t\t\t\tborder-color: var(--primary-color);\n\t\t\t}\n\t\t\t.search-box::placeholder {\n\t\t\t\tcolor: var(--text-muted);\n\t\t\t}\n\t\t\t.invoice-list {\n\t\t\t\tmax-height: 400px;\n\t\t\t\toverflow-y: auto;\n\t\t\t\tpadding: 10px;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t.invoice-item {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding: 12px 15px;\n\t\t\t\tborder-bottom: 1px solid #eee;\n\t\t\t\tmargin-bottom: 8px;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t.invoice-item:hover {\n\t\t\t\tbackground-color: #f8f9fa;\n\t\t\t}\n\t\t\t.invoice-details {\n\t\t\t\tflex: 1;\n\t\t\t\tmin-width: 0; /* Prevents flex item from overflowing */\n\t\t\t}\n\t\t\t.invoice-name {\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: var(--text-color);\n\t\t\t\tmargin-bottom: 4px;\n\t\t\t\tfont-size: 1.1em;\n\t\t\t}\n\t\t\t.invoice-id {\n\t\t\t\tcolor: var(--text-muted);\n\t\t\t\tfont-size: 0.9em;\n\t\t\t\tmargin-bottom: 2px;\n\t\t\t}\n\t\t\t.invoice-date {\n\t\t\t\tcolor: var(--text-muted);\n\t\t\t\tfont-size: 0.85em;\n\t\t\t}\n\t\t\t.invoice-amount {\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: var(--text-color);\n\t\t\t\tmargin-top: 4px;\n\t\t\t}\n\t\t\t.invoice-actions {\n\t\t\t\tmargin-left: 20px;\n\t\t\t\twhite-space: nowrap;\n\t\t\t}\n\t\t\t.no-invoices {\n\t\t\t\ttext-align: center;\n\t\t\t\tpadding: 20px;\n\t\t\t\tcolor: var(--text-muted);\n\t\t\t}\n\t\t\t.popover-content {\n\t\t\t\twidth: 100%;\n\t\t\t\tpadding: 0;\n\t\t\t}\n\t\t\t.print-invoice {\n\t\t\t\tpadding: 6px 12px;\n\t\t\t}\n\t\t\t.print-invoice i {\n\t\t\t\tmargin-right: 4px;\n\t\t\t}\n\t\t`;\n\t\tdocument.head.appendChild(style);\n\n\t\t// Menu button\n\t\tthis.actionContainer.append(`\n\t\t\t<div id=\"MenuBox\" class=\"action-btn\">\n\t\t\t\t<img src=\"/assets/pos_ar/images/menu.png\" alt=\"Menu\">\n\t\t\t\t<div id=\"menuItemsContainer\">\n\t\t\t\t\t<div id=\"posInvoiceMenuItem\"       class=\"menuItem\">Recent POS Invoices</div>\n\t\t\t\t\t<div id=\"checkInOutMenuItem\"       class=\"menuItem\">Check In/Out</div>\n\t\t\t\t\t<div id=\"unsencedInvoicesMenuItem\" class=\"menuItem\">Unsenced invoices</div>\n\t\t\t\t\t<div id=\"closePosMenuItem\"         class=\"menuItem\">Close the POS</div>\n\t\t\t\t\t<div id=\"settingMenuItem\"          class=\"menuItem\">About</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)\n\n\t\t// Initialize button references\n\t\tthis.sync_btn = this.actionContainer.find('#SyncBox')\n\t\tthis.sync_btn_content = this.sync_btn.find('#syncBoxContent')\n\t\tthis.home = this.actionContainer.find('#HomeBox')\n\t\tthis.debt = this.actionContainer.find('#DebtBox')\n\t\tthis.exchange_btn = this.actionContainer.find('#exchangeBtn')\n\t\tthis.menu = this.actionContainer.find('#MenuBox')\n\t\tthis.menuItemsContainer = this.actionContainer.find('#menuItemsContainer')\n\t\tthis.pos_invoices       = this.menuItemsContainer.find('#posInvoiceMenuItem')\n\t\tthis.check_in_out       = this.menuItemsContainer.find('#checkInOutMenuItem')\n\t\tthis.close_pos          = this.menuItemsContainer.find('#closePosMenuItem')\n\t\tthis.unsenced_invoices  = this.menuItemsContainer.find('#unsencedInvoicesMenuItem')\n\t\tthis.setting            = this.menuItemsContainer.find('#settingMenuItem')\n\n\t\t//check in out dialog\n\t\tthis.wrapper.append('<div id=\"darkFloatingBackground\"></div>')\n\t\tthis.dark_floating_background = this.wrapper.find('#darkFloatingBackground');\n\n\t\tthis.wrapper.append(`\n\t\t\t<div id=\"checkInOutDialog\">\n\t\t\t\t<div class=\"dialog-header\">\n\t\t\t\t\t<h2>Add Transaction</h2>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"checkTypeContainer\">\n\t\t\t\t\t<div id=\"checkInType\" class=\"rowBox centerItem checkType selected\">\n\t\t\t\t\t\t<div class=\"type-icon\">\n\t\t\t\t\t\t\t<img src=\"/assets/pos_ar/images/arrow.png\" style=\"transform: rotate(180deg);\" alt=\"In\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"type-text\">Check In</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\"checkOutType\" class=\"rowBox centerItem checkType\">\n\t\t\t\t\t\t<div class=\"type-icon\">\n\t\t\t\t\t\t\t<img src=\"/assets/pos_ar/images/arrow.png\" alt=\"Out\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"type-text\">Check Out</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"inputGroup\">\n\t\t\t\t\t<label for=\"check_in_out_input\">Amount</label>\n\t\t\t\t\t<input autocomplete=\"off\" required type=\"number\" id=\"check_in_out_input\" placeholder=\"Enter amount\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"inputGroup\">\n\t\t\t\t\t<label for=\"check_in_out_note_textarea\">Reason</label>\n\t\t\t\t\t<textarea id=\"check_in_out_note_textarea\" placeholder=\"Enter reason for transaction\"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"btnsContainers\" class=\"rowBox\">\n\t\t\t\t\t<button id=\"cancelBtn\" class=\"dialogBtn rowBox centerItem\">Cancel</button>\n\t\t\t\t\t<button id=\"confirmBtn\" class=\"dialogBtn rowBox centerItem\">Confirm</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)\n\t\tthis.check_in_out_dialog = this.wrapper.find('#checkInOutDialog');\n\t\tthis.check_in_out_dialog.css('flex-direction','column')\n\n\t\tthis.check_type_container = this.check_in_out_dialog.find('#checkTypeContainer')\n\t\tthis.check_in_box  = this.check_type_container.find('#checkInType')\n\t\tthis.check_out_box = this.check_type_container.find('#checkOutType')\n\t\tthis.check_in_out_type = 'In'\n\t\tthis.check_in_out_input = this.check_in_out_dialog.find('#check_in_out_input');\n\t\tthis.check_in_out_note  = this.check_in_out_dialog.find('#check_in_out_note_textarea');\n\t\tthis.cancel_dialog_btn = this.check_in_out_dialog.find('#cancelBtn')\n\t\tthis.confirm_dialog_btn = this.check_in_out_dialog.find('#confirmBtn')\n\t}\n\n\n\t//show and hide\n\tshowHomeBar(){\n\t\tthis.home.css('display' , 'flex');\n\t}\n\thideHomeBar(){\n\t\tthis.home.css('display' , 'none');\n\t}\n\tshowSyncBar(){\n\t\tthis.sync_btn.css('display' , 'flex');\n\t}\n\thideSyncBar(){\n\t\tthis.sync_btn.css('display' , 'none');\n\t}\n\n\tshowCheckInOutDialog(){\n\t\tthis.check_in_out_dialog.css('display','flex')\n\t\tthis.dark_floating_background.css('display','flex')\n\t}\n\thideCheckInOutDialog(){\n\t\tthis.checkAmount = 0 ;\n\t\tthis.check_in_out_dialog.css('display','none')\n\t\tthis.dark_floating_background.css('display','none')\n\t\tthis.check_in_out_input.val(0)\n\t}\n\n\n\tcheckForSync(){\n\t\tthis.sync_btn.addClass('Synced');\n\t}\n\n\tsetListeners(){\n\n\t\tlet me = this\n\n\t\tconst popover = document.getElementById('myPopover');\n\t\tconst toggleButton = document.getElementById('popupBtn');\n\t\tconst cancelBtn = document.getElementById('cancelBtn');\n\t\tconst confirmBtn = document.getElementById('confirmBtn');\n\n\t\ttoggleButton.addEventListener('click', () => {\n\t\t\t// Fetch non-consolidated POS invoices\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_non_consolidated_invoices',\n\t\t\t\tcallback: function(response) {\n\t\t\t\t\tconst invoices = response.message || [];\n\t\t\t\t\tconst content = document.querySelector('.popover-content');\n\t\t\t\t\tconst searchBox = document.querySelector('.search-box');\n\t\t\t\t\t\n\t\t\t\t\tfunction renderInvoices(filteredInvoices) {\n\t\t\t\t\t\tif (filteredInvoices.length === 0) {\n\t\t\t\t\t\t\tcontent.innerHTML = '<div class=\"no-invoices\">No invoices found</div>';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlet html = '<div class=\"invoice-list\">';\n\t\t\t\t\t\t\tfilteredInvoices.forEach(invoice => {\n\t\t\t\t\t\t\t\thtml += `\n\t\t\t\t\t\t\t\t\t<div class=\"invoice-item\" data-name=\"${invoice.name}\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"invoice-details\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.customer || 'No Customer'}</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"invoice-id\">${invoice.name}</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"invoice-date\">${frappe.datetime.str_to_user(invoice.posting_date)}</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"invoice-amount\">${format_currency(invoice.grand_total)}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\"invoice-actions\">\n\t\t\t\t\t\t\t\t\t\t\t<button class=\"btn btn-xs btn-default print-invoice\">\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-print\"></i> Print\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\thtml += '</div>';\n\t\t\t\t\t\t\tcontent.innerHTML = html;\n\n\t\t\t\t\t\t\t// Add click handlers for print buttons\n\t\t\t\t\t\t\tcontent.querySelectorAll('.print-invoice').forEach(btn => {\n\t\t\t\t\t\t\t\tbtn.addEventListener('click', (e) => {\n\t\t\t\t\t\t\t\t\tconst invoiceName = e.target.closest('.invoice-item').dataset.name;\n\t\t\t\t\t\t\t\t\tconst invoice = invoices.find(inv => inv.name === invoiceName);\n\t\t\t\t\t\t\t\t\tconsole.log(\"the invoiceeeeeeeeeeee is \",invoice);\n\t\t\t\t\t\t\t\t\tme.on_print_pos(invoice);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Initial render\n\t\t\t\t\trenderInvoices(invoices);\n\n\t\t\t\t\t// Add search functionality\n\t\t\t\t\tsearchBox.addEventListener('input', (e) => {\n\t\t\t\t\t\tconst searchTerm = e.target.value.toLowerCase();\n\t\t\t\t\t\tconst filteredInvoices = invoices.filter(invoice => \n\t\t\t\t\t\t\t(invoice.customer || '').toLowerCase().includes(searchTerm)\n\t\t\t\t\t\t);\n\t\t\t\t\t\trenderInvoices(filteredInvoices);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Clear search when popup opens\n\t\t\t\t\tsearchBox.value = '';\n\t\t\t\t}\n\t\t\t});\n\t\t\tpopover.togglePopover();\n\t\t});\n\n\t\tcancelBtn.addEventListener('click', () => {\n\t\t\tpopover.hidePopover();\n\t\t});\n\n\t\tconfirmBtn.addEventListener('click', () => {\n\t\t\t// Handle confirm action here\n\t\t\tpopover.hidePopover();\n\t\t});\n\n\t\tthis.sync_btn.on('click' , (event)=>{\n\t\t\tfrappe.confirm('Are you sure you want to sync',\n\t\t\t()=>{\n\t\t\t\tthis.on_sync();\n\t\t\t},\n\t\t\t()=>{\n\t\t\t\treturn;\n\t\t\t})\n\t\t})\n\n\t\tthis.close_pos.on('click' , (event)=>{\n\t\t\tthis.on_menu_click('close_pos');\n\t\t})\n\n\t\tthis.unsenced_invoices.on('click' , (event)=>{\n\t\t\tthis.on_menu_click('unsenced_invoices');\n\t\t})\n\n\t\tthis.pos_invoices.on('click' , (event)=>{\n\t\t\tthis.on_menu_click('recent_pos');\n\t\t})\n\n\t\tthis.setting.on('click' , (event)=>{\n\t\t\tthis.on_menu_click('settings');\n\t\t})\n\n\t\tthis.check_in_out.on('click' , (event)=>{\n\t\t\tthis.on_menu_click('checkInOut');\n\t\t})\n\n\n\t\tthis.menu.on('click' , (event)=>{\n\n\t\t\tif(this.show_menu){\n\t\t\t\tthis.show_menu = !this.show_menu\n\t\t\t\tthis.menuItemsContainer.css('visibility' , 'hidden')\n\t\t\t\tthis.menuItemsContainer.css('opacity' , '0')\n\t\t\t}\n\t\t\telse{\n\t\t\t\tthis.show_menu = !this.show_menu\n\t\t\t\tthis.menuItemsContainer.css('visibility' , 'visible')\n\t\t\t\tthis.menuItemsContainer.css('opacity' , '1')\n\t\t\t}\n\n\t\t})\n\n\t\tthis.home.on('click' , (event)=>{\n\t\t\tthis.back_home()\n\t\t})\n\n\t\tthis.debt.on('click' , (event)=>{\n\t\t\tthis.on_debt_click()\n\t\t})\n\n\t\tthis.exchange_btn.on('click' , (event)=>{\n\t\t\tthis.showCheckInOutDialog();\n\t\t})\n\n\t\tthis.dark_floating_background.on('click' , (event)=>{\n\t\t\tthis.hideCheckInOutDialog();\n\t\t})\n\n\t\tthis.check_in_box.on('click', (event) => {\n\t\t\tthis.check_in_out_type = 'In';\n\t\t\tthis.check_in_box.addClass('selected');\n\t\t\tthis.check_out_box.removeClass('selected');\n\t\t})\n\n\t\tthis.check_out_box.on('click', (event) => {\n\t\t\tthis.check_in_out_type = 'Out';\n\t\t\tthis.check_out_box.addClass('selected');\n\t\t\tthis.check_in_box.removeClass('selected');\n\t\t})\n\n\t\tthis.check_in_out_input.on('input' , (event)=>{\n\t\t})\n\n\t\tthis.cancel_dialog_btn.on('click' , (event)=>{\n\t\t\tconsole.log(\"cancel\")\n\t\t\tthis.hideCheckInOutDialog();\n\t\t})\n\t\tthis.confirm_dialog_btn.on('click' , (event)=>{\n\t\t\tconst checkInOut         = frappe.model.get_new_doc('check_in_out')\n\t\t\tcheckInOut.creation_time = frappe.datetime.now_datetime();\n\t\t\tcheckInOut.user          = frappe.session.user;\n\t\t\tcheckInOut.check_type    = this.check_in_out_type;\n\t\t\tcheckInOut.amount        = parseFloat(this.check_in_out_input.val());\n\t\t\tcheckInOut.reason_note   = this.check_in_out_note.val()\n\t\t\t//valid inputs\n\t\t\tif(parseFloat(this.check_in_out_input.val()) <= 0 || this.check_in_out_note.val() == ''){\n\t\t\t\tfrappe.msgprint('you should fulfilled fileds.')\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.save_check_in_out(checkInOut);\n\t\t\tthis.hideCheckInOutDialog();\n\t\t\tconsole.log('checkInOut : ' , checkInOut);\n\t\t})\n\t}\n\n\tsetSynced(){\n\t\tthis.sync_btn.addClass('Synced')\n\t\tthis.sync_btn.removeClass('NotSynced')\n\t\tthis.sync_btn_content.html(`Synced`)\n\t}\n\n\tsetNotSynced(counter){\n\t\tthis.sync_btn.addClass('NotSynced')\n\t\tthis.sync_btn.removeClass('Synced')\n\t\tthis.sync_btn_content.html(`Sync (${counter})`)\n\t}\n\n\n\n\n\n}\n", "\npos_ar.PointOfSale.pos_selected_item_cart = class{\n\n\tconstructor(\n\t\twrapper            ,\n\t\tsettingsData       ,\n\t\tselectedItemMaps   ,\n\t\tpriceLists         ,\n\t\tcustomerList       ,\n\t\tbrandList          ,\n\t\tsalesTaxes         ,\n\t\tinvoiceData        ,\n\t\tselectedTab        ,\n\t\tselectedItem       ,\n\t\tselectedField      ,\n\t\tgetItemPrice       ,\n\t\tonSelectedItemClick,\n\t\tonTabClick         ,\n\t\tonKeyPressed       ,\n\t\tcreateNewTab       ,\n\t\tonCheckoutClick    ,\n\t\tsavePosInvoice     ,\n\t\tdb                 ,\n\t){\n\n\n\t\tthis.wrapper                 = wrapper         ;\n\t\tthis.settings_data           = settingsData    ;\n\t\tthis.selected_item_maps      = selectedItemMaps;\n\t\tthis.price_lists             = priceLists      ;\n\t\tthis.customer_list           = customerList    ;\n\t\tthis.brand_list              = brandList       ;\n\t\tthis.sales_taxes             = salesTaxes      ;\n\t\tthis.invoice_data            = invoiceData     ;\n\t\tthis.selected_tab            = selectedTab     ;\n\t\tthis.selected_item           = selectedItem    ;\n\t\tthis.selected_field          = selectedField   ;\n\t\tthis.get_item_price          = getItemPrice    ;\n\t\tthis.on_key_pressed          = onKeyPressed    ;\n\t\tthis.on_checkout_click       = onCheckoutClick ;\n\t\tthis.on_selected_item_click  = onSelectedItemClick;\n\t\tthis.on_tab_click            = onTabClick      ;\n\t\tthis.create_new_tab          = createNewTab    ;\n\t\tthis.save_pos_invoice        = savePosInvoice  ;\n\t\tthis.db                      = db              ;\n\t\t//local\n\t\tthis.taxes_map   = new Map();\n\t\tthis.total_tax_amout = 0 ;\n\t\tthis.counter    = 1 ;\n\t\tthis.show_discount = false ;\n\n\t\tthis.start_work();\n\t}\n\n\n\n\t// start the class function\n\tstart_work(){\n\t\tthis.prepare_selected_item_cart();\n\t\tthis.fulfillingSelects();\n\t\tthis.setButtonsListeners();\n\t\tthis.setListener()\n\t}\n\n\t/********************************* ui *****************************************/\n\n\tprepare_selected_item_cart(){\n\n\t\t//styles\n\t\tlet containerBoxStyle   = ''\n\t\tlet containerStyle = ''\n\t\tlet btnStyle       = ''\n\t\tlet checkoutBtn    = ''\n\n\n\t\tif(this.settings_data.settings.keyboardStyle == this.settings_data.keyboard_styles[0]){\n\t\t\tcontainerBoxStyle   =\n\t\t\t\t'margin:0px 16px;padding:0px 0px 16px 0px;'\n\t\t\tcontainerStyle =\n\t\t\t\t'width:100%;display:grid;grid-template-columns:auto auto auto auto;'\n\t\t\tbtnStyle =\n\t\t\t\t'height:45px;padding:4px;margin:6px;background:#f5f5f5;border:2px solid #e0e0e0;border-radius:12px;'+\n\t\t\t\t'color:black;font-size:small;text-align:center;'+\n\t\t\t\t'display:flex;justify-content:center;align-items:center;'\n\t\t\tcheckoutBtn =\n\t\t\t\t'width:calc(100% - 32px);margin:0px 16px 16px 16px;padding : 8px 0px ;'+\n\t\t\t\t'color:#FFFFFF;font-size:larger;font-weight:600;'+\n\t\t\t\t'background:#44A292;border:3px solid #2D6B61;border-radius:8px;outline:none;'\n\t\t}\n\t\telse{\n\t\t\tcontainerBoxStyle   =\n\t\t\t\t'width:100%;'\n\t\t\tcontainerStyle =\n\t\t\t\t'width:100%;display:grid;grid-template-columns:auto auto auto auto;'\n\n\t\t\tbtnStyle = 'height:45px;padding:4px;background:#f5f5f5;border:1px solid #a0a0a0;color:black;font-size:small;text-align:center;display:flex;justify-content:center;align-items:center;'\n\t\t\tcheckoutBtn =\n\t\t\t\t'width:100%;height:55px;'+\n\t\t\t\t'color:#FFFFFF;font-size:19px;font-weight:600;'+\n\t\t\t\t'background:#44A292;border:none;outline:none;'\n\t\t}\n\n\n\n\t\tthis.wrapper.append('<div id=\"tabs\"    class=\"rowBox\"><div id=\"tabs_container\" class=\"rowBox\" style=\"overflow-x:auto;overflow-y:hidden;\" ></div></div>')\n\t\tthis.wrapper.append('<div id=\"CartBox\" class=\"columnBox\"></div>')\n\n\n\t\tthis.tabs_bar       = this.wrapper.find(\"#tabs\")\n\t\tthis.tabs_container = this.tabs_bar.find('#tabs_container')\n\t\tthis.cartBox        = this.wrapper.find(\"#CartBox\")\n\n\n\t\tthis.tabs_container.append('<div class=\"tab selected rowBox align_center\"><div class=\"tabName\">C1</div><img src=\"/assets/pos_ar/images/cancel.png\" width=\"10px\" height=\"10px\" class=\"tabDeleteBtn\"></div>')\n\t\tthis.tabs_bar.append('<div id=\"addTabBtn\" class=\"tab unselected\">+</div>')\n\n\n\t\tthis.add_tab_button = this.tabs_bar.find('#addTabBtn')\n\n\t\tthis.cartBox.append('<div id=\"CartBoxTopBar\" class=\" rowBox align_center  row_sbtw\"><div>')\n\t\tthis.cartBox.append('<div id=\"cartHeader\" class=\"rowBox row_sbtw align_center\"></div>')\n\t\tthis.cartBox.append('<div id=\"selectedItemsContainer\" class=\"columnBox\"></div>')\n\t\tthis.cartBox.append('<div id=\"cartFooter\" class=\"columnBox\"></div>')\n\n\t\tthis.cartTopBar = this.cartBox.find('#CartBoxTopBar')\n\t\tthis.cartTopBar.append('<div id=\"selectedCustomerInput\"></div>')\n\t\tthis.cartTopBar.append('<div id=\"selectedBrandInput\"></div>')\n\t\tthis.cartTopBar.append('<div id=\"selectedItemsPriceListInput\"></div>')\n\n\t\tthis.customerInputContainer = this.cartTopBar.find(\"#selectedCustomerInput\")\n\t\tthis.customerInputContainer.append('<select  id=\"customerInput\"  placeHolder=\"Choice a customer\">')\n\t\tthis.customerInput = this.customerInputContainer.find('#customerInput')\n\n\t\tthis.priceListInputContainer = this.cartTopBar.find(\"#selectedItemsPriceListInput\")\n\t\tthis.priceListInputContainer.append('<select  id=\"PriceListInput\" name=\"PriceList\" placeHolder=\"Choice a Price list\">')\n\t\tthis.priceListInput = this.priceListInputContainer.find('#PriceListInput')\n\n\t\tthis.cartHeader = this.cartBox.find('#cartHeader')\n\t\tthis.cartHeader.append('<div style=\"font-size:16px;font-weight:600;\"><p>Item</p></div>')\n\t\tthis.cartHeader.append('<div id=\"cartHeaderTitles\" class=\"rowBox\"></div>')\n\n\t\tthis.cartHeaderTitles = this.cartHeader.find('#cartHeaderTitles')\n\t\tthis.cartHeaderTitles.append('<div id=\"quantityTitle\" style=\"font-size:16px;font-weight:600;margin-right:16px;\" >  <p>Quantity</p></div>')\n\t\tthis.cartHeaderTitles.append('<div id=\"amountTitle\"   style=\"font-size:16px;font-weight:600;\" >  <p>Amount  </p></div>')\n\n\t\tthis.selectedItemContainer = this.cartBox.find('#selectedItemsContainer')\n\n\t\tthis.cartFooter    = this.cartBox.find('#cartFooter')\n\t\tthis.cartFooter.append('<div id=\"cartDetails\" class=\"columnBox\"></div>')\n\t\tthis.cartFooter.append(`<div id=\"editSelectedItemCart\" style=\"${containerBoxStyle}\"></div>`)\n\t\tthis.cartFooter.append(`<div id=\"mainBtnContainer\" class=\"rowBox centerItem\"  style=\"${checkoutBtn}\">  </div>`)\n\n\t\tthis.cartDetails   = this.cartFooter.find('#cartDetails')\n\n\t\tthis.cartDetails.append('<div id=\"discount\" class=\"rowBox align_center row_sbtw\"></div>')\n\t\tthis.cartDetails.append('<div id=\"totalQuantity\" class=\"rowBox align_center row_sbtw\"></div>')\n\t\tthis.cartDetails.append('<div id=\"netTotal\" class=\"rowBox align_center row_sbtw\"></div>')\n\t\tthis.cartDetails.append('<div id=\"VAT\" class=\"columnBox\"></div>')\n\t\tthis.cartDetails.append('<div id=\"grandTotal\" class=\"rowBox align_center row_sbtw\"></div>')\n\n\t\tthis.discount      = this.cartDetails.find('#discount')\n\t\tthis.discount.append('<div id=\"addDiscountTitle\">Add Discount % </div>')\n\t\tthis.discount.append('<input type=\"number\" id=\"addGlobalDiscountInput\" value=\"0\" step=\"1\" min=\"0\" max=\"100\" >')\n\t\tthis.discountInput = this.discount.find('#addGlobalDiscountInput')\n\t\tthis.discountTitle = this.discount.find('#addDiscountTitle')\n\n\n\t\tthis.totalQuantity = this.cartDetails.find('#totalQuantity')\n\t\tthis.totalQuantity.append('<div id=\"totalQuantityTitle\">Total Quantity</div>')\n\t\tthis.totalQuantity.append('<div id=\"totalQuantityValue\">0</div>')\n\n\t\tthis.netTotal      = this.cartDetails.find('#netTotal')\n\t\tthis.netTotal.append('<div id=\"netTotalTitle\">Net Total</div>')\n\t\tthis.netTotal.append('<div id=\"netTotalValue\">0.00</div>')\n\n\t\tif(this.sales_taxes.length == 0){\n\t\t\tthis.netTotal.css('display' , 'none')\n\t\t}\n\n\t\tthis.vat           = this.cartDetails.find('#VAT')\n\t\tthis.sales_taxes.forEach( tax =>{\n\t\t\tthis.vat.append(`<div id=\"taxConatiner_${tax.name}\" class=\"rowBox align_center row_sbtw\"></div>`)\n\t\t\tconst taxContainer = this.vat.find(`#taxConatiner_${tax.name}`)\n\t\t\ttaxContainer.append(`<div id=\"tax_${tax.name}_Title\">${tax.description}</div>`)\n\t\t\ttaxContainer.append(`<div id=\"tax_${tax.name}_Value\">0.00</div>`)\n\t\t})\n\n\t\tthis.grandTotal    = this.cartDetails.find('#grandTotal')\n\t\tthis.grandTotal.append('<div id=\"grandTotalTitle\">Grand Total</div>')\n\t\tthis.grandTotal.append('<div id=\"grandTotalValue\">0.00</div>')\n\n\n\t\tif(!this.settings_data.settings.showDiscountField){\n\t\t\tthis.setKeyboardOrientation('landscape')\n\t\t\tthis.discount.css('display' , 'none')\n\t\t}\n\n\n\n\t\tthis.editSelectedItem = this.cartFooter.find('#editSelectedItemCart')\n\t\tthis.editSelectedItem.css('display','flex');\n\t\tthis.editSelectedItem.append(`<div class=\"grid-container\"  style=\"${containerStyle}\">`)\n\n\t\tthis.buttonsContainer = this.editSelectedItem.find('.grid-container')\n\t\tthis.buttonsContainer.append(`<button id=\"key_1\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"1\"        > 1         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_2\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"2\"        > 2         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_3\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"3\"        > 3         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_quantity\" class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"Quantity\" > Quantit\u00E9  </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_4\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"4\"        > 4         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_5\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"5\"        > 5         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_6\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"6\"        > 6         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_rate\"     class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"Rate\"     > Prix      </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_7\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"7\"        > 7         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_8\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"8\"        > 8         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_9\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"9\"        > 9         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_minus\"    class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"-\"        > -         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_point\"    class=\"grid-item\"  style=\"${btnStyle}\" data-action=\".\"        > .         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_0\"        class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"0\"        > 0         </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_delete\"   class=\"grid-item\"  style=\"${btnStyle}\" data-action=\"Delete\"   > Supprimer </button>`)\n\t\tthis.buttonsContainer.append(`<button id=\"key_remove\"   class=\"grid-item\"  style=\"${btnStyle}color:red;font-weight:700;\" data-action=\"Remove\">Retirer</button>`)\n\n\t\tthis.mainBtnContainer = this.cartFooter.find('#mainBtnContainer')\n\n\t\tthis.mainBtnContainer.append(`<button type=\"button\" id=\"checkoutBtn\" style=\"width:50%;height:100%;background:none;border:none;border-right:2px solid #663959;color:white;\"> Payment </button>`)\n\t\tthis.mainBtnContainer.append(`<button type=\"button\" id=\"printBtn\"    style=\"width:50%;height:100%;background:#E1472B;border:none;border-left:2px solid #2D6B61;color:white;\"> Print </button>`)\n\n\n\t\tthis.mainBtnContainer.find(\"#checkoutBtn\").on('mousedown' , event =>{\n\t\t\tthis.on_checkout_click();\n\t\t})\n\t\tthis.mainBtnContainer.find(\"#printBtn\").on('mousedown' , event =>{\n\t\t\tconsole.log(\"1..the map : \" , structuredClone(this.selected_item_maps.get(this.selected_tab.tabName)))\n\t\t\tthis.on_key_pressed( \"print\" , null);\n\t\t\tconsole.log(\"2..the map : \" , structuredClone(this.selected_item_maps.get(this.selected_tab.tabName)))\n\t\t})\n\n\t}\n\n\tfulfillingSelects(){\n\t\tthis.price_lists.forEach(priceList =>{\n\t\t\tthis.priceListInput.append(`<option value=\"${priceList.name}\">${priceList.price_list_name}</option>`)\n\t\t})\n\t\tthis.customer_list.forEach(customer =>{\n\t\t\tthis.customerInput.append(`<option value=\"${customer.name}\">${customer.customer_name}</option>`)\n\t\t})\n\t}\n\n\n\trefreshTabs(){\n\t\t//clear the tabs_container\n\t\tthis.tabs_container.empty()\n\n\t\tfor(let key of this.selected_item_maps.keys() ){\n\t\t\tif(key == this.selected_tab.tabName){\n\t\t\t\tthis.tabs_container.append(`<div class=\"tab selected rowBox align_center\"><div class=\"tabName\">${key}</div>  <img src=\"/assets/pos_ar/images/cancel.png\" width=\"10px\" height=\"10px\"  class=\"tabDeleteBtn\"  >  </div>`)\n\t\t\t}\n\t\t\telse{\n\t\t\t\tthis.tabs_container.append(`<div class=\"tab\">  <div class=\"tabName\">${key}</div>  </div>`)\n\t\t\t\t//this.tabs_container.append(`<div class=\"tab rowBox\"><div class=\"tabName\">${key}</div> <img src=\"/assets/pos_ar/images/cancel.png\">  </div>`)\n\t\t\t}\n\t\t}\n\n\t\tthis.tabs_container.find(\".tab\").on('click' , (event)=>{\n\n\t\t\tconst clickedTab = $(event.target).closest('.tab').find('.tabName').text();\n\n\n\t\t\t//console.log(\"\")\n\n\n\t\t\tthis.selected_tab.tabName = clickedTab\n\n\t\t\t//update UI\n\t\t\tthis.refreshTabs();\n\t\t\tthis.refreshSelectedItem();\n\n\t\t\tthis.on_tab_click(clickedTab);\n\n\t\t})\n\n\t\tthis.tabs_container.find(\".tabDeleteBtn\").on('click' , (event) => {\n\n\t\t\t//Stop the click event from propagating to the parent .tab\n\t\t        event.stopPropagation();\n\n\t\t\tconst clickedTab = $(event.target).closest('.tab').find('.tabName').text();\n\n\n\t\t\t// Check if the associated invoice is empty\n\t\t\tconst invoiceItems = this.selected_item_maps.get(clickedTab).items; // Assuming invoice data is stored in `selected_item_maps`\n\t\t\tif (invoiceItems && invoiceItems.length > 0) {\n\t\t\t\tfrappe.confirm('Are you sure you want to proceed?',\n\t\t\t\t\t() => {\n\t\t\t\t\t\tconsole.log(\"see here : \" , this.selected_item_maps.get(clickedTab))\n\t\t\t\t\t\tthis.db.deletePosInvoice(this.selected_item_maps.get(clickedTab).name)\n\t\t\t\t\t\tthis.selected_item_maps.delete(clickedTab)\n\t\t\t\t\t\tif(this.selected_item_maps.size > 0  ){\n\t\t\t\t\t\t\tthis.selected_tab.tabName = Array.from(this.selected_item_maps.keys())[0]\n\t\t\t\t\t\t\tconsole.log(\"this.selected_tab.tabName : \" , this.selected_tab)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tthis.createNewTab()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.refreshTabs()\n\t\t\t\t\t\tthis.refreshSelectedItem()\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\t// action to perform if No is selected\n\t\t\t\t\t})\n\t\t\t}else{\n\t\t\t\tthis.selected_item_maps.delete(clickedTab)\n\n\t\t\t\tif(this.selected_item_maps.size > 0  ){\n\t\t\t\t\tthis.selected_tab.tabName = Array.from(this.selected_item_maps.keys())[0]\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tthis.createNewTab()\n\t\t\t\t}\n\t\t\t\tthis.refreshTabs()\n\t\t\t\tthis.refreshSelectedItem()\n\t\t\t}\n\n\n\t\t})\n\t}\n\n\n\trefreshSelectedItem(){\n\n\t\t//refresh price list:\n\t\tthis.priceListInput.val(this.selected_item_maps.get(this.selected_tab.tabName).priceList)\n\t\t//refresh customer list:\n\t\tthis.customerInput.val(this.selected_item_maps.get(this.selected_tab.tabName).customer)\n\n\t\tconst selectedItemsContainer = document.getElementById(\"selectedItemsContainer\");\n\t\tselectedItemsContainer.innerHTML = \"\";\n\n\t\tthis.selected_item_maps.get(this.selected_tab.tabName).items.forEach( item  =>{\n\n\t\t\tconst itemElement   = document.createElement(\"div\");\n\t\t\tconst leftGroup     = document.createElement(\"div\");\n\t\t\tconst rightGroup    = document.createElement(\"div\");\n\t\t\tconst itemName      = document.createElement(\"h5\") ;\n\t\t\tconst itemQuantity  = document.createElement(\"div\") ;\n\t\t\tconst itemPrice     = document.createElement(\"div\") ;\n\n\n\t\t\t//image\n\t\t\t//check if there is an image or not\n\t\t\tif(!this.settings_data.settings.showItemImage){\n\t\t\t\t//dont create image\n\t\t\t}else if(item.image){\n\t\t\t\tconst itemImage   = document.createElement(\"img\");\n\t                        itemImage.src = item.image ;\n        \t                itemImage.classList.add(\"selectedItemImage\");\n                \t        leftGroup.appendChild(itemImage);\n\t\t\t}else{\n\t\t\t\tconst itemImageHolder = document.createElement(\"div\");\n\t\t\t\tconst itemImageLatter = document.createElement(\"div\");\n\n\t\t\t\titemImageHolder.classList.add(\"selectedItemImage\" , \"rowBox\" , \"centerItem\");\n\n\t\t\t\titemImageLatter.textContent = item.name[0]\n\t\t\t\titemImageHolder.appendChild(itemImageLatter);\n\t\t\t\tleftGroup.appendChild(itemImageHolder);\n\t\t\t}\n\n\n\t\t\t//name\n\t\t\titemName.textContent = item.item_name;\n\t\t\titemName.classList.add(\"selectedItemName\");\n\t\t\tleftGroup.appendChild(itemName);\n\n\t\t\t//quantity\n\t\t\titemQuantity.textContent = item.qty\n\t\t\titemQuantity.classList.add(\"itemQuantity\");\n\t\t\titemQuantity.style.fontSize   = \"18px\"\n\t\t\titemQuantity.style.fontWeight = \"600\"\n\t\t\trightGroup.appendChild(itemQuantity);\n\t\t\t//price\n\t\t\titemPrice.textContent = (item.rate - item.discount_amount) + \" DA\"\n\t\t\titemPrice.classList.add(\"itemPrice\");\n\t\t\titemPrice.style.fontSize   = \"18px\"\n\t\t\titemPrice.style.fontWeight = \"600\"\n\t\t\titemPrice.style.width      = \"90px\"\n\t\t\titemPrice.style.display    = \"flex\"\n\t\t\titemPrice.style.flexDirection = \"row-reverse\"\n\n\t\t\trightGroup.appendChild(itemPrice);\n\n\t\t\t//leftGroup\n\t\t\tleftGroup.classList.add(\"rowBox\" , \"align_center\" , \"leftGroup\")\n\t\t\titemElement.appendChild(leftGroup);\n\n\t\t\t//rightGroup\n\t\t\trightGroup.classList.add(\"rowBox\" , \"align_center\" , \"rightGroup\")\n\t\t\titemElement.appendChild(rightGroup);\n\n\n\t\t\t//item\n\t\t\titemElement.classList.add(\"rowBox\" , \"align_center\" , \"row_sbtw\" , \"ItemElement\" , \"pointer\")\n\t\t\tif(item.name == this.selected_item.name)\n\t\t\t\titemElement.classList.add(\"selected\")\n\t\t\titemElement.addEventListener(\"click\" , event =>{\n\t\t\t\tthis.makeItemHighlight(itemElement)\n\t\t\t\tthis.on_selected_item_click(item);\n\t\t\t})\n\n\t\t\tselectedItemsContainer.appendChild(itemElement);\n\n\t\t})\n\n\t\tthis.calculateNetTotal();\n\t\tthis.calculateVAT();\n\t\tthis.calculateQnatity();\n\t\tthis.calculateGrandTotal();\n\t}\n\n\n\tscrollToBottom(){\n\t\tconsole.log(\"scrolling\")\n\t\tthis.selectedItemContainer.scrollTop(this.selectedItemContainer[0].scrollHeight);\n\t}\n\n\n\tcreateNewTab(){\n\t\t\tthis.counter += 1 ;\n\t\t\tthis.create_new_tab(this.counter);\n\t\t\t//update UI\n\t\t\tthis.refreshTabs()\n\t\t\tthis.refreshSelectedItem()\n\t}\n\trestorePos(pos){\n\t\t\tthis.counter += 1 ;\n\t\t\tthis.create_new_tab(this.counter);\n\t\t\t\n\t\t\t//update UI\n\t\t\tthis.refreshTabs()\n\t\t\tthis.refreshSelectedItem()\n\t}\n\n\tcreateTabForEditPOS(){\n\t\tthis.counter += 1 ;\n\t\treturn this.counter;\n\t}\n\n\tshowKeyboard(){\n\t\tthis.editSelectedItem.css('display','flex')\n\t}\n\n\thideKeyboard(){\n\t\tthis.editSelectedItem.css('display','none')\n\t}\n\n\tsetKeyboardOrientation( orientation ){\n\n\t\tconst discount   = this.cartDetails.find('#discount')\n\t\tconst quantity   = this.cartDetails.find('#totalQuantity')\n\t\tconst netTotal   = this.cartDetails.find('#netTotal')\n\t\tconst grandTotal = this.cartDetails.find('#grandTotal')\n\n\t\tif(orientation == \"landscape\"){\n\t\t\tthis.cartDetails.css('display' , 'flex')\n\t\t\tthis.cartDetails.addClass('rowBox align_center')\n\t\t\tthis.cartDetails.removeClass('columnBox')\n\t\t\tdiscount.css('display' , 'none')\n\t\t\tthis.vat.css('display' , 'none')\n\t\t\t//make the text smaller\n\t\t\tquantity.css('font-size' , 'smaller')\n\t\t\tnetTotal.css('font-size' , 'smaller')\n\t\t\tgrandTotal.css('font-size' , 'small')\n\t\t\tgrandTotal.css('font-weight' , '500')\n\t\t}\n\t\telse{\n\t\t\tthis.cartDetails.addClass('columnBox')\n\t\t\tthis.cartDetails.removeClass('rowBox')\n\t\t\tif(this.settings_data.settings.showDiscountField){\n\t\t\t\tdiscount.css('display','flex')\n\t\t\t}\n\t\t\tthis.vat.css('display' , 'flex')\n\n\t\t\t//reset\n\t\t\tquantity.css('font-size'   , 'small' )\n\t\t\tnetTotal.css('font-size'   , 'small' )\n\t\t\tgrandTotal.css('font-size' , 'larger')\n\t\t\tgrandTotal.css('font-weight' , '700' )\n\t\t}\n\t}\n\n\tmakeSelectedButtonHighlighted(){\n\t\tconst quantityButton = this.buttonsContainer.find('#key_quantity')\n\t\tconst rateButton     = this.buttonsContainer.find('#key_rate')\n\t\tconst minusButton    = this.buttonsContainer.find('#key_minus')\n\n\t\tif(this.selected_field.field_name == \"quantity\"){\n\t\t\tquantityButton.addClass('selected')\n\t\t\trateButton.removeClass('selected')\n\t\t\tminusButton.removeClass('selected')\n\t\t}\n\t\telse if(this.selected_field.field_name == \"rate\"){\n\t\t\tquantityButton.removeClass('selected')\n\t\t\trateButton.addClass('selected')\n\t\t\tminusButton.removeClass('selected')\n\t\t}\n\t\telse if(this.selected_field.field_name == \"discount_percentage\"){\n\t\t\tquantityButton.removeClass('selected')\n\t\t\trateButton.removeClass('selected')\n\t\t\tminusButton.addClass('selected')\n\t\t}\n\t\telse{\n\t\t\tquantityButton.removeClass('selected')\n\t\t\trateButton.removeClass('selected')\n\t\t\tminusButton.removeClass('selected')\n\t\t}\n\n\t}\n\n\n\t//hide\n\thideCart(){\n\t\tthis.tabs_bar.css('display' , 'none');\n\t\tthis.cartBox.css('display' , 'none');\n\t}\n\t//hide\n\tshowCart(){\n\t\tthis.tabs_bar.css('display' , 'flex');\n\t\tthis.cartBox.css('display' , 'flex');\n\t}\n\t/************************  set listeners  ***************************/\n\n\tsetButtonsListeners(){\n\t\tconst key_0        = this.buttonsContainer.find('#key_0')\n\t\tconst key_1        = this.buttonsContainer.find('#key_1')\n\t\tconst key_2        = this.buttonsContainer.find('#key_2')\n\t\tconst key_3        = this.buttonsContainer.find('#key_3')\n\t\tconst key_4        = this.buttonsContainer.find('#key_4')\n\t\tconst key_5        = this.buttonsContainer.find('#key_5')\n\t\tconst key_6        = this.buttonsContainer.find('#key_6')\n\t\tconst key_7        = this.buttonsContainer.find('#key_7')\n\t\tconst key_8        = this.buttonsContainer.find('#key_8')\n\t\tconst key_9        = this.buttonsContainer.find('#key_9')\n\t\tconst key_quantity = this.buttonsContainer.find('#key_quantity')\n\t\tconst key_minus    = this.buttonsContainer.find('#key_minus')\n\t\tconst key_rate     = this.buttonsContainer.find('#key_rate')\n\t\tconst key_remove   = this.buttonsContainer.find('#key_remove')\n\t\tconst key_delete   = this.buttonsContainer.find('#key_delete')\n\t\tconst key_point    = this.buttonsContainer.find('#key_point')\n\n\t\tlet keys = [key_0 , key_1 , key_2 , key_3 , key_4 , key_5 , key_6 , key_7 , key_8 , key_9 , key_quantity , key_minus , key_rate , key_remove , key_delete , key_point]\n\n\n\t\tkeys.forEach(key =>{\n\t\t\tkey.on('mousedown' , (event)=>{\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst keyContent = key.data('action');\n\n\t\t\t\tif(!isNaN(keyContent)){\n\t\t\t\t\tthis.on_key_pressed( \"addToField\" , keyContent)\n\t\t\t\t}\n\t\t\t\telse if(keyContent == \".\"){\n\t\t\t\t\tthis.on_key_pressed( \"addToField\" , keyContent)\n\t\t\t\t}\n\t\t\t\telse if(keyContent == \"Quantity\"){\n\t\t\t\t\tthis.on_key_pressed( \"quantity\" , null)\n\t\t\t\t}\n\t\t\t\telse if(keyContent == \"Rate\"){\n\t\t\t\t\tthis.on_key_pressed( \"rate\" , null)\n\t\t\t\t}\n\t\t\t\telse if(keyContent == \"-\" ){\n\t\t\t\t\tthis.on_key_pressed( \"minus\" , null)\n\t\t\t\t}\n\t\t\t\telse if(keyContent == \"Remove\"){\n\t\t\t\t\tthis.on_key_pressed( \"remove\" , null)\n\t\t\t\t}\n\t\t\t\telse if(keyContent == \"Delete\"){\n\t\t\t\t\tthis.on_key_pressed( \"delete\" , null)\n\t\t\t\t}\n\n\t\t\t})\n\t\t})\n\n\t}\n\n\tsetListener(){\n\n\t\tthis.add_tab_button.on('mousedown' , (event)=>{\n\t\t\tthis.createNewTab()\n\t\t})\n\n\n\t\tthis.discountInput.on('input' , (event)=> {\n\t\t\tif(event.target.value == ''){\n\t\t\t\tthis.selected_item_maps.get(this.selected_tab.tabName).additional_discount_percentage = 0\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if(event.target.value > 100){\n\t\t\t\tthis.selected_item_maps.get(this.selected_tab.tabName).additional_discount_percentage = 100\n\t\t\t\treturn;\n\t\t\t}\n\n\n\t\t\tthis.selected_item_maps.get(this.selected_tab.tabName).additional_discount_percentage = parseFloat(event.target.value)\n\n\t\t\t//recalculation\n\t\t\tthis.calculateNetTotal()\n\t\t\tthis.calculateVAT()\n\t\t\tthis.calculateGrandTotal()\n\t\t})\n\t\tthis.discountInput.on('blur' , (event)=> {\n\t\t\tif(event.target.value == ''){\n\t\t\t\tevent.target.value = 0 ;\n\t\t\t}\n\t\t\telse if(event.target.value > 100){\n\t\t\t\tevent.target.value = 100 ;\n\t\t\t}\n\n\t\t\t//recalculation\n\t\t\tthis.calculateNetTotal()\n\t\t\tthis.calculateVAT()\n\t\t\tthis.calculateGrandTotal()\n\n\t\t})\n\n\n\t\tthis.priceListInput.on('input' , (event) =>{\n\t\t\tthis.selected_item_maps.get(this.selected_tab.tabName).priceList = event.target.value;\n\t\t\t//reset items rate:\n\t\t\tthis.resetItemRateBaseOnPriceList()\n\t\t\t//update the UI\n\t\t\tthis.refreshSelectedItem()\n\t\t\tthis.save_pos_invoice()\n\t\t})\n\n\t\tthis.customerInput.on('input' , (event)=>{\n\t\t\tthis.selected_item_maps.get(this.selected_tab.tabName).customer = event.target.value;\n\t\t\tlet priceList = this.getCustomerDefaultPriceList(event.target.value)\n\t\t\tif( priceList == \"\" || priceList  == null || priceList  == undefined){\n\t\t\t\t\n\t\t\t}else{\n\t\t\t\tthis.priceListInput.val(priceList)\n\t\t\t\tthis.selected_item_maps.get(this.selected_tab.tabName).priceList = priceList \t\n\t\t\t}\n\t\t\t\n\t\t\t//reset items rate:\n\t\t\tthis.resetItemRateBaseOnPriceList()\n\t\t\t//update the UI\n\t\t\tthis.refreshSelectedItem()\n\t\t\tthis.save_pos_invoice()\n\t\t})\n\t}\n\n\t/*************************  tools  **********************************/\n\n\tgetCustomerDefaultPriceList(customerId){\n\t\tlet priceList = \"\"\n\t\tthis.customer_list.forEach(customer => {\n\t\t\tif(customer.name == customerId){\n\t\t\t\tpriceList = customer.default_price_list\n\t\t\t}\n\t\t})\n\t\treturn priceList\n\t}\n\n\tcalculateNetTotal(){\n\n\t\tlet netTotal = 0;\n\t\tthis.selected_item_maps.get(this.selected_tab.tabName).items.forEach( item => {\n\t\t\tnetTotal += item.rate * item.qty\n\t\t})\n\n\t\tif(this.selected_item_maps.get(this.selected_tab.tabName).additional_discount_percentage > 0){\n\t\t\tnetTotal -= (netTotal * (this.selected_item_maps.get(this.selected_tab.tabName).additional_discount_percentage / 100))\n\t\t}\n\t\tconst netTotal_HTML = document.getElementById(\"netTotalValue\");\n\t\tnetTotal_HTML.textContent  = netTotal;\n\t\tthis.invoice_data.netTotal = netTotal;\n\t}\n\n\tcalculateVAT(){\n\t\tthis.sales_taxes.forEach( tax =>{\n\t\t\tlet saleTaxAmount = 0 ;\n\t\t\tlet taxPercentage = (tax.rate / 100)\n\t\t\tconst calculatedTax = (this.invoice_data.netTotal * taxPercentage).toFixed(2)\n\t\t\tthis.taxes_map.set(tax.name , calculatedTax)\n\t\t\tconst tax_HTML = document.getElementById(`tax_${tax.name}_Value`);\n\t\t\ttax_HTML.textContent = this.taxes_map.get(tax.name);\n\n\t\t})\n\t}\n\n\tcalculateTotalTaxAmount(){\n\t\tlet result = 0 ;\n\t\tthis.taxes_map.forEach(tax => {\n\t\t\tresult += tax ;\n\t\t})\n\t\treturn result ;\n\t}\n\n\n\tcalculateQnatity(){\n\t\tlet quantity = 0;\n\t\tthis.selected_item_maps.get(this.selected_tab.tabName).items.forEach( item => {\n\t\t\tquantity += item.qty\n\t\t})\n\t\tconst totalQuantity_HTML = document.getElementById(\"totalQuantityValue\");\n\t\ttotalQuantity_HTML.textContent = quantity;\n\t}\n\n\tcalculateGrandTotal(){\n\t\tlet grandTotal = 0 ;\n\t\tlet netTotal   = this.invoice_data.netTotal ;\n\t\tlet taxAmount  = 0 ;\n\n\t\tthis.taxes_map.forEach(tax =>{\n\t\t\ttaxAmount += parseFloat(tax)\n\t\t})\n\n\t\tgrandTotal = (netTotal + taxAmount) ;\n\t\tconst grandTotal_HTML = document.getElementById(\"grandTotalValue\");\n\t\tgrandTotal_HTML.textContent = (grandTotal).toFixed(2);\n\n\t\tthis.invoice_data.grandTotal = grandTotal\n\t}\n\n\n\tresetItemRateBaseOnPriceList(){\n\t\tthis.selected_item_maps.get(this.selected_tab.tabName).items.forEach( item  => {\n\t\t\titem.rate                = this.get_item_price(item , this.selected_item_maps.get(this.selected_tab.tabName).priceList)\n\t\t\titem.discount_percentage = 0.00\n\t\t\titem.discount_amount     = 0.00\n\t\t})\n\t}\n\n\n\tmakeItemHighlight(itemElement){\n\t\tconst selectedItemsContainer = document.getElementById(\"selectedItemsContainer\");\n\t\tconst selectedItems = selectedItemsContainer.querySelectorAll(\".selected\")\n\t\tselectedItems.forEach(selectedItem=>{\n\t\t\tselectedItem.classList.remove(\"selected\");\n\t\t})\n\t\titemElement.classList.add(\"selected\")\n\t}\n\n\tcleanHeighlight(){\n\t\tconst selectedItemsContainer = document.getElementById(\"selectedItemsContainer\");\n\t\tconst selectedItems = selectedItemsContainer.querySelectorAll(\".selected\")\n\t\tselectedItems.forEach(selectedItem=>{\n\t\t\tselectedItem.classList.remove(\"selected\");\n\t\t})\n\n\t}\n\n\n\n}\n", "pos_ar.PointOfSale.pos_item_details = class{\n\n\tconstructor(\n\t\twrapper,\n\t\twarehouse,\n\t\tpriceLists,\n\t\titemPrices,\n\t\tbinList,\n\t\tselectedItem,\n\t\tselectedField,\n\t\tonInput,\n\t\tonClose,\n\t){\n\t\tthis.wrapper        = wrapper   ;\n\t\tthis.warehouse      = warehouse ;\n\t\tthis.price_lists    = priceLists;\n\t\tthis.item_prices    = itemPrices;\n\t\tthis.selected_item  = selectedItem ;\n\t\tthis.selected_field = selectedField;\n\t\tthis.on_input       = onInput;\n\t\tthis.on_close_cart  = onClose;\n\t\tthis.bin_list       = binList;\n\n\t\tthis.start_the_work();\n\t}\n\n\n\t// start function\n\tstart_the_work(){\n\t\tthis.prepare_item_details_cart();\n\t\tthis.setDetailsFieldsListeners();\n\t}\n\n\n\t/****************************    ui functions   **********************************/\n\n        prepare_item_details_cart(){\n                this.wrapper.append('<div id=\"itemDetailsCart\" class=\"columnBox align_center\"><div>')\n\n                this.item_details_cart = this.wrapper.find(\"#itemDetailsCart\")\n                this.item_details_cart.append('<div id=\"itemDetailsCartHeader\" class=\"rowBox header align_center row_sbtw\"></div>')\n\n                this.cart_header = this.item_details_cart.find('#itemDetailsCartHeader')\n                this.cart_header.append('<h4 class=\"CartTitle\">Item Details</h4>')\n                this.cart_header.append('<img src=\"/assets/pos_ar/images/cancel.png\" alt=\"Cancel Button\" id=\"itemDetailsCartXBtn\" class=\"xBtn\">')\n\n                this.close_btn = this.cart_header.find(\"#itemDetailsCartXBtn\").on(\"click\", (event) =>{\n                        this.on_close_cart();\n                })\n\n\t\tthis.item_details_cart.append('<div id=\"itemDetailsHeader\" class=\"rowBox\"></div>')\n\n\t\tthis.header_details = this.item_details_cart.find('#itemDetailsHeader')\n\t\tthis.header_details.append('<div id=\"detailsItemImage\" class=\"rowBox centerItem\"></div>')\n\t\tthis.header_details.append('<div id=\"price_and_name\" class=\"columnBox\"></div>')\n\n\t\tthis.price_and_name_details = this.header_details.find('#price_and_name')\n\t\tthis.price_and_name_details.append('<div id=\"detailsItemName\" class=\"rowBox align_center\"></div>')\n\t\tthis.price_and_name_details.append('<div id=\"detailsItemGroupWarhouseContainer\" class=\"rowBox align_center row_sa\"></divr>')\n\n\t\tthis.item_group_warehouse_details = this.price_and_name_details.find('#detailsItemGroupWarhouseContainer')\n\t\tthis.item_group_warehouse_details.append('<div id=\"detailsItemGroup\" class=\"rowBox align_center\">Group : ...</div>')\n\t\tthis.item_group_warehouse_details.append('<div id=\"detailsItemWarehouse\" class=\"rowBox align_center\">Warehouse : ...</div>')\n\n\t\tthis.item_details_cart.append('<div id=\"itemDetailsAll\"  class=\"rowBox\"></div>')\n\n\t\tthis.details_all = this.item_details_cart.find('#itemDetailsAll')\n\t\tthis.details_all.append('<div id=\"itemDetails_C1\" class=\"columnBox\"></div>')\n\n\t\tthis.c1 = this.details_all.find('#itemDetails_C1')\n\t\tthis.c1.append('<div class=\"columnBox\"><label for=\"itemDetailsQuantityInput\">Quantity</label><input type=\"float\" id=\"itemDetailsQuantityInput\" class=\"pointerCursor\"></div>')\n\t\tthis.c1.append('<div class=\"columnBox\"><label for=\"itemDetailsRateInput\">Rate</label><input type=\"float\" id=\"itemDetailsRateInput\" class=\"pointerCursor\"></div>')\n\t\tthis.c1.append('<div class=\"columnBox\"><label for=\"itemDetailsDiscountInput\">Discount (%)</label><input type=\"float\" id=\"itemDetailsDiscountInput\" class=\"pointerCursor\"></div>')\n\t\tthis.c1.append('<div class=\"columnBox\"><label for=\"itemDetailsAvailableInput\">Available Qty at Warehouse</label><input type=\"float\" id=\"itemDetailsAvailableInput\" disabled></div>')\n\n\n\t\tthis.details_all.append('<div id=\"itemDetails_C2\" class=\"columnBox\"></div>')\n\n\t\tthis.c2 = this.details_all.find('#itemDetails_C2')\n\t\tthis.c2.append('<div class=\"columnBox\"><label for=\"itemDetailsUomInput\">UOM *</label><input type=\"text\" id=\"itemDetailsUomInput\"  disabled></div>')\n\t\tthis.c2.append('<div class=\"columnBox\"><label for=\"detailsRateWithDescount\">Discounted Rate</label>  <input type=\"text\" id=\"discountedRateInput\" disabled>  </div>')\n\t\tthis.c2.append('<div class=\"columnBox hideMe\"><label for=\"detailsPriceList\">Price List *</label><input list=\"detailsPriceList\" id=\"detailsItemPriceListInput\" class =\"rowBox align_center pointerCursor\"><datalist id=\"detailsPriceList\"><option>fetching Price Lists ...</option></datalist></div>')\n\t\tthis.c2.append('<div class=\"columnBox\"><label for=\"itemDetailsDiscountMontantInput\">Discount (montant)</label><input type=\"float\" id=\"itemDetailsDiscountMontantInput\" class=\"pointerCursor\"></div>')\n\t\tthis.c2.append('<div class=\"columnBox\"><label for=\"itemDetailsPriceListRateInput\">Price List Rate</label><input type=\"text\" id=\"itemDetailsPriceListRateInput\" disabled></div>')\n\n\n\n\t}\n\n\trefreshDate(item){\n\n\t\tconst imageContainer    = document.getElementById(\"detailsItemImage\") ;\n\t\tconst name              = document.getElementById(\"detailsItemName\");\n\t\tconst warehouse         = document.getElementById(\"detailsItemWarehouse\");\n\t\tconst itemGroup         = document.getElementById(\"detailsItemGroup\");\n\n\t\tconst quantity             = document.getElementById(\"itemDetailsQuantityInput\");\n\t\tconst rate                 = document.getElementById(\"itemDetailsRateInput\");\n\t\tconst discountedRate       = document.getElementById(\"discountedRateInput\");\n\t\tconst discount_percentage  = document.getElementById(\"itemDetailsDiscountInput\");\n\t\tconst discount_amount      = document.getElementById(\"itemDetailsDiscountMontantInput\");\n\t\tconst available            = document.getElementById(\"itemDetailsAvailableInput\");\n\n\t\tconst uom           = document.getElementById(\"itemDetailsUomInput\");\n\t\tconst priceList     = document.getElementById(\"detailsItemPriceListInput\");\n\t\tconst priceListRate = document.getElementById(\"itemDetailsPriceListRateInput\");\n\n\t\t//populate\n\t\tif(item.image){\n\t\t\tconst image = document.createElement(\"img\");\n\t\t\timage.src = item.image;\n\t\t\timageContainer.innerHTML = \"\";\n\t\t\timageContainer.appendChild(image);\n\t\t}\n\t\telse{\n\t\t\tconst image = document.createElement(\"div\");\n\t\t\timage.textContent = item.item_name[0];\n\t\t\timage.style.fontSize = \"xx-large\";\n\t\t\timage.style.fontWeight = \"700\";\n\t\t\timageContainer.innerHTML = \"\";\n\t\t\timageContainer.appendChild(image);\n\t\t}\n\n\t\t//name\n\t\tname.textContent  = item.item_name;\n\t\tname.classList.add(\"rowBox\" , \"align_center\");\n\n\n\t\t//quantity\n\t\tquantity.value = item.qty\n\n\t\t//rate\n\t\trate.value = item.rate\n\t\tdiscountedRate.value = item.rate - item.discount_amount\n\n\t\t//discount\n\t\tdiscount_amount.value     = item.discount_amount ?? 0.00;\n\t\tdiscount_percentage.value = item.discount_percentage ?? 0.00;\n\n\n\t\t//available\n\t\tavailable.value = this.getQtyInWarehouse(item.name ,  this.warehouse)\n\n\n\t\t//uom\n\t\tuom.value = item.stock_uom\n\n\n\t\t//priceList\n\t\tpriceList.value = this.price_lists[0].price_list_name\n\t\t//warehouse\n\t\twarehouse.textContent = \"Warehouse : \" + this.warehouse\n\t\t//item group\n\t\titemGroup.textContent = \"Item Group : \" + item.item_group\n\n\t\t//priceListRate\n\t\tpriceListRate.value = this.getItemPrice(item.name) + \"DA\"\n\n\n\t\tconsole.log(\"end ref\")\n\n\n\t\t//hightlited fields\n\t\tthis.makeSelectedFieldHighlighted()\n\t}\n\n\tshow_cart(){\n\t\tthis.item_details_cart.css(\"display\" , \"flex\");\n\t}\n\n\thide_cart(){\n\t\tthis.item_details_cart.css(\"display\" , \"none\");\n\t}\n\n\tmakeSelectedFieldHighlighted(){\n\n\n\t\tif(this.selected_field.field_name == \"quantity\"){\n\t\t\tthis.c1.find('#itemDetailsQuantityInput').addClass('selected')\n\t\t\tthis.c1.find('#itemDetailsRateInput').removeClass('selected')\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').removeClass('selected')\n\t\t}\n\t\telse if(this.selected_field.field_name == \"rate\"){\n\t\t\tthis.c1.find('#itemDetailsQuantityInput').removeClass('selected')\n\t\t\tthis.c1.find('#itemDetailsRateInput').addClass('selected')\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').removeClass('selected')\n\t\t}\n\t\telse if(this.selected_field.field_name == \"discount_percentage\"){\n\t\t\tthis.c1.find('#itemDetailsQuantityInput').removeClass('selected')\n\t\t\tthis.c1.find('#itemDetailsRateInput').removeClass('selected')\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').addClass('selected')\n\t\t}\n\t\telse{\n\t\t\tthis.c1.find('#itemDetailsQuantityInput').removeClass('selected')\n\t\t\tthis.c1.find('#itemDetailsRateInput').removeClass('selected')\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').removeClass('selected')\n\t\t}\n\n\t}\n\n\n\trequestFocus(field){\n\t\tif(field == \"quantity\"){\n\t\t\tthis.c1.find('#itemDetailsQuantityInput').focus();\n\t\t}\n\t\telse if(field == \"rate\"){\n\t\t\tthis.c1.find('#itemDetailsRateInput').focus();\n\t\t}\n\t\telse if(field == \"discount_percentage\"){\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').focus();\n\t\t}\n\t\telse if(field == \"discount_amount\"){\n\t\t\tthis.c1.find('#itemDetailsDiscountMontantInput').focus();\n\t\t}\n\t}\n\n\n/*\n\nelse if(keyContent == \".\" && !selectedField.value.includes(\".\")){\n                                        this.on_key_pressed( \"addToField\" , key.text())\n                                }\n\n*/\n\taddToField(field , value){\n\n\t\tconsole.log('field : ' , field , 'value : ' , value )\n\n\t\tif(field == \"quantity\"){\n\t\t\tthis.c1.find('#itemDetailsQuantityInput').val( (index,currentValue) =>{\n\t\t\t\tif(value == \".\" && currentValue.includes(\".\"))\n\t\t\t\t\treturn currentValue\n\t\t\t\telse\n\t\t\t\t\treturn currentValue + value\n\t\t\t})\n\t\t}\n\t\telse if(field == \"rate\"){\n\t\t\tthis.c1.find('#itemDetailsRateInput').val( (index,currentValue) =>{\n\t\t\t\tif(value == \".\" && currentValue.includes(\".\"))\n\t\t\t\t\treturn currentValue\n\t\t\t\telse\n\t\t\t\t\treturn currentValue + value\n\t\t\t})\n\t\t}\n\t\telse if(field == \"discount_percentage\"){\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').val( (index,currentValue) =>{\n\t\t\t\tif(value == \".\" && currentValue.includes(\".\"))\n\t\t\t\t\treturn currentValue\n\t\t\t\telse\n\t\t\t\t\treturn currentValue + value\n\t\t\t})\n\n\t\t}\n\t\telse if(field == \"discount_amount\"){\n\t\t\tthis.c1.find('#itemDetailsDiscountInput').val( (index,currentValue) =>{\n\t\t\t\tif(value == \".\" && currentValue.includes(\".\"))\n\t\t\t\t\treturn currentValue\n\t\t\t\telse\n\t\t\t\t\treturn currentValue + value\n\t\t\t})\n\n\t\t}\n\n\t}\n\n\tdeleteCharacter(){\n\n\t\tlet field = this.selected_field.field_name\n\n\t\tlet newValue = 0 ;\n\n\t\tif(field == \"quantity\"){\n\n\t\t\tlet field = this.c1.find(\"#itemDetailsQuantityInput\")\n\n\t\t\tlet cursor = field[0].selectionStart;\n\n\t\t\tfield.val( (index , currentValue) =>{\n\n\t\t\t\tif( currentValue.length < 0 ){\n\t\t\t\t\tnewValue = 0 ;\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\telse if( currentValue.length == 1){\n\t\t\t\t\tnewValue = 0 ;\n\t\t\t\t\treturn 0 ;\n\t\t\t\t}\n\t\t\t\telse if( cursor == 0 ){\n\t\t\t\t\tnewValue = currentValue;\n\t\t\t\t\treturn currentValue;\n\t\t\t\t}\n\t\t\t\telse if( cursor == currentValue.length){\n\t\t\t\t\tnewValue = currentValue.slice(0 , cursor-1)\n\t\t\t\t\treturn currentValue.slice(0 , cursor-1)\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tnewValue = currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\t\treturn currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\t}\n\t\t\t})\n\n\n\t\t\t// Use setTimeout to ensure the new value is set before adjusting cursor\n\t\t\tsetTimeout(() => {\n\t\t\t\tfield[0].setSelectionRange(cursor - 1, cursor - 1); // Move cursor back after deletion\n\t\t\t\tfield[0].focus(); // Ensure the input is focused\n\t\t\t}, 0);\n\n\t\t}\n\t\tif(field == \"rate\"){\n\n\t\t\tlet field = this.c1.find(\"#itemDetailsRateInput\")\n\n\t\t\tlet cursor = field[0].selectionStart;\n\n\t\t\tfield.val( (index , currentValue) =>{\n\n\t\t\t\tif( currentValue.length < 0 ){\n\t\t\t\t\tnewValue = 0 ;\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\telse if( currentValue.length == 1){\n\t\t\t\t\tnewValue = 0 ;\n\t\t\t\t\treturn 0 ;\n\t\t\t\t}\n\t\t\t\telse if( cursor == 0 ){\n\t\t\t\t\tnewValue = currentValue ;\n\t\t\t\t\treturn currentValue;\n\t\t\t\t}\n\t\t\t\telse if( cursor == currentValue.length){\n\t\t\t\t\tnewValue = currentValue.slice(0 , cursor-1) ;\n\t\t\t\t\treturn currentValue.slice(0 , cursor-1)\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tnewValue = currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\t\treturn currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// Use setTimeout to ensure the new value is set before adjusting cursor\n\t\t\tsetTimeout(() => {\n\t\t\t\tfield[0].setSelectionRange(cursor - 1, cursor - 1); // Move cursor back after deletion\n\t\t\t\tfield[0].focus(); // Ensure the input is focused\n\t\t\t}, 0);\n\n\n\t\t}\n\t\tif(field == \"discount_percentage\"){\n\n\t\t\tlet field = this.c1.find(\"#itemDetailsDiscountInput\")\n\n\t\t\tlet cursor = field[0].selectionStart;\n\n\t\t\tfield.val( (index , currentValue) =>{\n\n\t\t\t\tif( currentValue.length < 0 ){\n\t\t\t\t\tnewValue = 0 ;\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\telse if( currentValue.length == 1){\n\t\t\t\t\tnewValue = 0 ;\n\t\t\t\t\treturn 0 ;\n\t\t\t\t}\n\t\t\t\telse if( cursor == 0 ){\n\t\t\t\t\tnewValue = currentValue;\n\t\t\t\t\treturn currentValue;\n\t\t\t\t}\n\t\t\t\telse if( cursor == currentValue.length){\n\t\t\t\t\tnewValue = currentValue.slice(0 , cursor-1);\n\t\t\t\t\treturn currentValue.slice(0 , cursor-1)\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tnewValue = currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\t\treturn currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// Use setTimeout to ensure the new value is set before adjusting cursor\n\t\t\tsetTimeout(() => {\n\t\t\t\tfield[0].setSelectionRange(cursor - 1, cursor - 1); // Move cursor back after deletion\n\t\t\t\tfield[0].focus(); // Ensure the input is focused\n\t\t\t}, 0);\n\n\n\t\t}\n\n\t\tconsole.log(\"we reach to here \")\n\t\treturn newValue ;\n\n\t}\n\n\t/**************************  set listener  ****************************/\n\n\tsetDetailsFieldsListeners(){\n\n\t\tthis.quantityInput        = this.c1.find('#itemDetailsQuantityInput')\n\t\tthis.rateInput            = this.c1.find('#itemDetailsRateInput')\n\t\tthis.discountInput        = this.c1.find('#itemDetailsDiscountInput')\n\t\tthis.discountMontantInput = this.c2.find('#itemDetailsDiscountMontantInput')\n\n\t\t//quantity input\n\t\tthis.quantityInput.on('input' , (event)=>{\n\t\t\tconst value = event.target.value;\n\n\t\t\tif(value.length == 0){\n\t\t\t\tevent.target.value = 0\n\t\t\t}\n\t\t\telse if (!value.slice(0,-1).includes(\".\")  && value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value\n\t\t\t}\n\t\t\telse if(value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse if(value[value.length-1] == \" \"){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse if(isNaN(value[value.length-1])){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tevent.target.value = value\n\t\t\t}\n\n\t\t\t//new quantity\n\t\t\tlet newQuantity = parseFloat(this.quantityInput.val());\n\t\t\tif(isNaN(newQuantity)){\n\t\t\t\tconsole.warn(\"Invaide Quantity value =>\" , this.quantityInput.val())\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if(newQuantity <= 0){\n\t\t\t\tnewQuantity = 0;\n\t\t\t}\n\n\t\t\tthis.on_input( \"input\" , \"quantity\" , newQuantity)\n\t\t})\n\n\t\tthis.quantityInput.on('focus' , (event)=>{\n\t\t\tthis.on_input( \"focus\" , \"quantity\" , null)\n\t\t})\n\n\t\tthis.quantityInput.on('blur' , (event)=>{\n\t\t\tthis.on_input( \"blur\" , \"quantity\" , null)\n\t\t})\n\n\t\t//rate field listeners\n\t\tthis.rateInput.on('input' , (event)=>{\n\t\t\tconst value = event.target.value ;\n\n\t\t\tif(value.length == 0){\n\t\t\t\tevent.target.value = 0\n\t\t\t}\n\t\t\telse if (!value.slice(0,-1).includes(\".\")  && value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value\n\t\t\t}\n\t\t\telse if(value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse if(isNaN(value[value.length-1])){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tevent.target.value = value;\n\t\t\t}\n\n\t\t\tlet newRate = parseFloat(this.rateInput.val());\n\n\t\t\tconsole.log(\"new rate : \" , newRate)\n\t\t\tif(isNaN(newRate)){\n\t\t\t\tconsole.warn(\"Invalide Rate value\")\n\t\t\t\treturn;\n\t\t\t}\n\n\n\t\t\tthis.on_input( \"input\" , \"rate\" , newRate)\n\t\t})\n\t\tthis.rateInput.on('focus' , (event)=>{\n\t\t\tthis.on_input( \"focus\" , \"rate\" , null)\n\t\t})\n\t\tthis.rateInput.on('blur' , (event)=>{\n\t\t\tthis.on_input( \"blur\" , \"rate\" , null)\n\t\t})\n\n\n\n\n\t\t//discount field listener\n\t\tthis.discountInput.on('input' , (event)=>{\n\t\t\tconst value = event.target.value ;\n\n\t\t\tif(value.length == 0){\n\t\t\t\tevent.target.value = 0;\n\t\t\t}\n\t\t\telse if(!value.slice(0,-1).includes(\".\")  && value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value;\n\t\t\t}\n\t\t\telse if(value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse if(isNaN(value[value.length-1])){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tevent.target.value = value ;\n\t\t\t}\n\n\t\t\tlet newDiscount = this.discountInput.val();\n\n\t\t\tconsole.log(\"the new value \" , newDiscount)\n\n\t\t\tif(isNaN(newDiscount)){\n\t\t\t\tconsole.warn(\"Invalide discount value\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t//console.log(\"condition ==> \" , newDiscount<100 )\n\t\t\tif(newDiscount < 100){\n\t\t\t\tthis.on_input( \"input\" , \"discount_percentage\" , newDiscount)\n\t\t\t}\n\t\t\telse{\n\t\t\t\tevent.target.value = 100;\n\t\t\t\tthis.on_input( \"input\" , \"discount_percentage\" , 100)\n\t\t\t}\n\n\t\t})\n\n\t\tthis.discountInput.on('focus' , (event)=>{\n\t\t\tthis.on_input( \"focus\" , \"discount_percentage\" , null)\n\t\t})\n\n\t\tthis.discountInput.on('blur' , (event)=>{\n\t\t\tthis.on_input( \"blur\" , \"discount_percentage\" , null)\n\t\t})\n\n\n\t\t//discount field listener\n\t\tthis.discountMontantInput.on('input' , (event)=>{\n\t\t\tconst value = event.target.value ;\n\n\t\t\tif(value.length == 0){\n\t\t\t\tevent.target.value = 0;\n\t\t\t}\n\t\t\telse if(!value.slice(0,-1).includes(\".\")  && value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value;\n\t\t\t}\n\t\t\telse if(value[value.length-1] == \".\"){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse if(isNaN(value[value.length-1])){\n\t\t\t\tevent.target.value = value.slice(0,-1);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tevent.target.value = value ;\n\t\t\t}\n\n\t\t\tlet newDiscount = this.discountMontantInput.val();\n\n\t\t\tif(isNaN(newDiscount)){\n\t\t\t\tconsole.warn(\"Invalide discount value\")\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t//console.log(\"condition ==> \" , newDiscount<100 )\n\t\t\tthis.on_input( \"input\" , \"discount_amount\" , newDiscount)\n\n\t\t})\n\n\t\tthis.discountMontantInput.on('focus' , (event)=>{\n\t\t\tconsole.log(\"we are here\")\n\t\t\tthis.on_input( \"focus\" , \"discount_amount\" , null)\n\t\t})\n\n\t\tthis.discountMontantInput.on('blur' , (event)=>{\n\t\t\tthis.on_input( \"blur\" , \"discount_amount\" , null)\n\t\t})\n\n\t}\n\n\n\t/*************************** funs  ************************************/\n\n\tgetItemPrice(itemId){\n\t\tconst price = this.item_prices.find(itemPrice => itemPrice.item_code == itemId)\n\t\treturn price ? price.price_list_rate  : 0\n\t}\n\n\n\tgetQtyInWarehouse(itemId , warehouseId){\n\t\tconst bin = this.bin_list.find(bin => bin.item_code == itemId && bin.warehouse == warehouseId)\n\t\treturn bin ? bin.actual_qty : 0\n\t}\n\n\n}\n", "\npos_ar.PointOfSale.pos_payment_cart = class{\n\n\tconstructor(\n\t\twrapper,\n\t\tselectedItemMap,\n\t\tselectedTab,\n\t\tappData,\n\t\tpaymentMethods,\n\t\tselectedPaymentMythod,\n\t\tinvoiceData,\n\t\tonClose,\n\t\tonComplete,\n\t\tonInput\n\t){\n\n\n\t\tthis.wrapper                 = wrapper               ;\n\t\tthis.selected_item_map       = selectedItemMap       ;\n\t\tthis.selected_tab            = selectedTab           ;\n\t\tthis.app_data                = appData               ;\n\t\tthis.payment_methods         = paymentMethods        ;\n\t\tthis.selected_payment_method = selectedPaymentMythod ;\n\t\tthis.invoice_data            = invoiceData           ;\n\t\tthis.on_close_cart           = onClose               ;\n\t\tthis.on_complete             = onComplete            ;\n\t\tthis.on_input                = onInput               ;\n\n\t\tthis._payment_method = this.payment_methods[0]\n\n\t\tthis.start_work();\n\t}\n\n\n\t/****************************************  UI ***********************************************/\n\n\tstart_work(){\n\t\tthis.prepare_payment_cart();\n\t\tthis.calculateGrandTotal()\n\t\tthis.setListeners()\n\t}\n\n\tprepare_payment_cart(){\n\t\tthis.wrapper.append('<div id=\"paymentMethodCart\" class=\"columnBox align_center\"></div>')\n\t\tthis.paymentCart = this.wrapper.find('#paymentMethodCart')\n\n                this.paymentCart.append(\n                                `<script src=\"https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs\" type=\"module\"></script>`+\n                                `<div id=\"payment_waitingContainer\" style=\"position:absolute;background:#00000050;top:0;left:0;inset: 0;display:none;backdrop-filter: blur(2px);z-index: 10;\" class=\"rowBox centerItem\" ><dotlottie-player src=\"https://lottie.host/d6c76206-aab9-4d5a-af73-c4a6cfc5aaa9/H8vnpKcKj9.lottie\" background=\"transparent\" speed=\"1\" style=\"width: 300px; height: 300px\" loop autoplay></dotlottie-player></div>`\n                )\n\n\t\tthis.waiting_cart = this.wrapper.find('#payment_waitingContainer')\n\n\t\tthis.cart = this.wrapper.find('#paymentMethodCart')\n\t\tthis.cart.append('<div id=\"paymentMethodCartHeader\" class=\"rowBox header align_center row_sbtw\"></div>')\n\t\tthis.cart.append('<div id=\"paymentMethodContent\" class=\"columnBox align_center\"></div>')\n\t\tthis.cart.append('<div id=\"paymentMethodCartFooter\" class=\"columnBox align_center\"></div>')\n\n\t\tthis.cart_header  = this.cart.find('#paymentMethodCartHeader')\n\t\tthis.cart_content = this.cart.find('#paymentMethodContent')\n\t\tthis.cart_footer  = this.cart.find('#paymentMethodCartFooter')\n\n\t\tthis.cart_header.append('<h4 class=\"CartTitle\">Item Details</h4>')\n\t\tthis.cart_header.append('<img src=\"/assets/pos_ar/images/cancel.png\" alt=\"Cancel Button\" id=\"paymentMethodCartXBtn\" class=\"xBtn\">')\n\n\t\tthis.cart_header.find('#paymentMethodCartXBtn').on('click' , (event)=>{\n\t\t\tthis.on_close_cart();\n\t\t})\n\n\t\tthis.cart_content.append('<div id=\"paymentContentTopSection\" class=\"rowBox\"></div>')\n\t\tthis.cart_content.append('<div id=\"paymentContentBottomSection\" class=\"columnBox\"></div>')\n\n\t\tthis.cart_content_top_section    = this.cart_content.find('#paymentContentTopSection')\n\t\tthis.cart_content_bottom_section = this.cart_content.find('#paymentContentBottomSection')\n\n\n\t\tthis.payment_methods.forEach(method =>{\n\t\t\tconst selected    = this._payment_method.name == method.name ? \"selected\" : \"\" ;\n\t\t\tconst amountField = this.getModeOfPaymentById(method.mode_of_payment).type == 'Phone' ? \"display:none;\" : \"\"\n\t\t\tthis.cart_content_top_section.append(`<div id=\"${method.name}\" class=\"paymentMethodBox ${selected}\"><div id=\"BoxTitle\" class=\"title ${selected}\">${method.mode_of_payment}</div><input type=\"number\" id=\"cachInput\" class=\"paymentInput\" value=\"0\" style=\"${amountField}\"  ></div>`)\n\t\t})\n\n\n\t\tthis.cart_content_bottom_section.append('<h4>Additional Information</h4>')\n\n\t\tthis.cart_footer.append('<div id=\"paymentDetailsContainer\" class=\"rowBox align_center\"></div>');\n\t\tthis.cart_footer.append('<button class=\"posBtn1\" type=\"button\" id=\"completeOrderBtn\">Complete Order</button>');\n\n\t\tthis.payment_details = this.cart_footer.find('#paymentDetailsContainer')\n\t\tthis.payment_details.append('<div class=\"columnBox\"><div id=\"paymentGrandTotalTitle\" class=\"rowBox centerItem\">Grand Total</div><div id=\"paymentGrandTotalValue\" class=\"rowBox centerItem\"></div></div>')\n\t\tthis.payment_details.append('<hr>')\n\t\tthis.payment_details.append(`<div id=\"paymentPaidAmount\" class=\"columnBox\"><div id=\"paymentPaidAmountTitle\" class=\"rowBox centerItem\">Paid Amount</div><div id=\"paimentPaidAmountValue\"  class=\"rowBox centerItem\"> 0 DA </div></div>`)\n\t\tthis.payment_details.append('<hr>')\n\t\tthis.payment_details.append(`<div id=\"paymentToChange\" class=\"columnBox\"><div id=\"paimentToChangeTitle\" class=\"rowBox centerItem\">To Change</div><div id=\"paimentToChangeValue\"  class=\"rowBox centerItem\"> ${this.calculateToChange()} DA </div></div>`)\n\n\t}\n\n\n\n\tpreparDefault(){\n\t\tthis.calculateGrandTotal();\n\n\t\t//reset selected method\n\t\tthis._payment_method = this.payment_methods[0]\n\t\t//reset style for  method box\n\t\tthis.cart_content_top_section.find('.paymentMethodBox').removeClass('selected');\n\t\tthis.cart_content_top_section.find(`.paymentMethodBox#${this._payment_method.name}`).addClass('selected');\n\t\tthis.cart_content_top_section.find('.paymentMethodBox .title').removeClass('selected');\n\t\tthis.cart_content_top_section.find(`.paymentMethodBox#${this._payment_method.name} .title`).addClass('selected');\n\n\n\n\t\t// Get the selected payment method's box\n\t\tconst selectedBox = $(`#${this._payment_method.name}`);\n\t\tif (selectedBox.length) {\n\t\t\t// Set the input field value to grandTotal\n\t\t\tselectedBox.find('.paymentInput').val(this.invoice_data.grandTotal);\n\n\t\t\t// Update the payment method amount in the map\n\t\t\tthis.selected_item_map.get(this.selected_tab.tabName).payments.forEach(mode => {\n\t\t\t\tif (mode.mode_of_payment == this._payment_method.mode_of_payment) {\n\t\t\t\t\tmode.amount = this.invoice_data.grandTotal;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Update paid amount and change display\n\t\t\tthis.updatePaidAmount();\n\t\t\tthis.updateToChange();\n\t\t}\n\t}\n\n\n\tshowCart(){\n\t\tthis.cart.css('display' , 'flex');\n\t\tthis.preparDefault();\n\t\t//this.clearData();\n\t}\n\n\thideCart(){\n\t\tthis.cart.css('display' , 'none');\n\t}\n\n\tshow_waiting(){\n\t\tconsole.log(\"we are heeer display\" , this.waiting_cart)\n\t\tthis.waiting_cart.css('display' , 'flex')\n\t}\n\thide_waiting(){\n\t\tconsole.log(\"we are heeer for hide\")\n\t\tthis.waiting_cart.css('display' , 'none')\n\t}\n\n\t/*clearData(){\n\n\t\tthis.invoice_data.paidAmount = 0 ;\n\t\tthis.invoice_data.toChange = 0 ;\n\n\t\t//this.cashBox.find('#cachInput').val(0)\n\n\t\tthis.calculateGrandTotal();\n\t\tthis.updateToChange();\n\t\tthis.refreshPaidAmount();\n\n\t}*\n\n\n\trefreshData(){\n\t\tconsole.log(\"refreshing data\")\n\n\t\t//this.cashBox.find('#cachInput').val(this.invoice_data.paidAmount)\n\n\t\tthis.calculateGrandTotal();\n\t\tthis.calculateToChange();\n\t\tthis.refreshPaidAmount();\n\n\t}\n\n\t/****************************************  listeners  ***********************************************/\n\n\tsetListeners(){\n\n\t\tconst me = this\n\t\t// Use event delegation to handle clicks\n\t\tthis.cart_content_top_section.on('click', '.paymentMethodBox', function () {\n\t\t\t// Remove 'selected' class from all .paymentMethodBox elements\n\t\t\t$('.paymentMethodBox').removeClass('selected');\n\t\t\t$('.paymentMethodBox div.title').removeClass('selected');\n\t\t\t//add to clicked ones\n\t\t\t$(this).addClass('selected')\n\t\t\t$(this).find('.title').addClass('selected')\n\t\t\tconst clickedId = $(this).attr('id')\n\t\t\tme.payment_methods.forEach(method=>{\n\t\t\t\tif(method.name == clickedId){\n\t\t\t\t\tme._payment_method = method\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// Reset input fields in all other boxes\n\t\t\t$('.paymentMethodBox').not(this).find('.paymentInput').val(0);\n \t\t\t// Set the selected box input field to grandTotal\n\t\t\t$(this).find('.paymentInput').val(me.invoice_data.grandTotal);\n\n\t\t\tme.selected_item_map.get(me.selected_tab.tabName).payments.forEach(mode =>{\n\t\t\t\tif(mode.mode_of_payment != me._payment_method.mode_of_payment){\n\t\t\t\t\tmode.amount = 0\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t//check if not pay\n\t\t\t\t\tif(me.getModeOfPaymentById(mode.mode_of_payment).type == \"Phone\" ){\n\t\t\t\t\t\tmode.amount = 0\n\t\t\t\t\t}else{\n\t\t\t\t\t\tmode.amount = me.invoice_data.grandTotal\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\tme.updatePaidAmount()\n\t\t\tme.updateToChange()\n\t\t});\n\n\n\n\t\t// Add a listener for all inputs within .paymentMethodBox\n\t\tthis.cart_content_top_section.on('input', '.paymentInput', function () {\n\n\t\t\tconst inputValue = parseFloat($(this).val()) || 0; // Get the input value\n\t\t\tconst boxId = $(this).closest('.paymentMethodBox').attr('id'); // Get the box ID\n\n\t\t\tme.selected_item_map.get(me.selected_tab.tabName).payments.forEach(mode =>{\n\t\t\t\tif(mode.mode_of_payment == me._payment_method.mode_of_payment){\n\t\t\t\t\tmode.amount = parseFloat(inputValue)\n\t\t\t\t}\n\t\t\t})\n\t\t\tme.updatePaidAmount()\n\t\t\tme.updateToChange()\n\t\t});\n\n\n\t\t/*\n\t\tthis.cashBox.find('#cachInput').on('focus' , (event)=>{\n\t\t\tthis.on_input('focus' , 'cash' , null)\n\t\t})\n\t\t*/\n\n\n\t\tthis.cart_footer.find(\"#completeOrderBtn\").on('click' , (event)=>{\n\n\t\t\tfrappe.confirm('Submit the invoice ?',\n\t\t\t()=>{/*yes*/\n\t\t\t\tthis.on_complete()\n\t\t\t},()=>{\n\n\t\t\t})\n\t\t})\n\n\n\t}\n\n\n\t/************************************ tools  ***************************************/\n\n\n\thandleInput(key){\n\n\t\t/*\n\t\tlet previousValue = this.cashBox.find('#cachInput').val() ;\n\t\t// Check if the previous value contains a period (.)\n\t\tif( previousValue.includes('.') && key == \".\"){\n\t\t\treturn ;\n\t\t}\n\t\t// Append the key to the paidAmount if there is no period\n\t\tthis.invoice_data.paidAmount += key;\n\t\t// Refresh the payment cart\n\t\tthis.refreshData();*/\n\t}\n\n\tdeleteKeyPress(){\n\n\t\tlet cashField = this.cashBox.find('#cachInput');\n\t\tlet newValue = 0 ;\n\t\tlet cursor = cashField[0].selectionStart;\n\n\t\tcashField.val( (index , currentValue) =>{\n\t\t\tif( currentValue.length < 0 ){\n\t\t\t\tconsole.log(\"cnd 1\")\n\t\t\t\tnewValue = 0 ;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\telse if( currentValue.length == 1){\n\t\t\t\tconsole.log(\"cnd 2\")\n\t\t\t\tnewValue = 0 ;\n\t\t\t\treturn 0 ;\n\t\t\t}\n\t\t\telse if( cursor == 0 ){\n\t\t\t\tconsole.log(\"cnd 3\")\n\t\t\t\tnewValue = currentValue;\n\t\t\t\treturn currentValue;\n\t\t\t}\n\t\t\telse if( cursor == currentValue.length){\n\t\t\t\tconsole.log(\"cnd 4\")\n\t\t\t\tnewValue = currentValue.slice(0 , cursor-1)\n\t\t\t\treturn currentValue.slice(0 , cursor-1)\n\t\t\t}\n\t\t\telse{\n\t\t\t\tconsole.log(\"cursor : \" , cursor ,\" current val ==> \" , currentValue , \" cnd 5 newValue ==> \" , currentValue.slice(0,cursor-1) + currentValue.slice(cursor))\n\t\t\t\tnewValue = currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t\treturn currentValue.slice(0,cursor-1) + currentValue.slice(cursor)\n\t\t\t}\n\t\t})\n\n\t\tconsole.log(\"we are in newValue ==> \" , newValue);\n\n\t\tthis.invoice_data.paidAmount = newValue;\n\n\t\t// Use setTimeout to ensure the new value is set before adjusting cursor\n\t\tsetTimeout(() => {\n\t\t\tcashField[0].setSelectionRange(cursor - 1, cursor - 1); // Move cursor back after deletion\n\t\t\tcashField[0].focus(); // Ensure the input is focused\n\t\t}, 0);\n\n\t\tthis.refreshData();\n\t}\n\n\n\tcalculatePaidAmount(){\n\t\tlet paidAmountDA = 0;\n\t\tthis.selected_item_map.get(this.selected_tab.tabName).payments.forEach(mode =>{\n\t\t\tpaidAmountDA += mode.amount\n\t\t})\n\t\treturn paidAmountDA\n\t}\n\n\tupdatePaidAmount(){\n\t\tthis.payment_details.find('#paimentPaidAmountValue').text(`${this.calculatePaidAmount()} DA`)\n\t}\n\n\n\tcalculateToChange(){\n\t\tconsole.log(\"see why the error \" , \" calculatePaidAmount \" ,  this.calculatePaidAmount() , \" grandTotal \" , this.invoice_data.grandTotal)\n\t\treturn this.calculatePaidAmount() - this.invoice_data.grandTotal\n\t}\n\n\n\tupdateToChange(){\n\t\tthis.payment_details.find('#paimentToChangeValue').text(`${this.calculateToChange().toFixed(2)} DA`)\n\t}\n\n\n\tcalculateGrandTotal(){\n\t\tthis.payment_details.find('#paymentGrandTotalValue').text(`${this.invoice_data.grandTotal.toFixed(2)} DA`)\n\t\treturn parseFloat(this.invoice_data.grandTotal.toFixed(2))\n\t}\n\n\n\n\n\tgetModeOfPaymentById(id){\n\t\tlet r = null\n\t\tthis.app_data.posProfileModeOfPayments.forEach(mode=>{\n\t\t\tif(mode.name == id){\n\t\t\t\tr = mode\n\t\t\t}\n\t\t})\n\t\treturn r\n\t}\n\n}\n", "pos_ar.PointOfSale.pos_history = class {\n\n\tconstructor(\n\t\twrapper,\n\t\tdb,\n\t\tselectedPosProfile,\n\t\tappData,\n\t\tappSettings,\n\t\tcompany,\n\t\tsalesTaxes,\n\t\tonClick\n\t) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.db = db;\n\t\tthis.selected_pos_profile = selectedPosProfile;\n\t\tthis.app_data = appData;\n\t\tthis.app_settings = appSettings;\n\t\tthis.company = company;\n\t\tthis.sales_taxes = salesTaxes;\n\t\tthis.on_click = onClick;\n\n\t\t//local data\n\t\tthis.localPosInvoice = { lastTime: null, pos_invoices: [] }\n\t\tthis.filter = \"\";\n\t\tthis.search_value = \"\";\n\n\t\tthis.filtered_pos_list = [];\n\t\tthis.selected_pos = null;\n\n\t\tthis.start_work();\n\t}\n\n\tasync start_work() {\n\t\tthis.prepare_history_cart();\n\t\tconst result = await this.db.getAllPosInvoice()\n\n\t\tthis.localPosInvoice.pos_invoices = result;\n\n\t\tthis.filtered_pos_list = this.localPosInvoice.pos_invoices.filter(pos => {\n\t\t\tif (pos.status == 'Unpaid') {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t})\n\t\tconsole.log(\"log init data : \", this.filtered_pos_list)\n\t\tif (this.filtered_pos_list.length == 0) {\n\t\t\tthis.selected_pos = null\n\t\t} else {\n\t\t\tthis.selected_pos = structuredClone(this.filtered_pos_list[0])\n\t\t}\n\t\tthis.refreshData()\n\t\tthis.setListener();\n\t}\n\n\n\t/*************************************    UI    *******************************************************/\n\n\tprepare_history_cart() {\n\t\tthis.wrapper.find('#LeftSection').append('<div id=\"historyLeftContainer\" class=\"columnBox\"></div>')\n\t\tthis.wrapper.find('#RightSection').append('<div id=\"historyRightContainer\" class=\"columnBox\"></div>')\n\n\t\tthis.left_container = this.wrapper.find('#historyLeftContainer')\n\t\tthis.right_container = this.wrapper.find('#historyRightContainer')\n\n\n\t\t//pos details  the container of the pos details\n\t\tthis.left_container.append('<div id=\"PosContentHeader\" class=\"rowBox\" ><div class=\"c1 columnBox\"><div id=\"posCustomer\">Customer</div><div id=\"posSoldBy\"></div><div id=\"posStatus\" class=\"Paid\"></div></div><div class=\"c2 columnBox\"><div id=\"posCost\">0,0000 DA</div><div id=\"posId\">ACC-PSINV-2024-ID</div><div id=\"posRealId\">POS realI</div></div></div>')\n\n\t\t//first this.selected_pos.taxes_and_charges = \"\"section is the header information\n\t\tthis.pos_header = this.left_container.find('#PosContentHeader');\n\n\t\tthis.left_container.append('<div id=\"posContent\" class=\"columnBox\"></div>')\n\n\t\t//second section is the data like items , cost and payments methods.\n\t\tthis.pos_content = this.left_container.find('#posContent')\n\t\tthis.pos_content.append('<div id=\"posItemContainer\"><div class=\"posSectionTitle\">Items</div><div id=\"posItemList\"></div></div>')\n\n\t\tthis.itemContainer = this.pos_content.find('#posItemContainer')\n\t\tthis.itemList = this.itemContainer.find('#posItemList')\n\n\t\tthis.pos_content.append('<div id=\"posTotalsContainer\"><div class=\"posSectionTitle\">Totals</div><div id=\"posTotalList\"></div></div>')\n\n\t\tthis.totalsContainer = this.pos_content.find('#posTotalsContainer')\n\t\tthis.totalList = this.pos_content.find('#posTotalList')\n\n\t\tthis.pos_content.append('<div id=\"posPaymentsContainer\"><div class=\"posSectionTitle\">Payments</div><div id=\"posMethodList\"></div></div>')\n\n\t\tthis.paymentsContainer = this.pos_content.find('#posPaymentsContainer')\n\t\tthis.methodList = this.pos_content.find('#posMethodList')\n\n\t\tthis.left_container.append('<div id=\"posActionsContainer\" class=\"rowBox align_content\"  style=\"display = none ;\" > <div id=\"posPrintBtn\" class=\"actionBtn rowBox centerItem\"> Print Receipt </div>  <div id=\"posDuplicateBtn\" class=\"actionBtn rowBox centerItem\"> Duplicate </div>   <div id=\"posReturnBtn\" class=\"actionBtn rowBox centerItem\"> Return </div>  </div>')\n\t\tthis.left_container.append('<div id=\"posDraftActionsContainer\" class=\"rowBox align_content\" style=\"display = none ;\"> <div id=\"posEditBtn\" class=\"actionBtn rowBox centerItem\"> Edit Invoice </div>  <div id=\"posDeleteBtn\" class=\"actionBtn rowBox centerItem\"> Delete Invoice </div>  </div>')\n\n\t\t//third and last section is the action buttons\n\t\tthis.actionButtonsContainer = this.left_container.find('#posActionsContainer')\n\t\tthis.printBtn = this.actionButtonsContainer.find('#posPrintBtn')\n\t\tthis.duplicateBtn = this.actionButtonsContainer.find('#posDuplicateBtn')\n\t\tthis.returnBtn = this.actionButtonsContainer.find('#posReturnBtn')\n\n\t\tthis.draftActionButtonsContainer = this.left_container.find('#posDraftActionsContainer')\n\t\tthis.deleteBtn = this.draftActionButtonsContainer.find('#posDeleteBtn')\n\t\tthis.editBtn = this.draftActionButtonsContainer.find('#posEditBtn')\n\n\n\t\tthis.right_container.append(`<div id=\"historyRightContainerHeader\" class=\"rowBox align_center\" ><h4 class=\"CartTitle\">Recent Orders</h4></div>`)\n\t\tthis.right_container.append('<div id=\"historyRightSearchContainer\" class=\"rowBox align_center\" ></div>');\n\n\t\tthis.search_container = this.right_container.find('#historyRightSearchContainer');\n\t\tthis.search_container.append('<select  id=\"PosInvoiceTypeInput\" placeholder=\"POS Invoice Type\">');\n\n\t\tthis.filter_input = this.search_container.find(\"#PosInvoiceTypeInput\")\n\t\tthis.filter_input.append('<option value=\"Draft\">Draft</option><option value=\"Paid\">Paid</option> <option value=\"Unpaid\" selected>Unpaid</option>')\n\n\t\tthis.search_container.append('<input type=\"text\" id=\"historyInput\" placeholder=\"Search by invoice id or custumer name\">');\n\t\tthis.search_field = this.search_container.find(\"#historyInput\")\n\n\t\tthis.right_container.append('<div id=\"historyRecentInvoicesContainer\" ></div>');\n\n\t\tthis.right_data_container = this.right_container.find('#historyRecentInvoicesContainer')\n\t}\n\n\n\trefreshData() {\n\t\tthis.right_data_container.html('');\n\n\t\tthis.filtered_pos_list.forEach(record => {\n\n\t\t\tconst posContainer = document.createElement('div');\n\t\t\tposContainer.classList.add('posInvoiceContainer')\n\t\t\tposContainer.classList.add('columnBox')\n\t\t\tposContainer.classList.add('align_content')\n\n\t\t\t//line 1\n\t\t\tconst l1 = document.createElement('div')\n\t\t\tl1.classList.add('l1')\n\t\t\tl1.classList.add('rowBox')\n\t\t\tl1.classList.add('align_content')\n\n\t\t\tconst posName = document.createElement('div')\n\t\t\tposName.classList.add('posName')\n\t\t\tposName.textContent = record.refNum\n\n\t\t\tconst posCost = document.createElement('div')\n\t\t\tposCost.classList.add('posCost')\n\t\t\tposCost.textContent = record.paid_amount + \" DA\" ?? 0 + \" DA\"\n\n\t\t\tl1.appendChild(posName)\n\t\t\tif (record.consolidated_invoice) {\n\t\t\t\tconst consolidatedFlag = document.createElement('div')\n\t\t\t\tconsolidatedFlag.classList.add('consolidated-flag')\n\t\t\t\tconsolidatedFlag.style.margin = '0 8px 0 8px'\n\t\t\t\tconsolidatedFlag.innerHTML = `Consolidated`\n\t\t\t\tl1.appendChild(consolidatedFlag)\n\t\t\t}\n\t\t\tl1.appendChild(posCost)\n\n\t\t\t///////////// line 2\n\t\t\tconst l2 = document.createElement('div')\n\t\t\tl2.classList.add('l2')\n\t\t\tl2.classList.add('rowBox')\n\t\t\tl2.classList.add('align_content')\n\n\t\t\t//l2 customer\n\t\t\tconst customer = document.createElement('div')\n\t\t\tcustomer.classList.add('customer')\n\t\t\tcustomer.classList.add('rowBox')\n\t\t\tcustomer.classList.add('align_content')\n\n\t\t\tconst customerLogo = document.createElement('img')\n\t\t\tcustomerLogo.src = '/assets/pos_ar/images/customer.png';\n\t\t\tcustomerLogo.width = 16;\n\t\t\tcustomerLogo.height = 16;\n\t\t\tcustomerLogo.classList.add('customerLogo');\n\n\t\t\tconst customerName = document.createElement('div')\n\t\t\tcustomerName.textContent = record.customer\n\t\t\tcustomerName.classList.add('customerName');\n\n\t\t\tcustomer.appendChild(customerLogo);\n\t\t\tcustomer.appendChild(customerName);\n\n\t\t\tl2.appendChild(customer);\n\n\t\t\t//l2 creation time\n\t\t\tconst creationTime = document.createElement('div')\n\t\t\tcreationTime.textContent = record.creation_time\n\t\t\tl2.appendChild(creationTime);\n\n\t\t\tposContainer.appendChild(l1)\n\t\t\tposContainer.appendChild(l2)\n\n\t\t\tposContainer.addEventListener('click', () => {\n\t\t\t\tconsole.log('click', record)\n\t\t\t\tthis.selected_pos = record\n\t\t\t\tthis.refreshPosDetailsData();\n\t\t\t})\n\n\t\t\tthis.right_data_container.append(posContainer);\n\t\t})\n\n\n\t\t//dont forget to refresh the details cart view because the selected pos may change\n\t\tthis.refreshPosDetailsData();\n\n\t}\n\n\n\n\trefreshPosDetailsData() {\n\n\t\t/******************  check if there is a selected one *********************/\n\t\t// render the empty page or the selected pos details.\n\t\tif (this.selected_pos == null) {\n\t\t\tthis.setEmpty();\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.setData();\n\t\t}\n\n\t\tthis.pos_header.find('#posCustomer').text(this.selected_pos.customer ?? \"CustomerName\")\n\t\t//this.pos_header.find('#posSoldBy').text('Sold By : ' + this.selected_pos.owner?? \"saler\")\n\t\t//it is not the paid amount it should be the total invoice amount\n\t\tthis.pos_header.find('#posCost').text(this.selected_pos.paid_amount + \" DA\" ?? 0 + \" DA\")\n\t\tthis.pos_header.find('#posId').text(this.selected_pos.refNum ?? \"POS Invoice CachId\")\n\n\t\tthis.pos_header.find('#posRealId').text(this.selected_pos.real_name ?? \"\")\n\n\t\tthis.pos_header.find('#posStatus').text(this.selected_pos.status)\n\t\tthis.pos_header.find('#posStatus').removeClass().addClass(`${this.selected_pos.status}`)\n\n\t\t// Add consolidated information if present\n\t\tif (this.selected_pos.consolidated_invoice) {\n\t\t\tif (!this.pos_header.find('#posConsolidated').length) {\n\t\t\t\tthis.pos_header.find('.c1').append('<div id=\"posConsolidated\" class=\"consolidated-info\"></div>')\n\t\t\t}\n\t\t\tthis.pos_header.find('#posConsolidated').html(`\n                <span class=\"consolidated-label\">Consolidated:</span>\n                <span class=\"consolidated-value\">${this.selected_pos.consolidated_invoice}</span>\n            `)\n\t\t} else {\n\t\t\tthis.pos_header.find('#posConsolidated').remove()\n\t\t}\n\n\t\tif (this.selected_pos.status == \"Draft\") {\n\t\t\tthis.draftActionButtonsContainer.css('display', 'flex')\n\t\t\tthis.actionButtonsContainer.css('display', 'none')\n\t\t} else {\n\t\t\tthis.draftActionButtonsContainer.css('display', 'none')\n\t\t\tthis.actionButtonsContainer.css('display', 'flex')\n\t\t}\n\n\n\t\t/**********************  items list ***************************/\n\t\tthis.itemList.html('');\n\t\tthis.selected_pos.items.forEach(item => {\n\t\t\tthis.itemList.append(`<div class=\"rowBox align_item\">    <div class=\"itemName rowBox align_center\">${item.item_name}</div>   <div class=\"itemQuantity rowBox align_center\">${item.qty}</div>   <div class=\"itemCost rowBox align_center\">${item.qty * item.rate} DA</div>  </div>`)\n\t\t})\n\n\n\t\t/*********************  net ,  VAT  , Discount , Grand Total *******************/\n\n\t\tthis.totalList.html('');\n\n\n\t\t//if there are no taxes we should show only the grand total\n\n\t\t/////net total\n\t\tlet netTotal = 0;\n\t\tthis.selected_pos.items.forEach(item => {\n\t\t\tnetTotal += item.rate * item.qty\n\t\t})\n\n\n\t\tif (this.selected_pos.taxes_and_charges == \"\" || this.selected_pos.taxes_and_charges == null) {\n\t\t\t// grand otal\n\t\t\tthis.totalList.append(`<div class=\"rowBox align_item\"> <div class=\"grandTotalName rowBox align_center\">Grand Total</div> <div class=\"grandTotalPrice rowBox align_center\">${netTotal} DA</div> </div>`)\n\t\t} else {\n\t\t\tthis.totalList.append(`<div class=\"rowBox align_item\"> <div class=\"name rowBox align_center\">Net Total</div> <div class=\"price rowBox align_center\">${netTotal} DA</div> </div>`)\n\t\t\tlet allTax = 0\n\t\t\tif (this.selected_pos.taxes_and_charges != \"\" && this.selected_pos.taxes_and_charges != null) {\n\t\t\t\tthis.sales_taxes.forEach(tax => {\n\t\t\t\t\tallTax += (tax.rate / 100) * netTotal\n\t\t\t\t\tthis.totalList.append(`<div class=\"rowBox align_item\"> <div class=\"name rowBox align_center\">${tax.description}</div> <div class=\"price rowBox align_center\">${(tax.rate / 100) * netTotal} DA</div> </div>`)\n\t\t\t\t})\n\t\t\t}\n\t\t\t// grand otal\n\t\t\tthis.totalList.append(`<div class=\"rowBox align_item\"> <div class=\"grandTotalName rowBox align_center\">Grand Total</div> <div class=\"grandTotalPrice rowBox align_center\">${netTotal + allTax} DA</div> </div>`)\n\t\t}\n\n\n\n\n\n\n\t\t/***************************** payment methode list *********************************/\n\t\tthis.methodList.html('')\n\t\tconst payments = this.selected_pos.payments;\n\n\t\tif (payments != null && payments != \"\") {\n\t\t\tpayments.forEach(method => {\n\t\t\t\tthis.methodList.append(`<div class=\"rowBox align_item\"> <div class=\"name rowBox align_center\">${method.mode_of_payment}</div> <div class=\"price rowBox align_center\">${method.amount} DA</div> </div>`)\n\t\t\t})\n\t\t}\n\n\t}\n\n\n\n\t//show and hide\n\tshow_cart() {\n\t\tthis.left_container.css('display', 'flex');\n\t\tthis.right_container.css('display', 'flex');\n\n\t\tconst filter = this.filter_input.val();\n\n\t\t//refrenshing data\n\t\tthis.db.getAllPosInvoice_callback(\n\t\t\t(result) => {\n\t\t\t\tthis.localPosInvoice.pos_invoices = result;\n\t\t\t\tthis.filtered_pos_list = this.localPosInvoice.pos_invoices.filter(pos => {\n\n\t\t\t\t\tif (pos.status == filter) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tif (this.filtered_pos_list.length == 0) {\n\t\t\t\t\tthis.selected_pos = null\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.selected_pos = this.filtered_pos_list[0]\n\t\t\t\t}\n\t\t\t\tthis.refreshData()\n\t\t\t}, (error) => {\n\t\t\t\tconsole.log(error)\n\t\t\t}\n\t\t)\n\n\t}\n\n\t//hide and hide\n\thide_cart() {\n\t\tthis.left_container.css('display', 'none');\n\t\tthis.right_container.css('display', 'none');\n\t}\n\n\n\t//set empty\n\tsetEmpty() {\n\t\tthis.pos_header.css('display', 'none')\n\t\tthis.pos_content.css('display', 'none')\n\t\tthis.actionButtonsContainer.css('display', 'none')\n\t\tthis.draftActionButtonsContainer.css('display', 'none')\n\t}\n\n\t//set data\n\tsetData() {\n\t\tthis.pos_header.css('display', 'flex')\n\t\tthis.pos_content.css('display', 'flex')\n\t}\n\n\n\n\t/************************************* set listeners  ***********************************************/\n\t//set listeners\n\tsetListener() {\n\n\t\tthis.filter_input.on('input', (event) => {\n\t\t\tconsole.log(\"we are here1\")\n\t\t\tthis.filterList(this.search_field.val(), this.filter_input.val())\n\t\t});\n\n\t\tthis.search_field.on('input', (event) => {\n\t\t\tconsole.log(\"we are here2\")\n\t\t\tthis.filterList(this.search_field.val(), this.filter_input.val())\n\t\t})\n\n\t\tthis.deleteBtn.on('click', (event) => {\n\t\t\tthis.db.deletePosInvoice_callback(\n\t\t\t\tthis.selected_pos.name,\n\t\t\t\t(event) => {\n\t\t\t\t\t//remove the deleted one from the filtred list\n\t\t\t\t\tthis.filtered_pos_list = this.filtered_pos_list.filter(pos => pos.name != this.selected_pos.name)\n\t\t\t\t\t//selected new pos\n\t\t\t\t\tif (this.filtered_pos_list.length > 0) {\n\t\t\t\t\t\tthis.selected_pos = this.filtered_pos_list[0]\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.selected_pos = null;\n\t\t\t\t\t}\n\t\t\t\t\tthis.refreshData()\n\t\t\t\t},\n\t\t\t\t(error) => {\n\t\t\t\t\t//error callback\n\t\t\t\t\tconsole.log(\"error on deleting the pos : \", error);\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\n\t\tthis.editBtn.on('click', (event) => {\n\t\t\tthis.on_click('edit', this.selected_pos);\n\t\t})\n\n\t\tthis.returnBtn.on('click', (event) => {\n\t\t\tconsole.log(\"returned invoice : \", this.selected_pos)\n\t\t\tthis.on_click('return', this.selected_pos);\n\t\t})\n\n\t\tthis.printBtn.on('click', (event) => {\n\t\t\tthis.print_receipt(this.selected_pos)\n\t\t})\n\n\t\tthis.duplicateBtn.on('click', (event) => {\n\t\t\tthis.on_click('duplicate', this.selected_pos);\n\t\t})\n\n\t}\n\n\t/******************************************** functions  ********************************************************/\n\n\n\tfilterList(search, filter) {\n\t\tconsole.log(\"log : \", this.filtered_pos_list)\n\t\tthis.filtered_pos_list = this.localPosInvoice.pos_invoices.filter(pos => {\n\n\n\t\t\tconst matchesCustomer = (pos.customer || \"\").toLowerCase().includes(search.toLowerCase());\n\t\t\tconst matchesRefNum = (pos.refNum || \"\").toLowerCase().includes(search.toLowerCase());\n\t\t\tconst matchesName = (pos.real_name || \"\").toLowerCase().includes(search.toLowerCase());\n\t\t\tconst matchesAll = search == \"\";\n\t\t\tconst matchesFilter = pos.status == filter;\n\n\t\t\treturn matchesFilter && (matchesCustomer || matchesRefNum || matchesName || matchesAll);\n\t\t})\n\n\t\tif (this.filtered_pos_list.length == 0) {\n\t\t\tthis.selected_pos = null;\n\t\t} else {\n\t\t\tthis.selected_pos = this.filtered_pos_list[0]\n\t\t\tconsole.log(\"debuging invoice : \", this.selected_pos, \"and : \", this.filtered_pos_list)\n\t\t}\n\t\tthis.refreshData();\n\t}\n\n\t async print_receipt(pos) {\n\t\ttry {\n\t\t\tif (!pos) {\n\t\t\t\tconsole.error(\"No POS data provided\");\n\t\t\t\tfrappe.throw(__(\"Error: No POS data available for printing\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Initialize totals\n\t\t\tconst totals = {\n\t\t\t\tnetTotal: 0,\n\t\t\t\ttaxes: 0,\n\t\t\t\tgrandTotal: 0,\n\t\t\t\ttotalQty: 0,\n\t\t\t\ttotalItems: 0\n\t\t\t};\n\n\t\t\t// Format number helper\n\t\t\tconst formatNumber = (num) => {\n\t\t\t\treturn new Intl.NumberFormat('fr-DZ', {\n\t\t\t\t\tminimumFractionDigits: 0,\n\t\t\t\t\tmaximumFractionDigits: 0\n\t\t\t\t}).format(num);\n\t\t\t};\n\n\t\t\t// Get customer data\n\t\t\tconst customer = this.app_data.appData.customers.find(customer => customer.name == pos.customer);\n\t\t\tif (!customer) {\n\t\t\t\tconsole.error(\"Customer not found:\", pos.customer);\n\t\t\t\tfrappe.throw(__(\"Error: Customer information not found\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet ancien_sold = customer.custom_debt;\n\t\t\tif (this.app_settings.settings.onlineDebt) {\n\t\t\t\tancien_sold = await this.app_data.fetchCustomerDebt(customer.name);\n\t\t\t}\n\n\t\t\t// Parse creation time\n\t\t\tconst creation_time = pos.creation_time || pos.creation;\n\t\t\tif (!creation_time) {\n\t\t\t\tconsole.error(\"No creation time found in POS object\");\n\t\t\t\tfrappe.throw(__(\"Error: Invalid receipt date\"));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst [date, time] = creation_time.split(' ');\n\n\t\t\t// Generate CSS styles\n\t\t\tconst styles = `\n\t\t\t\t<style>\n\t\t\t\t\t@media print {\n\t\t\t\t\t\t@page {\n\t\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\t\tsize: 80mm auto;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbody {\n\t\t\t\t\t\t\tmargin: 1mm;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbody {\n\t\t\t\t\t\tfont-family: Arial, sans-serif;\n\t\t\t\t\t\tline-height: 1.4;\n\t\t\t\t\t\tcolor: #000;\n\t\t\t\t\t}\n\t\t\t\t\t.receipt-container {\n\t\t\t\t\t\tmax-width: 80mm;\n\t\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\t\tpadding: 1px;\n\t\t\t\t\t}\n\t\t\t\t\t.logo-container {\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tmargin-bottom: 10px;\n\t\t\t\t\t\tmargin-top: 10px;\n\t\t\t\t\t}\n\t\t\t\t\t.logo-container img {\n\t\t\t\t\t\twidth:90%;\n\t\t\t\t\t\theight: auto;\n\t\t\t\t\t}\n\t\t\t\t\t.company-name {\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\t}\n\t\t\t\t\t.receipt-header {\n\t\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\t\tpadding: 5px 0;\n\t\t\t\t\t\tborder-top: 1px dashed #000;\n\t\t\t\t\t\tborder-bottom: 1px dashed #000;\n\t\t\t\t\t}\n\t\t\t\t\t.customer-info {\n\t\t\t\t\t\tmargin-bottom: 10px;\n\t\t\t\t\t}\n\t\t\t\t\t.receipt-table {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tborder-collapse: collapse;\n\t\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\t}\n\t\t\t\t\t.receipt-table th {\n\t\t\t\t\t\tborder-bottom: 1px solid #000;\n\t\t\t\t\t\tpadding: 5px;\n\t\t\t\t\t\ttext-align: left;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t}\n\t\t\t\t\t.receipt-table td {\n\t\t\t\t\t\tpadding: 5px;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\tborder-bottom: 1px dotted #ccc;\n\t\t\t\t\t}\n\t\t\t\t\t.totals {\n\t\t\t\t\t\tmargin: 10px 0;\n\t\t\t\t\t\ttext-align: left;\n\t\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\t}\n\t\t\t\t\t.receipt-footer {\n\t\t\t\t\t\tmargin-top: 20px;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\t\tborder-top: 1px dashed #000;\n\t\t\t\t\t\tpadding-top: 10px;\n\t\t\t\t\t}\n\t\t\t\t\t.bold {\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t}\n\t\t\t\t\t.text-right {\n\t\t\t\t\t\ttext-align: right;\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t`;\n\n\t\t\t// Generate receipt HTML\n\t\t\tlet receiptHTML = `\n\t\t\t\t${styles}\n\t\t\t\t<div class=\"receipt-container\">\n\t\t\t\t\t<div class=\"logo-container\">\n\t\t\t\t\t\t<img src=\"/assets/pos_ar/images/logo.jpg\" alt=\"Company Logo\">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"company-name\">${this.company.company_name}</div>\n\t\t\t\t\t\n\t\t\t\t\t<div class=\"receipt-header\">\n\t\t\t\t\t\t<div class=\"customer-info\">\n\t\t\t\t\t\t\t<div class=\"bold\">Client: ${pos.customer}</div>\n\t\t\t\t\t\t\t<div style=\"font-size:10px;\">Commande: ${pos.refNum}</div>\n\t\t\t\t\t\t\t<div style=\"font-size:10px;\">Date: ${date}</div>\n\t\t\t\t\t\t\t<div style=\"font-size:10px;\">Heure: ${time}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<table class=\"receipt-table\">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th>Article</th>\n\t\t\t\t\t\t\t\t<th class=\"text-right\">Qt\u00E9</th>\n\t\t\t\t\t\t\t\t<th class=\"text-right\">Prix</th>\n\t\t\t\t\t\t\t\t<th class=\"text-right\">Total</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t`;\n\n\t\t\t// Add items to receipt\n\t\t\tpos.items.forEach(item => {\n\t\t\t\tconst itemTotal = item.rate * item.qty;\n\t\t\t\ttotals.netTotal += itemTotal;\n\t\t\t\ttotals.totalQty += item.qty;\n\t\t\t\ttotals.totalItems += 1;\n\n\t\t\t\treceiptHTML += `\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>${item.item_name}</td>\n\t\t\t\t\t\t<td class=\"text-right\">${item.qty}</td>\n\t\t\t\t\t\t<td class=\"text-right\">${formatNumber(item.rate)}</td>\n\t\t\t\t\t\t<td class=\"text-right\">${formatNumber(itemTotal)}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`;\n\t\t\t});\n\n\t\t\t// Calculate final totals\n\t\t\tconst discount = pos.additional_discount_percentage ? (totals.netTotal * pos.additional_discount_percentage) : 0;\n\t\t\ttotals.grandTotal = totals.netTotal - discount;\n\n\n\n\n\t\t\t// Add totals section\n\t\t\treceiptHTML += `\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\n\t\t\t\t\t<div class=\"totals\" style=\"text-align:left;\">\n\t\t\t\t\t\t<div>Quantit\u00E9 Totale: ${totals.totalQty}</div>\n\t\t\t\t\t\t <div>Remise: ${formatNumber(discount)} DA</div>\n\t\t\t\t\t\t<div style=\"margin-top:15px; text-align:left;\">\n\t\t\t\t\t\t\t<div class=\"bold\" style=\"display:flex; align-items:center; font-size:18px;\">\n\t\t\t\t\t\t\t\t<div style=\"width:120px; font-size:18px;\">Total:</div>\n\t\t\t\t\t\t\t\t<div style=\"flex-grow:1; text-align:center; font-size:18px;\">${formatNumber(totals.grandTotal)} DA</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style=\"display:flex; align-items:center; font-size:14px;\">\n\t\t\t\t\t\t\t\t<div style=\"width:120px; font-size:14px;\">Total Solde:</div>\n\t\t\t\t\t\t\t\t<div style=\"flex-grow:1; text-align:center; font-size:14px;\">${formatNumber(ancien_sold)} DA</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"receipt-footer\">\n\t\t\t\t\t\t<div>Merci de votre visite!</div>\n\t\t\t\t\t\t<div>${this.company.company_name}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\t// Print the receipt\n\t\t\tconst printWindow = window.open('', '_blank');\n\t\t\tif (!printWindow) {\n\t\t\t\tfrappe.throw(__(\"Error: Popup blocked. Please allow popups for printing.\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tprintWindow.document.write(receiptHTML);\n\t\t\tprintWindow.document.close();\n\n\t\t\t// Wait for images to load before printing\n\t\t\tprintWindow.onload = () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tprintWindow.focus();\n\t\t\t\t\tprintWindow.print();\n\t\t\t\t\tprintWindow.close();\n\t\t\t\t}, 250); // Small delay to ensure styles are applied\n\t\t\t};\n\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error printing receipt:\", error);\n\t\t\tfrappe.throw(__(\"Error printing receipt. Please try again.\"));\n\t\t}\n\t}\n}\n", "pos_ar.PointOfSale.pos_db  = class POSDatabase {\n\n\tconstructor(db) {\n\t\tthis.db = db;\n\t\tthis.setupDatabase();\n\t}\n\n\n\tstatic async openDatabase(){\n\t\treturn new Promise((resolve , reject) => {\n\n\t\t\t// Let us open our database\n\t\t\tconst request = window.indexedDB.open( 'POSDB_test33' , 8);\n\n\t\t\trequest.onerror = (event) => {\n\t\t\t\t// Do something with request.error!\n\t\t\t\treject(request.error)\n\t\t\t};\n\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\t// Do something with request.result!\n\t\t\t\tresolve(new pos_ar.PointOfSale.pos_db(event.target.result))\n\t\t\t};\n\n \t\t\trequest.onupgradeneeded = (event) => {\n\t\t\t \tconst db = event.target.result;\n\n\n\t\t\t\t let posInvoiceStore;\n\t\t\t\t let checkInOutStore;\n\n\t\t\t\t// Create object stores (tables)\n\t\t\t\tif (!db.objectStoreNames.contains('Customer')) {\n\t\t\t\t\tdb.createObjectStore('Customer', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('Item Group')) {\n\t\t\t\t\tdb.createObjectStore('Item Group', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('Item')) {\n\t\t\t\t\tdb.createObjectStore('Item', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('Item Price')) {\n\t\t\t\t\tdb.createObjectStore('Item Price', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('Price List')) {\n\t\t\t\t\tdb.createObjectStore('Price List', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('Warehouse')) {\n\t\t\t\t\tdb.createObjectStore('Warehouse', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('POS Profile')) {\n\t\t\t\t\tdb.createObjectStore('POS Profile', { keyPath: 'name' });\n\t\t\t\t}\n\t\t\t\tif (!db.objectStoreNames.contains('Bin')) {\n\t\t\t\t\tdb.createObjectStore('Bin', { keyPath: 'name' });\n\t\t\t\t}\n\n\t\t\t\t//pos invoice\n\t\t\t\tif (!db.objectStoreNames.contains('POS Invoice')) {\n\t\t\t\t\tposInvoiceStore = db.createObjectStore('POS Invoice', { keyPath : 'name' });\n\t\t\t\t}else{\n\t\t\t\t\tposInvoiceStore = event.target.transaction.objectStore('POS Invoice');\n\t\t\t\t}\n\n\n\t\t\t\t// Check and create indexes if they do not already exist\n\t\t\t\tif (!posInvoiceStore.indexNames.contains('docstatus')) {\n\t\t\t\t\tposInvoiceStore.createIndex('docstatus', 'docstatus', { unique: false });\n\t\t\t\t}\n\t\t\t\tif (!posInvoiceStore.indexNames.contains('opened')) {\n\t\t\t\t\tposInvoiceStore.createIndex('opened', 'opened', { unique: false });\n\t\t\t\t}\n\t\t\t\tif (!posInvoiceStore.indexNames.contains('creation_time')) {\n\t\t\t\t\tposInvoiceStore.createIndex('creation_time', 'creation_time', { unique: false });\n\t\t\t\t}\n\n\n\n\t\t\t\tif (!db.objectStoreNames.contains('check_in_out')) {\n\t\t\t\t\tcheckInOutStore = db.createObjectStore('check_in_out', { keyPath : 'name' });\n\t\t\t\t}else{\n\t\t\t\t\tcheckInOutStore = event.target.transaction.objectStore('check_in_out');\n\t\t\t\t}\n\t\t\t\t// Check and create indexes if they do not already exist\n\t\t\t\tif (!checkInOutStore.indexNames.contains('creation_time')) {\n\t\t\t\t\tcheckInOutStore.createIndex('creation_time', 'creation_time', { unique: false });\n\t\t\t\t}\n\n\n\t\t\t\tif (!db.objectStoreNames.contains('POS Settings')) {\n\t\t\t\t\tdb.createObjectStore('POS Settings', { keyPath : 'id' });\n\t\t\t\t}\n\n\n\n\t\t\t};\n\n\n\t\t})\n\t}\n\n\n\n\tsetupDatabase(){\n\t\tthis.db.onerror = (event) => {\n\t\t\t// Generic error handler for all errors targeted at this database's\n\t\t\t// requests!\n\t\t\tconsole.error(`Database error: ${event.target.error?.message}`);\n\t\t};\n\t}\n\n\n\n\t/************************************  counte ***************************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\n\n\tgetPosCounter(){\n\t\treturn new Promise((resolve , reject) => {\n\t\t\tconst transaction = this.db.transaction(['Counter'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Counter')\n\n\t\t})\n\t}\n\n\n\n\n\t/************************************   Item  ***************************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsaveItemList( itemList ){\n\t\treturn new Promise((resolve , reject) => {\n\t\t\tconst transaction = this.db.transaction(['Item'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Item')\n\t\t\t// Loop through the list of items  and add each one to the store\n\t\t\titemList.forEach(item => {\n\t\t\t\tconst request = store.put(item)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving Item : \" , item ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve()\n\t\t\t};\n\t\t\ttransaction.onerror = (err) => {\n\t\t\t\tconsole.error(\"db => error saving Item.\")\n\t\t\t\treject(err)\n\t\t\t};\n\t\t})\n\t}\n\n\tgetAllItems(){\n\t\treturn new Promise((resolve,reject) =>{\n\t\t\tconst transaction = this.db.transaction(['Item'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Item');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t})\n\t}\n\n\n\t/*********************************   POS Profile  ***********************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsavePosProfileList( posProfileList ){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Profile'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('POS Profile')\n\t\t\t// Loop through the list of pos profile and add each one to the store\n\t\t\tposProfileList.forEach(posProfile => {\n\t\t\t\tconst request = store.put(posProfile)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving POS Profile : \" ,posProfile ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve()\n\t\t\t};\n\t\t\ttransaction.onerror = (err) => {\n\t\t\t\tconsole.error(\"db => error saving POS Profile.\")\n\t\t\t\treject(err)\n\t\t\t};\n\t\t})\n\n\t}\n\n\tgetAllPosProfile(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Profile'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('POS Profile');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\treject(value);\n\t\t\t}\n\t\t})\n\t}\n\n\n\n\t/*********************************       Bin      ***********************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsaveBinList( binList ){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Bin'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Bin')\n\t\t\t// Loop through the list of bin  and add each one to the store\n\t\t\tbinList.forEach(bin => {\n\t\t\t\tconst request = store.put(bin)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving Bin : \" , bin ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve()\n\t\t\t};\n\t\t\ttransaction.onerror = (err) => {\n\t\t\t\tconsole.error(\"db => error saving Bin.\")\n\t\t\t\treject(err)\n\t\t\t};\n\t\t})\n\t}\n\n\tgetAllBin(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Bin'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Bin');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err)=> {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t})\n\t}\n\n\n\n\n\t/*********************************   Warehouse    ***********************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsaveWarehouseList(warehouseList){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Warehouse'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Warehouse')\n\t\t\t// Loop through the list of warehouse and add each one to the store\n\t\t\twarehouseList.forEach(warehouse => {\n\t\t\t\tconst request = store.put(warehouse)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving Warehouse : \" ,warehouse ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\ttransaction.onerror = (event) => {\n\t\t\t\tconsole.error(\"db => error saving Warehouse List.\")\n\t\t\t\treject(event);\n\t\t\t};\n\t\t})\n\t}\n\n\tgetAllWarehouse(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Warehouse'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Warehouse');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t})\n\t}\n\n\n\n\t/*********************************   Price List   ***********************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsavePriceLists(priceLists){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Price List'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Price List')\n\n\t\t\t// Loop through the list of price lists and add each one to the store\n\t\t\tpriceLists.forEach(priceList => {\n\t\t\t\tconst request = store.put(priceList)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving Price List : \" ,itemPrice ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\ttransaction.onerror = (err) => {\n\t\t\t\tconsole.error(\"db => error saving Price Lists.\")\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\n\t}\n\n\tgetAllPriceList(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Price List'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Price List');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err)=>{\n\t\t\t\treject(err)\n\t\t\t}\n\t\t})\n\t}\n\n\n\n\n\t/*********************************   Item Price   ***********************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsaveItemPriceList(itemPriceList){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Item Price'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Item Price')\n\t\t\t// Loop through the list of item price and add each one to the store\n\t\t\titemPriceList.forEach(itemPrice => {\n\t\t\t\tconst request = store.put(itemPrice)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving Item Price : \" ,itemPrice ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\ttransaction.onerror = (err) => {\n\t\t\t\tconsole.error(\"db => error saving Item Price.\")\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\t}\n\n\tgetAllItemPrice(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Item Price'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Item Price');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err)=>{\n\t\t\t\treject(err);\n\t\t\t}\n\t\t})\n\t}\n\n\n\t/*********************************   Item Group   ***********************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsaveItemGroupList(itemGroupList){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Item Group'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Item Group')\n\t\t\t// Loop through the list of item group and add each one to the store\n\t\t\titemGroupList.forEach(itemGroup => {\n\t\t\t\tconst request = store.put(itemGroup)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\treject(err);\n\t\t\t\t\tconsole.error(\"db => error saving Item Group : \" ,itemGroup ,  \"err : \" , err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\ttransaction.onerror = (err) => {\n\t\t\t\tconsole.error(\"db => error saving Item Group.\")\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\t}\n\n\tgetAllItemGroup(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Item Group'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Item Group');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value);\n\t\t\t}\n\t\t\tresult.onerror = (err)=>{\n\t\t\t\treject(err);\n\t\t\t}\n\t\t})\n\t}\n\n\n\n\t/*********************************   cutomers   *************************************/\n\t/************************************************************************************/\n\t/************************************************************************************/\n\n\tsaveCustomerList(customerList ){\n\t\treturn new Promise((resolve,reject) => {\n\t\t\tconst transaction = this.db.transaction(['Customer'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('Customer')\n\t\t\t// Loop through the list of customers and add each one to the store\n\t\t\tcustomerList.forEach(customer => {\n\t\t\t\tconst request = store.put(customer)\n\t\t\t\trequest.onerror = (err)=>{\n\t\t\t\t\tconsole.error(\"db => error saving customer : \" ,customer ,  \"err : \" , err)\n\t\t\t\t\treject(err)\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Transaction's oncomplete event will be triggered\n\t\t\t//once all requests in this transaction complete successfully\n\t\t\ttransaction.oncomplete = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\ttransaction.onerror = (event) => {\n\t\t\t\tconsole.error(\"db => error saving customer.\")\n\t\t\t\treject(event)\n\t\t\t};\n\n\t\t})\n\t}\n\n\tgetAllCustomers(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['Customer'] , \"readonly\");\n\t\t\tconst store       = transaction.objectStore('Customer');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value)\n\t\t\t}\n\t\t\tresult.onerror = (value)=>{\n\t\t\t\tconsole.error(\"error when getting customer from db\")\n\t\t\t\treject(event)\n\t\t\t}\n\t\t})\n\t}\n\n\n\n\n\n\t/****************************** pos invoice *********************************/\n\t/****************************************************************************/\n\t/****************************************************************************/\n\n\tsavePosInvoice(posInvoice){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('POS Invoice')\n\t\t\tconst request     = store.put(posInvoice)\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\tresolve(event);\n\t\t\t};\n\t\t\trequest.onerror = (event) => {\n\t\t\t\treject(event);\n\t\t\t};\n\t\t})\n\n\t}\n\n\tupdatePosInvoice(posInvoice) {\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Invoice'], \"readwrite\");\n\t\t\tconst store = transaction.objectStore('POS Invoice');\n\t\t\t// add if not exists or update if it exists.\n\t\t\tconst request = store.put(posInvoice);\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\tresolve(event.target.result);\n\t\t\t};\n\t\t\trequest.onerror = (event) => {\n\t\t\t\treject(event);\n    \t\t\t};\n\t\t})\n\t}\n\n\t//async\n\tgetAllPosInvoice(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('POS Invoice');\n\t\t\tconst dateIndex   = store.index('creation_time');\n\n\t\t\tconst invoices    = []\n\t\t\tconst request     = dateIndex.openCursor(null , 'prev') //use prev for descenfing order\n\n\t\t\trequest.onsuccess = (event) =>{\n\t\t\t\tconst cursor = event.target.result;\n\t\t\t\tif(cursor){\n\t\t\t\t\tinvoices.push(cursor.value);\n\t\t\t\t\tcursor.continue() //Move to the next record\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('check the response : ' , invoices)\n\t\t\t\t\tresolve(invoices);\n\t\t\t\t}\n\t\t\t};\n\t\t\trequest.onerror = (err)=>{\n\t\t\t\treject(err)\n\t\t\t}\n\n\t\t})\n\t}\n\n\t//async\n\tgetAllOpenedPosInvoice(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('POS Invoice');\n\t\t\tconst result      = store.getAll()\n\t\t\tresult.onsuccess = (event) => {\n\t\t\t\tconst value = event.target.result\n\t\t\t\tresolve(value.filter(pos => pos.opened == 1));\n\t\t\t}\n\t\t\tresult.onerror = (err)=>{\n\t\t\t\treject(err)\n\t\t\t}\n\t\t})\n\n\t}\n\n\t//callBack version\n\tgetAllPosInvoice_callback(onSuccess,onFailure){\n\t\tconst transaction = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\tconst store       = transaction.objectStore('POS Invoice');\n\t\tconst dateIndex = store.index('creation_time');\n\n\t\tconst invoices  = []\n\t\tconst request   = dateIndex.openCursor(null , 'prev') //use prev for descenfing order\n\n\t\trequest.onsuccess = (event) =>{\n\t\t\tconst cursor = event.target.result;\n\t\t\tif(cursor){\n\t\t\t\tinvoices.push(cursor.value);\n\t\t\t\tcursor.continue() //Move to the next record\n\t\t\t}else{\n\t\t\t\tconsole.log('check the response : ' , invoices)\n\t\t\t\tonSuccess(invoices);\n\t\t\t}\n\t\t};\n\t\trequest.onerror = (err)=>{\n\t\t\tonFailure(err)\n\t\t}\n\t}\n\n\tgetDraftPosInvoice(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction_posInvoice     = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\t\tconst store_posInvoice           = transaction_posInvoice.objectStore('POS Invoice');\n\t\t\tconst index_docstatus_posInvoice = store_posInvoice.index('docstatus');\n\t\t\tconst request = index_docstatus_posInvoice.getAll(0);\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\tresolve(event.target.result);\n\t\t\t};\n\t\t\trequest.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\n\t}\n\n\tgetNotSyncedPosNumber(onSuccess,onFailure){\n\t\t\tconst transaction_posInvoice     = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\t\tconst store_posInvoice           = transaction_posInvoice.objectStore('POS Invoice');\n\t\t\tconst index_docstatus_posInvoice = store_posInvoice.index('docstatus');\n\t\t\tconst request = index_docstatus_posInvoice.getAll(1);\n\t\t\trequest.onsuccess = (result) => {\n\t\t\t\tconst filtredResult = result.target.result.filter(invoice => invoice.synced == false )\n\t\t\t\tonSuccess(filtredResult.length);\n\t\t\t}\n\t\t\trequest.onerror = (err) => {\n\t\t\t\tonFailure(err);\n\t\t\t}\n\t}\n\n\n\tgetNotSyncedPos(onSuccess,onFailure){\n\t\tconst transaction_posInvoice     = this.db.transaction(['POS Invoice'] , \"readwrite\");\n\t\tconst store_posInvoice           = transaction_posInvoice.objectStore('POS Invoice');\n\t\tconst index_docstatus_posInvoice = store_posInvoice.index('docstatus');\n\t\tconst request = index_docstatus_posInvoice.getAll(1);\n\t\trequest.onsuccess = (result) => {\n\t\t\tconst filtredResult = result.target.result.filter(invoice => invoice.synced == false )\n\t\t\tonSuccess(filtredResult);\n\t\t}\n\t\trequest.onerror = (err) => {\n\t\t\tonFailure(err);\n\t\t}\n\t}\n\n\t// New delete function to remove a POS Invoice\n\tdeletePosInvoice(invoiceName) {\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Invoice'], \"readwrite\");\n\t\t\tconst store = transaction.objectStore('POS Invoice');\n\t\t\tconst request = store.delete(invoiceName);  // Deletes the record with the key 'invoiceName', (i set the name as keypath , in erpnext name is the id.)\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tresolve();  // Call success callback if the deletion is successful\n\t\t\t};\n\t\t\trequest.onerror = (err) => {\n\t\t\t\treject(err);  // Call failure callback if there is an error\n\t\t\t};\n\t\t})\n\t}\n\n\t// New delete function to remove a POS Invoice\n\tdeletePosInvoice_callback(invoiceName,onSuccess,onFailure) {\n\t\tconst transaction = this.db.transaction(['POS Invoice'], \"readwrite\");\n\t\tconst store = transaction.objectStore('POS Invoice');\n\t\tconst request = store.delete(invoiceName);  // Deletes the record with the key 'invoiceName', (i set the name as keypath , in erpnext name is the id.)\n\t\trequest.onsuccess = () => {\n\t\t\tonSuccess();  // Call success callback if the deletion is successful\n\t\t};\n\t\trequest.onerror = (err) => {\n\t\t\tonFailure(err);  // Call failure callback if there is an error\n\t\t};\n\t}\n\n\tdeleteAllPosInvoice() {\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Invoice'], 'readwrite');\n\t\t\tconst store = transaction.objectStore('POS Invoice');\n\t\t\tconst request = store.clear(); // Clear all entries in the store\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\trequest.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\t}\n\n\n\n\t/********************************* check_in_out ***********************************************/\n\n\tsaveCheckInOut(checkInOut,onSuccess,onFailure){\n\t\tconsole.log(\"saveCheckInOut : \" , checkInOut)\n\t\tconst transaction = this.db.transaction(['check_in_out'] , \"readwrite\");\n\t\tconst store       = transaction.objectStore('check_in_out')\n\t\tconst request     = store.put(checkInOut)\n\t\trequest.onsuccess = (event) => {\n\t\t\tonSuccess(event.target.result);\n\t\t};\n\t\trequest.onerror = (err) => {\n\t\t\tonFailure(err);\n\t\t};\n\t}\n\n\t\n\n\tgetAllCheckInOut(){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['check_in_out'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('check_in_out');\n\t\t\tconst dateIndex   = store.index('creation_time');\n\t\t\tconst checks      = []\n\t\t\tconst request     = dateIndex.openCursor(null , 'prev') //use prev for descenfing order\n\n\n\t\t\trequest.onsuccess = (event) =>{\n\t\t\t\tconst cursor = event.target.result;\n\t\t\t\tif(cursor){\n\t\t\t\t\tchecks.push(cursor.value);\n\t\t\t\t\tcursor.continue() //Move to the next record\n\t\t\t\t}else{\n\t\t\t\t\tconsole.log('check the response : ' , checks)\n\t\t\t\t\tresolve(checks);\n\t\t\t\t}\n\t\t\t};\n\t\t\trequest.onerror = (err)=>{\n\t\t\t\treject(err)\n\t\t\t}\n\t\t})\n\t}\n\n\n\tgetAllCheckInOut_callback(onSuccess,onFailure){\n\t\tconst transaction = this.db.transaction(['check_in_out'] , \"readwrite\");\n\t\tconst store       = transaction.objectStore('check_in_out');\n\n\t\tconst dateIndex   = store.index('creation_time');\n\t\tconst checks      = []\n\t\tconst request     = dateIndex.openCursor(null , 'prev') //use prev for descenfing order\n\n\n\t\trequest.onsuccess = (event) =>{\n\t\t\tconst cursor = event.target.result;\n\t\t\tif(cursor){\n\t\t\t\tchecks.push(cursor.value);\n\t\t\t\tcursor.continue() //Move to the next record\n\t\t\t}else{\n\t\t\t\tconsole.log('check the response : ' , checks)\n\t\t\t\tonSuccess(checks);\n\t\t\t}\n\t\t};\n\t\trequest.onerror = (err)=>{\n\t\t\tonFailure(err)\n\t\t}\n\n\t}\n\n\tdeleteAllCheckInOut() {\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['check_in_out'], 'readwrite');\n\t\t\tconst store = transaction.objectStore('check_in_out');\n\t\t\tconst request = store.clear(); // Clear all entries in the store\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\trequest.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\t}\n\n\tupdateCheckInOutSync(date) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst transaction = this.db.transaction(['check_in_out'], 'readwrite');\n\t\t\tconst store = transaction.objectStore('check_in_out');\n\t\t\tconst request = store.getAll();\n\t\t\t\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\tconst records = event.target.result;\n\t\t\t\tconst updatePromises = []; // Define the array here\n\t\t\t\t\n\t\t\t\trecords.forEach(record => {\n\t\t\t\t\tconsole.log(\"date : \" , new Date(record.creation_time) , \"the dat \" , new Date(date) ,\"record :  \",record)\n\t\t\t\t\tif (!record.is_sync && new Date(record.creation_time) <= new Date(date)) {\n\t\t\t\t\t\trecord.is_sync = 1;\n\t\t\t\t\t\tupdatePromises.push(new Promise((resolveUpdate, rejectUpdate) => {\n\t\t\t\t\t\t\tconst updateRequest = store.put(record);\n\t\t\t\t\t\t\tupdateRequest.onsuccess = () => resolveUpdate();\n\t\t\t\t\t\t\tupdateRequest.onerror = (err) => rejectUpdate(err);\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tPromise.all(updatePromises)\n\t\t\t\t\t.then(() => resolve())\n\t\t\t\t\t.catch(err => reject(err));\n\t\t\t};\n\t\t\t\n\t\t\trequest.onerror = (err) => reject(err);\n\t\t});\n\t}\n\n\tupdateCheckInOutSync_callback(date, onSuccess, onFailure) {\n\t\tconst transaction = this.db.transaction(['check_in_out'], 'readwrite');\n\t\tconst store = transaction.objectStore('check_in_out');\n\t\tconst request = store.getAll();\n\t\t\n\t\trequest.onsuccess = (event) => {\n\t\t\tconst records = event.target.result;\n\t\t\tlet updatedCount = 0;\n\t\t\tlet totalToUpdate = 0;\n\t\t\t\n\t\t\t// First count how many records need updating\n\t\t\trecords.forEach(record => {\n\t\t\t\tif (!record.is_sync && new Date(record.creation) <= new Date(date)) {\n\t\t\t\t\ttotalToUpdate++;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (totalToUpdate === 0) {\n\t\t\t\tonSuccess();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\trecords.forEach(record => {\n\t\t\t\tif (!record.is_sync && new Date(record.creation) <= new Date(date)) {\n\t\t\t\t\trecord.is_sync = 1;\n\t\t\t\t\tconst updateRequest = store.put(record);\n\t\t\t\t\t\n\t\t\t\t\tupdateRequest.onsuccess = () => {\n\t\t\t\t\t\tupdatedCount++;\n\t\t\t\t\t\tif (updatedCount === totalToUpdate) {\n\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tupdateRequest.onerror = (err) => {\n\t\t\t\t\t\tonFailure(err);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\t\n\t\trequest.onerror = (err) => onFailure(err);\n\t}\n\n\t/****************************** pos settings *********************************/\n\t/*****************************************************************************/\n\t/*****************************************************************************/\n\n\tupdateSettings(settings){\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Settings'] , \"readwrite\");\n\t\t\tconst store       = transaction.objectStore('POS Settings')\n\t\t\tconst request     = store.put({id : 1 , ...settings});\n\t\t\trequest.onsuccess = (event) => {\n\t\t\t\tresolve(event.target.result);\n\t\t\t};\n\t\t\trequest.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\t}\n\t//callback version\n\tupdateSettings_callback(settings,onSuccess,onFailure){\n\t\tconst transaction = this.db.transaction(['POS Settings'] , \"readwrite\");\n\t\tconst store       = transaction.objectStore('POS Settings')\n\t\tconst request     = store.put({id : 1 , ...settings});\n\t\trequest.onsuccess = (event) => {\n\t\t\tonSuccess(event.target.result);\n\t\t};\n\t\trequest.onerror = (err) => {\n\t\t\tonFailure(err);\n\t\t};\n\t}\n\n\n\tgetSettings(onSuccess,onFailure) {\n\t\tconst transaction = this.db.transaction(['POS Settings'], 'readwrite');\n\t\tconst store = transaction.objectStore('POS Settings');\n\t\tconst request = store.get(1); // Get the settings using the unique ID\n\t\trequest.onsuccess = (event) => {\n\t\t\tonSuccess(event.target.result);\n\t\t};\n\t\trequest.onerror = (err) => {\n\t\t\tonFailure(err);\n\t\t};\n\t}\n\n\tdeleteAllSettings() {\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tconst transaction = this.db.transaction(['POS Settings'], 'readwrite');\n\t\t\tconst store = transaction.objectStore('POS Settings');\n\t\t\tconst request = store.clear(); // Clear all entries in the store\n\t\t\trequest.onsuccess = () => {\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\trequest.onerror = (err) => {\n\t\t\t\treject(err);\n\t\t\t};\n\t\t})\n\t}\n\n}\n", "pos_ar.PointOfSale.pos_settings = class{\n\n\tconstructor(\n\t\twrapper,\n\t\tsettingsData,\n\t\tselectedPosProfile,\n\t\tonSettingsChange,\n\t){\n\t\tthis.wrapper              = wrapper            ;\n\t\tthis.settings_data        = settingsData       ;\n\t\tthis.selected_pos_profile = selectedPosProfile ;\n\t\tthis.on_settings_change   = onSettingsChange   ;\n\t\t//scene\n\t\tthis.scene = 'pos_profile'\n\n\t\tthis.start_work()\n\t}\n\n\tstart_work(){\n\t\tthis.prepareSettingsCart();\n\t\tthis.refreshLeftSection();\n\t\tthis.setListener();\n\t}\n\n\n\tprepareSettingsCart(){\n\t\tthis.wrapper.find('#RightSection').append('<div id=\"settingsRightContainer\" class=\"columnBox\"></div>')\n\t\tthis.wrapper.find('#LeftSection').append('<div id=\"settingsLeftContainer\" class=\"columnBox\"></div>')\n\n\t\tthis.leftContainer = this.wrapper.find('#settingsLeftContainer')\n\t\tthis.rightContainer  = this.wrapper.find('#settingsRightContainer')\n\n\n\t\t//right section\n\t\tthis.rightContainer.append('<div id=\"pos_profile_btn\"      class=\"settings_tab active\" >POS Profile</div>')\n\t\tthis.rightContainer.append('<div id=\"general_settings_btn\" class=\"settings_tab\"        >Generale Settings</div>')\n\t\tthis.rightContainer.append('<div id=\"about_us_btn\"         class=\"settings_tab\"        >About Us</div>')\n\n\t\tthis.pos_profile_btn      = this.rightContainer.find('#pos_profile_btn')\n\t\tthis.general_settings_btn = this.rightContainer.find('#general_settings_btn')\n\t\tthis.about_us_btn         = this.rightContainer.find('#about_us_btn')\n\t}\n\n\trefreshLeftSection(){\n\t\tthis.leftContainer.html('')\n\t\tif(this.scene == 'pos_profile'){\n\t\t\tthis.refreshPosProfileScene();\n\t\t}else if(this.scene == 'general_settings'){\n\t\t\tthis.refreshGeneralSettings();\n\t\t}else if(this.scene == \"about_us\"){\n\t\t\tthis.refreshAboutUs();\n\t\t}\n\t}\n\n\trefreshPosProfileScene(){\n\t\t//left container\n\t\tthis.leftContainer.addClass('columnBox')\n\t\tthis.leftContainer.append('<h4 class=\"CartTitle\" style=\"margin-bottom:35px; font-size:35px;\" >POS Profile</h4>')\n\t\tthis.leftContainer.append('<div id=\"settingsCartContentsContainer\">  </div>')\n\t\tthis.contentsContainer = this.leftContainer.find('#settingsCartContentsContainer');\n\n\t\t//pos profile:\n\t\tthis.contentsContainer.append('<div id=\"posProfileContent\" class=\"contentContainer rowBox\" style=\"width:100%;\"> <div class=\"c1 columnBox\"></div>   <div class=\"c2 columnBox\"></div> </div>')\n\t\tthis.pos_profile_content = this.contentsContainer.find('#posProfileContent')\n\t\tthis.c1 = this.pos_profile_content.find('div.c1')\n\t\tthis.c2 = this.pos_profile_content.find('div.c2')\n\n\t\tthis.c1.append('<label for=\"pos_profile\"> POS Profile </label>')\n\t\tthis.c1.append('<select  name=\"pos_profile\" id=\"posProfileSelect\" disabled ></select>')\n\n\t\tthis.pos_profile_select = this.c1.find('#posProfileSelect')\n\t\tthis.pos_profile_select.append(`<option value=\"${this.selected_pos_profile.name} selected \">${this.selected_pos_profile.name}</option>`)\n\n\t\tthis.c1.append(`<label for=\"warehouse\">POS Warehouse</label>`)\n\t\tthis.c1.append(`<input name=\"warehouse\" value=\"${this.selected_pos_profile.warehouse}\" disabled>`)\n\n\t\tthis.c1.append(`<label for=\"income_account\">POS income account</label>`)\n\t\tthis.c1.append(`<input name=\"income_account\" value=\"${this.selected_pos_profile.income_account}\" disabled>`)\n\n\t\tthis.c2.append(`<label for=\"write_off_account\">POS write off account</label>`)\n\t\tthis.c2.append(`<input name=\"write_off_account\" value=\"${this.selected_pos_profile.write_off_account}\" disabled>`)\n\n\t\tthis.c2.append(`<label for=\"write_off_cost_center\">POS write off cost center</label>`)\n\t\tthis.c2.append(`<input name=\"write_off_cost_center\" value=\"${this.selected_pos_profile.write_off_cost_center}\" disabled>`)\n\n\t\tthis.c2.append(`<label for=\"taxes_and_charges\">POS taxes and charges</label>`)\n\t\tthis.c2.append(`<input name=\"taxes_and_charges\" value=\"${this.selected_pos_profile.taxes_and_charges}\" disabled>`)\n\n\t}\n\n\n\trefreshGeneralSettings(){\n\n\t\tconst priceBase           = this.settings_data.settings.itemPriceBasedOn\n\t\tconst showItemDetailsCart = this.settings_data.settings.showItemDetails   ? \"checked\" : \"\"\n\t\tconst showItemImage       = this.settings_data.settings.showItemImage     ? \"checked\" : \"\"\n\t\tconst showDiscountField   = this.settings_data.settings.showDiscountField ? \"checked\" : \"\"\n\t\tconst searchByGroup       = this.settings_data.settings.search_by_group   ? \"checked\" : \"\"\n\t\tconst onlineDebt          = this.settings_data.settings.onlineDebt        ? \"checked\" : \"\"\n\t\tconst sendInvoiceToOtherPos = this.settings_data.settings.sendInvoiceToOtherPos ? \"checked\" : \"\"\n\t\tconst keyboardStyle       = this.settings_data.settings.keyboard_style\n\n\t\tconsole.log(\"check it here : \" , this.settings_data.settings.onlineDebt);\n\n\t\t//left container\n\t\tthis.leftContainer.addClass('columnBox')\n\t\tthis.leftContainer.append('<h4 class=\"CartTitle\" style=\"margin-bottom:35px; font-size:35px;\" >General Settings</h4>')\n\t\tthis.leftContainer.append('<div id=\"settingsCartContentsContainer\">  </div>')\n\t\tthis.contentsContainer = this.leftContainer.find('#settingsCartContentsContainer');\n\n\t\t//settings :\n\t\tthis.contentsContainer.append('<div id=\"generalSettingsContent\" class=\"contentContainer rowBox\" style=\"width:100%;\"> <div class=\"c1 columnBox\"></div>   <div class=\"c2 columnBox\"></div> </div>')\n\t\tthis.general_settings_content = this.contentsContainer.find('#generalSettingsContent')\n\t\tthis.general_settings_c1 = this.general_settings_content.find('div.c1')\n\t\tthis.general_settings_c2 = this.general_settings_content.find('div.c2')\n\n\t\t//price base on\n\t\tthis.general_settings_c1.append('<label for=\"priceBasedOn\" style=\"font-weight:600;\"> Item Price Based On : </label>')\n\t\tthis.general_settings_c1.append('<select  name=\"priceBasedOn\" id=\"priceBasedOnSelect\" ></select>')\n\t\tthis.item_price_based_on_select = this.general_settings_c1.find('#priceBasedOnSelect')\n\n\t\tthis.settings_data.getAllPriceBases().forEach( base =>{\n\t\t\tif(this.settings_data.settings.itemPriceBasedOn == base){\n\t\t\t\tthis.item_price_based_on_select.append(`<option value=\"${base}\" selected> ${base} </option>`)\n\t\t\t}else{\n\t\t\t\tthis.item_price_based_on_select.append(`<option value=\"${base}\"> ${base} </option>`)\n\t\t\t}\n\t\t})\n\n\n\t\t//keyboard style\n\t\tthis.general_settings_c2.append('<label for=\"keyboardStyle\" style=\"font-weight:600;\"> Keyboard Style : </label>')\n\t\tthis.general_settings_c2.append('<select  name=\"keyboardStyle\" id=\"keyboardStyle\" ></select>')\n\t\tthis.keyboard_style_select = this.general_settings_c2.find('#keyboardStyle')\n\n\t\tthis.settings_data.getAllKeyboardStyles().forEach( style =>{\n\t\t\tif(this.settings_data.settings.keyboardStyle == style){\n\t\t\t\tthis.keyboard_style_select.append(`<option value=\"${style}\" selected> ${style} </option>`)\n\t\t\t}else{\n\t\t\t\tthis.keyboard_style_select.append(`<option value=\"${style}\"> ${style} </option>`)\n\t\t\t}\n\t\t})\n\n\n\t\tthis.general_settings_c2.append('<div for=\"showItemDetailsCartCheckBox\" style=\"font-weight:600;\"> Get Client Debt OnLine : </div>')\n\t\tthis.general_settings_c2.append(`<div class=\"rowBox align_center\" style=\"height:50px;\"><label for=\"onlineDebtCheckBox\" style=\"margin-right:16px;width:50%;\" > online debt: </label> <input type=\"checkbox\"  name=\"onlineDebtCheckBox\" id=\"onlineDebtCheckBoxCheckBox\" ${onlineDebt} ></div>`)\n\n\t\t//send invoice to other pos\n\t\tthis.general_settings_c2.append('<div for=\"sendInvoiceToOtherPosCheckBox\" style=\"font-weight:600;\"> Send Invoice To Other POS : </div>')\n\t\tthis.general_settings_c2.append(`<div class=\"rowBox align_center\" style=\"height:50px;\"><label for=\"sendInvoiceToOtherPosCheckBox\" style=\"margin-right:16px;width:50%;\" > send invoice: </label> <input type=\"checkbox\"  name=\"sendInvoiceToOtherPosCheckBox\" id=\"sendInvoiceToOtherPosCheckBox\" ${sendInvoiceToOtherPos} ></div>`)\n\n\t\t//show item details cart\n\t\tthis.general_settings_c1.append('<div for=\"showItemDetailsCartCheckBox\" style=\"font-weight:600;\"> Item Details Cart : </div>')\n\t\tthis.general_settings_c1.append(`<div class=\"rowBox align_center\" style=\"height:50px;\"><label for=\"showItemDetailsCartCheckBox\" style=\"margin-right:16px;width:50%;\" > show cart: </label> <input type=\"checkbox\"  name=\"showItemDetailsCartCheckBox\" id=\"showItemDetailsCartCheckBox\" ${showItemDetailsCart} ></div>`)\n\n\t\t//show item details cart\n\t\tthis.general_settings_c1.append('<div for=\"showItemDetailsCartCheckBox\" style=\"font-weight:600;\"> Item Image : </div>')\n\t\tthis.general_settings_c1.append(`<div class=\"rowBox align_center\" style=\"height:50px;\" ><label for=\"showItemImageCheckBox\" style=\"margin-right:16px;width:50%;\"> show item image: </label> <input type=\"checkbox\"  name=\"showItemImageCheckBox\" id=\"showItemImageCheckBox\" ${showItemImage} ></div>`)\n\n\t\t//show item details cart\n\t\tthis.general_settings_c1.append('<div for=\"showItemDetailsCartCheckBox\" style=\"font-weight:600;\"> Discount feature : </div>')\n\t\tthis.general_settings_c1.append(`<div class=\"rowBox align_center\" style=\"height:50px;\" ><label for=\"showDiscountFieldCheckBox\" style=\"margin-right:16px;width:50%;\"> show discount field: </label> <input type=\"checkbox\"  name=\"showDiscountFieldCheckBox\" id=\"showDiscountFieldCheckBox\" ${showDiscountField} ></div>`)\n\n\t\t//show item details cart\n\t\tthis.general_settings_c1.append('<div for=\"showItemDetailsCartCheckBox\" style=\"font-weight:600;\"> filter item by group : </div>')\n\t\tthis.general_settings_c1.append(`<div class=\"rowBox align_center\" style=\"height:50px;\" ><label for=\"showItemGroupFilterCheckBox\" style=\"margin-right:16px;width:50%;\"> show item group filter: </label> <input type=\"checkbox\"  name=\"showItemGroupFilterCheckBox\" id=\"showItemGroupFilterCheckBox\" ${searchByGroup} ></div>`)\n\n\n\t\t//set listeners\n\t\tthis.item_price_based_on_select.on('input' , (event)=>{\n\t\t\tthis.settings_data.setPriceItemBasedOn(\n\t\t\t\tevent.target.value,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"itemPriceBasedOn\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\n\t\tthis.keyboard_style_select.on('input' , (event)=>{\n\t\t\tthis.settings_data.settings.keyboardStyle =  event.target.value\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"showItemImage\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\n\t\tthis.general_settings_c1.find(\"#showItemDetailsCartCheckBox\").on('click' , (event)=>{\n\t\t\tthis.settings_data.settings.showItemDetails =  $(event.target).is(':checked')\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"showItemDetails\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t\tthis.general_settings_c1.find(\"#showItemImageCheckBox\").on('click' , (event)=>{\n\t\t\tthis.settings_data.settings.showItemImage =  $(event.target).is(':checked')\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"showItemImage\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t\tthis.general_settings_c1.find(\"#showDiscountFieldCheckBox\").on('click' , (event)=>{\n\t\t\tthis.settings_data.settings.showDiscountField =  $(event.target).is(':checked')\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"showDiscountField\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t\tthis.general_settings_c1.find(\"#showItemGroupFilterCheckBox\").on('click' , (event)=>{\n\t\t\tthis.settings_data.settings.search_by_group =  $(event.target).is(':checked')\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"search_by_group\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t\tthis.general_settings_c2.find('#onlineDebtCheckBoxCheckBox').on('click' , (event)=>{\n\t\t\tthis.settings_data.settings.onlineDebt =  $(event.target).is(':checked')\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (pos_settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t\tthis.general_settings_c2.find(\"#sendInvoiceToOtherPosCheckBox\").on('click' , (event)=>{\n\t\t\tthis.settings_data.settings.sendInvoiceToOtherPos =  $(event.target).is(':checked')\n\t\t\tthis.settings_data.setSettings(\n\t\t\t\tthis.settings_data.settings,\n\t\t\t\t()=>{\n\t\t\t\t\tthis.on_settings_change(\"sendInvoiceToOtherPos\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error to save the settings changes (settings.js)\")\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\n\n\t}\n\trefreshAboutUs(){\n\t\t//left container\n\t\tthis.leftContainer.addClass('columnBox')\n\t\tthis.leftContainer.append('<h4 class=\"CartTitle\" style=\"margin-bottom:35px; font-size:35px;\" >About Us</h4>')\n\t\tthis.leftContainer.append('<div id=\"settingsCartContentsContainer\">  </div>')\n\t\tthis.contentsContainer = this.leftContainer.find('#settingsCartContentsContainer');\n\n\t}\n\n\n\tshowCart(){\n\t\tthis.rightContainer.css('display' , 'flex')\n\t\tthis.leftContainer.css('display' , 'flex')\n\t}\n\thideCart(){\n\t\tthis.rightContainer.css('display' , 'none')\n\t\tthis.leftContainer.css('display' , 'none')\n\t}\n\n\t/*********************** set listener  ********************************/\n\n\tsetListener(){\n\t\tconst tabs = document.querySelectorAll('.settings_tab');\n\t\tconst all_content = document.querySelectorAll('.contentContainer')\n\n\t\ttabs.forEach((tab , index)=>{\n\t\t\ttab.addEventListener('click' , ()=>{\n\t\t\t\ttabs.forEach(tab => {\n\t\t\t\t\ttab.classList.remove('active');\n\t\t\t\t})\n\t\t\t\ttab.classList.add('active');\n\t\t\t})\n\t\t})\n\n\n\t\tthis.pos_profile_btn.on('click' , (event)=>{\n\t\t\tthis.scene = 'pos_profile';\n\t\t\tthis.refreshLeftSection();\n\t\t})\n\n\n\t\tthis.general_settings_btn.on('click' , (event)=>{\n\t\t\tthis.scene = 'general_settings';\n\t\t\tthis.refreshLeftSection()\n\t\t})\n\n\t\tthis.about_us_btn.on('click' , (event)=>{\n\t\t\tthis.scene = 'about_us';\n\t\t\tthis.refreshLeftSection()\n\t\t})\n\n\t}\n\n\n}\n", "pos_ar.PointOfSale.pos_check_in_out = class {\n\n\tconstructor(\n\t\twrapper,\n\t\tdb\n\t){\n\t\tthis.wrapper   = wrapper;\n\t\tthis.db        = db;\n\n\t\t//local\n\t\tthis.checkList = [];\n\t\tthis.filter    = 'All';\n\t\tthis.selectedCheckInOut = null;\n\n\t\tthis.start_work();\n\t}\n\n\tstart_work(){\n\t\tthis.prepare_checkInOut_cart();\n\t\tthis.getAllCheckInOut();\n\t\tthis.setListeners();\n\t}\n\n\t/****************************************    UI    *******************************************************/\n\n\tprepare_checkInOut_cart(){\n\t\tthis.wrapper.find('#LeftSection').append('<div id=\"checkInOutLeftContainer\" class=\"columnBox\"></div>')\n\t\tthis.wrapper.find('#RightSection').append('<div id=\"checkInOutRightContainer\" class=\"columnBox\"></div>')\n\n\t\tthis.left_container  = this.wrapper.find('#checkInOutLeftContainer')\n\t\tthis.right_container = this.wrapper.find('#checkInOutRightContainer')\n\n\t\t///////////////////right section\n\t\t//checkInOut tab\n\t\tthis.right_container.append('<div id=\"checkInOutTabContainer\" class=\"rowBox\">  <div id=\"tabAll\" class=\"tab selected\">All</div> <div id=\"tabCheckIn\" class=\"tab\">Check In</div> <div id=\"tabCheckOut\" class=\"tab\">Check Out</div>  </div>')\n\t\tthis.tab_container = this.right_container.find('#checkInOutTabContainer')\n\t\tthis.tab_all = this.tab_container.find('#tabAll')\n\t\tthis.tab_in  = this.tab_container.find('#tabCheckIn')\n\t\tthis.tab_out = this.tab_container.find('#tabCheckOut')\n\t\t//checkInOut list\n\t\tthis.right_container.append('<div id=\"checkInOutList\" class=\"columnBox\"></div>')\n\t\tthis.check_in_out_list = this.right_container.find('#checkInOutList')\n\n\t\t//////////////////now left section\n\t\tconst header =\n\t\t\t'<div id=\"detailsCheckInOutHeader\" class=\"rowBox\" >'+\n\t\t\t\t'<div class=\"checkInAmount columnBox\" >'+\n\t\t\t\t\t'<div class=\"rowBox centerItem\" style=\"width:100%;height:50%;\">'+\n\t\t\t\t\t\t'<div style=\"font-size:25px; font-weight:700;\">Check In</div>'+\n\t\t\t\t\t'</div>'+\n\t\t\t\t\t'<div id=\"TotalCheckInValue\" class=\"rowBox centerItem\" style=\"height:50%; width:100%;\">...DA</div>'+\n\t\t\t\t'</div>'+\n\t\t\t\t'<div class=\"checkOutAmount columnBox\" >'+\n\t\t\t\t\t'<div class=\"rowBox centerItem\" style=\"width:100%;height:50%;\" >'+\n\t\t\t\t\t\t'<div style=\"font-size:25px; font-weight:700;\">Check Out</div>'+\n\t\t\t\t\t'</div>'+\n\t\t\t\t\t'<div id=\"TotalCheckOutValue\" class=\"rowBox centerItem\" style=\"width:100%;height:50%;\"> ...DA </div>'+\n\t\t\t\t'</div>'+\n\t\t\t\t'<div class=\"totalCheckInOutAmount columnBox centerItem\">'+\n\t\t\t\t\t'<div class=\"rowBox centerItem\" style=\"width:100%;height:50%;\">'+\n\t\t\t\t\t\t'<div style=\"font-size:25px; font-weight:700;\">Total</div>'+\n\t\t\t\t\t'</div>'+\n\t\t\t\t\t'<div id=\"TotalCheckInOutValue\" class=\"rowBox centerItem\" style=\"height:50%; width:100%;\">...DA</div>'+\n\t\t\t\t'</div>'+\n\t\t\t'</div>'\n\t\tthis.left_container.append(header)\n\t\tthis.details_checkInOut_header = this.left_container.find('#detailsCheckInOutHeader')\n\n\t\t//Amounts\n\t\tthis.check_in_amount           = this.details_checkInOut_header.find('#TotalCheckInValue')\n\t\tthis.check_out_amount          = this.details_checkInOut_header.find('#TotalCheckOutValue')\n\t\tthis.check_total_in_out_amount = this.details_checkInOut_header.find('#TotalCheckInOutValue')\n\n\n\t\t// one checkInOut details content\n\t\tthis.left_container.append('<div id=\"detailsCheckInOutContent\" class=\"columnBox\"></div>')\n\t\tthis.detailsCheckInOutContent = this.left_container.find('#detailsCheckInOutContent')\n\t\tconst details =\n\t\t\t'<div class=\"l1 rowBox\">'+\n\t\t\t\t'<div><span class=\"key\">Check Type :<span> <span id=\"selectedCheckInOutType\" class=\"value\"> THE_TYPE </span></div>'+\n\t\t\t\t'<div><span class=\"value\" id=\"selectedCheckInOutCreationTime\"> THE_DATE </span></div>'+\n\t\t\t'</div>'+\n\t\t\t'<div class=\"l2 rowBox\">'+\n\t\t\t\t'<div><span class=\"key\">Amount :</span> <span id=\"selectedCheckInOutAmount\" class=\"value\">THE AMOUNT</span></div>'+\n\t\t\t\t'<div><span id=\"selectedCheckInOutOwner\" class=\"value\">THE OWNER</span></div>'+\n\t\t\t'</div>'+\n\t\t\t'<div class=\"l3\">'+\n\t\t\t\t'<div class=\"title\">Reason</div>'+\n\t\t\t\t'<textarea id=\"selectedCheckInOutReason\" disabled ></textarea>'+\n\t\t\t'</div>'\n\t\tthis.detailsCheckInOutContent.append(details)\n\n\t\tthis.checkType         = this.detailsCheckInOutContent.find('#selectedCheckInOutType')\n\t\tthis.checkAmount       = this.detailsCheckInOutContent.find('#selectedCheckInOutAmount')\n\t\tthis.checkCreationTime = this.detailsCheckInOutContent.find('#selectedCheckInOutCreationTime')\n\t\tthis.checkOwner        = this.detailsCheckInOutContent.find('#selectedCheckInOutOwner')\n\t\tthis.checkReason       = this.detailsCheckInOutContent.find('#selectedCheckInOutReason')\n\t}\n\n\trefreshCheckInOutList(){\n\t\tthis.check_in_out_list.empty();\n\n\t\tconsole.log(\"this.checkList : \" , this.checkList)\n\n\t\tconst filteredList = this.checkList.filter( item => item.check_type == this.filter || this.filter == 'All')\n\n\t\tfilteredList.forEach(checkInOut =>{\n\n\t\t\tconst checkInOutObject = document.createElement('div')\n\t\t\tcheckInOutObject.classList.add('checkInOutItem','rowBox')\n\t\t\t//type div container\n\t\t\tconst type_div = document.createElement('div')\n\t\t\ttype_div.classList.add('type')\n\t\t\t//type img image\n\t\t\tconst type_img           = document.createElement('img')\n\t\t\ttype_img.src             = '/assets/pos_ar/images/arrow.png'\n\t\t\ttype_img.style.width     = '35px'\n\t\t\ttype_img.style.height    = '35px'\n\t\t\ttype_img.style.transform = checkInOut.check_type === 'In' ? 'rotate(180deg)' : ''\n\n\t\t\tconsole.log(\"checkInOut.check_type : \" , checkInOut.check_type === 'In' ? 'rotate(180deg);' : '')\n\n\t\t\t//type div value\n\t\t\tconst type_value_div       = document.createElement('div')\n\t\t\ttype_value_div.textContent = checkInOut.check_type\n\t\t\t//creation time\n\t\t\tconst creationTimeDiv = document.createElement('div');\n\t\t\tcreationTimeDiv.classList.add('creationTime')\n\t\t\tcreationTimeDiv.textContent = checkInOut.creation_time;\n\t\t\t//amount div\n\t\t\tconst amountDiv       = document.createElement('div')\n\t\t\tamountDiv.classList.add('amount')\n\t\t\tamountDiv.textContent = checkInOut.amount + ' DA'\n\t\t\t//linking stage\n\t\t\ttype_div.append(type_img)\n\t\t\ttype_div.append(type_value_div)\n\t\t\tcheckInOutObject.append(type_div)\n\t\t\tcheckInOutObject.append(creationTimeDiv)\n\t\t\tcheckInOutObject.append(amountDiv)\n\n\n\t\t\t//set listener\n\t\t\tcheckInOutObject.addEventListener('click' , ()=>{\n\t\t\t\tthis.selectedCheckInOut = checkInOut ;\n\t\t\t\tthis.refreshCheckInOutDetails()\n\t\t\t});\n\n\t\t\tthis.check_in_out_list.append(checkInOutObject)\n\t\t})\n\n\t}\n\n\trefreshCheckInOutAmount(){\n\t\tthis.check_total_in_out_amount.html('');\n\t\tthis.check_in_amount.html('');\n\t\tthis.check_out_amount.html('');\n\n\t\tlet inAmount  = 0.00 ;\n\t\tlet outAmount = 0.00 ;\n\t\tlet allAmount = 0.00 ;\n\n\t\tthis.checkList.forEach(item =>{\n\t\t\tallAmount += parseFloat(item.amount) || 0.00;\n\t\t\tif(item.check_type == 'In')\n\t\t\t\tinAmount += parseFloat(item.amount) || 0.00;\n\t\t\telse if(item.check_type == 'Out')\n\t\t\t\toutAmount += parseFloat(item.amount) || 0.00;\n\t\t})\n\t\tthis.check_in_amount.append(`${inAmount.toFixed(2)} DA`)\n\t\tthis.check_out_amount.append(`${outAmount.toFixed(2)} DA`)\n\t\tthis.check_total_in_out_amount.append(`${allAmount.toFixed(2)} DA`)\n\t}\n\n\trefreshCheckInOutDetails(){\n\n\t\tif(this.selectedCheckInOut == null)\n\t\t\treturn;\n\n\t\tthis.checkType.html('')\n\t\tthis.checkCreationTime.html('')\n\t\tthis.checkReason.html('')\n\t\tthis.checkOwner.html('')\n\t\tthis.checkAmount.html('')\n\n\t\tthis.checkType.append(this.selectedCheckInOut.check_type)\n\t\tthis.checkCreationTime.append(this.selectedCheckInOut.creation_time)\n\t\tthis.checkAmount.append(this.selectedCheckInOut.amount + ' DA')\n\t\tthis.checkReason.append(this.selectedCheckInOut.reason || this.selectedCheckInOut.reason_note)\n\t\tthis.checkOwner.append(this.selectedCheckInOut.owner)\n\n\t\tconsole.log(\"this.checkReason.scrollHeight : \" , this.checkReason.get(0).scrollHeight)\n\t\tthis.checkReason.get(0).style.height = 'auto';\n\t\tthis.checkReason.get(0).style.height = this.checkReason.get(0).scrollHeight + 'px'\n\t}\n\n\n\n\t//show && hide functions\n\tshowCart(){\n\t\tthis.left_container.css('display','flex')\n\t\tthis.right_container.css('display','flex')\n\t}\n\thideCart(){\n\t\tthis.left_container.css('display','none')\n\t\tthis.right_container.css('display','none')\n\t}\n\n\t/*****************************************  listener  **************************************************/\n\t/********************************************************************************************************/\n\n\tsetListeners(){\n\t\tthis.tab_all.on('click' , (event)=>{\n\t\t\tthis.filter = 'All'\n\t\t\tthis.tab_all.addClass('selected')\n\t\t\tthis.tab_out.removeClass('selected')\n\t\t\tthis.tab_in.removeClass('selected')\n\t\t\tthis.refreshCheckInOutList();\n\t\t})\n\t\tthis.tab_in.on('click' , (event)=>{\n\t\t\tthis.filter = 'In'\n\t\t\tthis.tab_in.addClass('selected')\n\t\t\tthis.tab_out.removeClass('selected')\n\t\t\tthis.tab_all.removeClass('selected')\n\t\t\tthis.refreshCheckInOutList();\n\t\t})\n\t\tthis.tab_out.on('click' , (event)=>{\n\t\t\tthis.filter = 'Out'\n\t\t\tthis.tab_out.addClass('selected')\n\t\t\tthis.tab_all.removeClass('selected')\n\t\t\tthis.tab_in.removeClass('selected')\n\t\t\tthis.refreshCheckInOutList();\n\t\t})\n\t}\n\n\t/*****************************************  functions  **************************************************/\n\t/********************************************************************************************************/\n\n\tasync getAllCheckInOut(){\n\t\tthis.db.getAllCheckInOut_callback(\n\t\t\t(res)=>{\n\t\t\t\tif(res.length > 0){\n\t\t\t\t\tthis.selectedCheckInOut = res[0]\n\t\t\t\t}\n\t\t\t\tthis.checkList = res ;\n\t\t\t\tthis.refreshCheckInOutList();\n\t\t\t\tthis.refreshCheckInOutAmount();\n\t\t\t\tthis.refreshCheckInOutDetails();\n\t\t\t\tconsole.log(\"res : \" , res)\n\t\t\t},(err)=>{\n\t\t\t\tconsole.log(\"err : \" , err)\n\t\t\t}\n\t\t)\n\t}\n\n}\n", "pos_ar.PointOfSale.pos_debt_cart = class{\n\n\tconstructor(\n\t\twrapper,\n\t\tappData,\n\t\trefreshCheckInOut\n\t){\n\t\tthis.wrapper              = wrapper\n\t\tthis.app_data             = appData\n\t\tthis.refresh_check_in_out = refreshCheckInOut \n\n\t\t//local vars\n\t\tthis._filtredClientList = this.app_data.appData.customers\n\t\tthis.selected_client = {}\n\t\tthis.payment_amount = 0\n\n\t\tthis._pos_invoice      = []\n\t\tthis._sales_invoice    = []\n\n\t\tthis._selected_invoice = []\n\n\t\tthis.start_work()\n\t}\n\n\tstart_work(){\n\t\tthis.prepare_cart()\n\t\tthis.refreshClientPart()\n\t\tthis.setListener()\n\t}\n\n\tprepare_cart(){\n\t\tthis.wrapper.find('#LeftSection').append('<div id=\"debtLeftContainer\" class=\"columnBox\"></div>')\n\t\tthis.wrapper.find('#RightSection').append('<div id=\"debtRightContainer\" class=\"columnBox\"></div>')\n\n\t\tthis.leftContainer  = this.wrapper.find('#debtLeftContainer')\n\t\tthis.rightContainer = this.wrapper.find('#debtRightContainer')\n\n\t\t// Customer search section\n\t\tthis.rightContainer.append(`\n\t\t\t<div class=\"debt-header\">\n\t\t\t\t<input type=\"text\" \n\t\t\t\t\tid=\"debt_filterClientList\" \n\t\t\t\t\tplaceholder=\"Search customers...\"\n\t\t\t\t>\n\t\t\t</div>\n\t\t\t<div id=\"debt_customerList\"></div>\n\t\t`)\n\n\t\tthis.customerList = this.rightContainer.find('#debt_customerList')\n\n\t\t// Payment section\n\t\tthis.leftContainer.append(`\n\t\t\t<div class=\"payment-header\">\n\t\t\t\t<div class=\"amount-input\">\n\t\t\t\t\t<input id=\"debt_paymentAmount\" type=\"number\" placeholder=\"Enter amount\">\n\t\t\t\t</div>\n\t\t\t\t<div id=\"total_client_debt\">Total: 0 DA</div>\n\t\t\t\t<div id=\"partially_client_debt\">Selected: 0 DA</div>\n\t\t\t\t<button id=\"pay_selected_invoices_btn\">Pay</button>\n\t\t\t</div>\n\t\t\t<div id=\"debt_debtsList\"></div>\n\t\t`)\n\n\t\t// Loading animation\n\t\tthis.leftContainer.append(`\n\t\t\t<script src=\"https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs\" type=\"module\"></script>\n\t\t\t<div id=\"debt_waitingContainer\" style=\"display:none;\">\n\t\t\t\t<dotlottie-player \n\t\t\t\t\tsrc=\"https://lottie.host/d6c76206-aab9-4d5a-af73-c4a6cfc5aaa9/H8vnpKcKj9.lottie\" \n\t\t\t\t\tbackground=\"transparent\" \n\t\t\t\t\tspeed=\"1\" \n\t\t\t\t\tstyle=\"width: 300px; height: 300px\" \n\t\t\t\t\tloop \n\t\t\t\t\tautoplay\n\t\t\t\t></dotlottie-player>\n\t\t\t</div>\n\t\t`)\n\n\t\t// Initialize components\n\t\tthis.waiting_cart = this.leftContainer.find('#debt_waitingContainer')\n\t\tthis.total_client_debt = this.leftContainer.find('#total_client_debt')\n\t\tthis.partially_client_debt = this.leftContainer.find('#partially_client_debt')\n\t\tthis.pay_selected_invoices_btn = this.leftContainer.find('#pay_selected_invoices_btn')\n\t\tthis.debtList = this.leftContainer.find('#debt_debtsList')\n\t}\n\n\tadd_customer_to_list(customer) {\n\t\tconst customerElement = document.createElement('div')\n\t\tcustomerElement.className = 'customer-item'\n\t\tcustomerElement.innerHTML = `\n\t\t\t<div class=\"customer-name\">${customer.customer_name}</div>\n\t\t\t<div class=\"customer-info\">\n\t\t\t\t<span>${customer.customer_primary_contact || ''}</span>\n\t\t\t\t<span>${customer.mobile_no || ''}</span>\n\t\t\t</div>\n\t\t`\n\t\t\n\t\tcustomerElement.addEventListener('click', () => {\n\t\t\tthis.customerList.find('.customer-item').removeClass('selected')\n\t\t\tcustomerElement.classList.add('selected')\n\t\t\t\n\t\t\t// Update the selected customer and refresh the debt part\n\t\t\tthis.selected_client = structuredClone(customer)\n\t\t\tthis.refreshClientDebtPart(customer)\n\t\t})\n\n\t\tthis.customerList.append(customerElement)\n\t}\n\n\tshowCart(){\n\t\tthis.leftContainer.css('display' , 'flex')\n\t\tthis.rightContainer.css('display' , 'flex')\n\t}\n\thideCart(){\n\t\tthis.leftContainer.css('display' , 'none')\n\t\tthis.rightContainer.css('display' , 'none')\n\t}\n\n\tshow_waiting(){\n\t\tthis.waiting_cart.css('display' , 'flex')\n\t}\n\thide_waiting(){\n\t\tthis.waiting_cart.css('display' , 'none')\n\t}\n\n\tsetListener(){\n\t\t//filter clients\n\t\tthis.rightContainer.find(\"#debt_filterClientList\").on('input' , event =>{\n\t\t\tconst value = this.rightContainer.find(\"#debt_filterClientList\").val().trim().toLowerCase();\n\t\t\tthis._filtredClientList = this.app_data.appData.customers.filter(customer =>\n\t\t\t\tcustomer.customer_name.toLowerCase().includes(value)\n\t\t\t);\n \t\t\tthis.refreshClientPart()\n\n\t\t})\n\t\tthis.leftContainer.find(\"#debt_paymentAmount\").on('input',event =>{\n\t\t\tthis.payment_amount = parseFloat(this.leftContainer.find(\"#debt_paymentAmount\").val())\n\t\t})\n\t\tthis.pay_selected_invoices_btn.on('click' , async () =>{\n\t\t\tconsole.log(\"check the list ==> \" , this._selected_invoice)\n\t\t\tthis.paySelectedInvoice()\n\t\t})\n\t\tthis.debtList.on('click', '.invoiceBox input[type=\"checkbox\"]', event => {\n\t\t\tconst checkbox                 = $(event.target);\n\t\t\tconst invoiceName              = checkbox.data('invoice-name');\n\t\t\tconst invoiceOutstandingAmount = checkbox.data('outstanding-amount')\n\t\t\tconst invoiceType              = checkbox.data('invoice-type')\n\n\t\t\tconst invoice_data = { 'name' : invoiceName , 'outstanding_amount' : invoiceOutstandingAmount , 'type' : invoiceType }\n\n\t\t\tif (checkbox.is(':checked')) {\n\t\t\t\t// Add the invoice name to the selected list\n\t\t\t\tif (!this._selected_invoice.some(invoice => invoice.name == invoiceName)) {\n\t\t\t\t\tthis._selected_invoice.push(invoice_data);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Remove the invoice name from the selected list\n\t\t\t\tconst index = this._selected_invoice.findIndex(invoice => invoice.name == invoiceName);\n\t\t\t\tif (index > -1) {\n\t\t\t\t\tthis._selected_invoice.splice(index, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.refresh_partially_paid()\n\t\t});\n\n\t}\n\n\trefreshClientPart(){\n\n\t\tthis.customerList.html('')\n\t\tthis._filtredClientList.forEach(customer=>{\n\t\t\tthis.add_customer_to_list(customer)\n\t\t})\n\t}\n\n\trefreshTotal(total_debt){\n\t\tthis.total_client_debt.text(`Total Debt : ${total_debt} DA`);\n\t}\n\trefresh_partially_paid(){\n\t\t//calculate the client selected pos debt based on selected check box\n\t\tlet partially_paid = 0 ;\n\t\tthis._selected_invoice.forEach(invoice=>{\n\t\t\tpartially_paid += invoice.outstanding_amount\n\t\t})\n\n\t\tthis.partially_client_debt.text(`Selected Debt : ${partially_paid} DA`)\n\t}\n\n\tasync  refreshClientDebtPart(customer){\n\t\t//make the total text to loading... indicator rather than false value.\n\t\tthis.refreshTotal( \"Loading ...\" );\n\t\tthis._selected_invoice = []\n\t\tthis.refresh_partially_paid();\n\n\t\t//styles\n\t\tconst invoiceStyle = 'width:calc(100% - 40px);height:60px;min-height:60px;border-bottom:2px solid #505050;'\n\t\tconst payBtnStyle  = 'width:80px;height:35px;color:white;background:green;border-radius:12px;margin:0px 20px;cursor:pointer;'\n\n\t\tlet total_debt = 0 ;\n\n\t\tthis.debtList.html('')\n\t\tconst result  = await this.app_data.fetchDebts(customer.name)\n\t\tconst result2 = await this.app_data.fetchDebtsSalesInvoices(customer.name)\n\n\t\tresult.forEach(invoice=>{\n\n\t\t\ttotal_debt += invoice.outstanding_amount ;\n\n\t\t\tconst customerBox = $(\n\t\t\t\t`<div  style=\"${invoiceStyle}\" class=\"rowBox C_A_Center invoiceBox\" data-invoice-name=\"${invoice.name}\"></div>`\n\t\t\t)\n\t\t\tconst checkbox = $(`<input type=\"checkbox\" class=\"select_checkbox\" style=\"margin:0px 16px;\" data-invoice-type=\"POS Invoice\" data-invoice-name=\"${invoice.name}\" data-outstanding-amount=\"${invoice.outstanding_amount}\" ></input>`)\n\t\t\t//customerBox.append(checkbox)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">${invoice.name}</div>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">${invoice.outstanding_amount} DA</div>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">${invoice.posting_date}</div>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">POS Invoice</div>`)\n\t\t\tcustomerBox.append(`<div class=\"rowBox centerItem payBtn\" style=\"${payBtnStyle}\">Pay</div>`)\n\n\t\t\t // Set up the click event listener for the Pay button\n\t\t\tcustomerBox.find('.payBtn').on('click', async () => {\n\t\t\t\t// Get the invoice name from the customerBox\n\t\t\t\t//const invoiceName = customerBox.data('invoice-name');\n\t\t\t\t// Proceed to pay the invoice with a predefined payment amount (e.g., 1000 DA)\n\t\t\t\tawait this.payPosInvoice(invoice);\n\t\t\t});\n\n\n\t\t\tthis.debtList.append(customerBox)\n\t\t})\n\n\t\tresult2.forEach(invoice=>{\n\t\t\ttotal_debt += invoice.outstanding_amount ;\n\n\t\t\tconst customerBox = $(\n\t\t\t\t`<div  style=\"${invoiceStyle}\" class=\"rowBox C_A_Center invoiceBox\" data-invoice-name=\"${invoice.name}\"></div>`\n\t\t\t)\n\t\t\tcustomerBox.append(`<input type=\"checkbox\" style=\"margin:0px 16px;\" data-invoice-type=\"Sales Invoice\" data-invoice-name=\"${invoice.name}\" data-outstanding-amount=\"${invoice.outstanding_amount}\" ></input>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">${invoice.name}</div>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">${invoice.outstanding_amount} DA</div>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">${invoice.posting_date}</div>`)\n\t\t\tcustomerBox.append(`<div style=\"flex-grow:1;\">Sales Invoice</div>`)\n\t\t\tcustomerBox.append(`<div class=\"rowBox centerItem payBtn\" style=\"${payBtnStyle}\">Pay</div>`)\n\n\t\t\t // Set up the click event listener for the Pay button\n\t\t\tcustomerBox.find('.payBtn').on('click', async () => {\n\t\t\t\t// Get the invoice name from the customerBox\n\t\t\t\t//const invoiceName = customerBox.data('invoice-name');\n\t\t\t\t// Proceed to pay the invoice with a predefined payment amount (e.g., 1000 DA)\n\t\t\t\tawait this.paySalesInvoice(invoice);\n\t\t\t});\n\t\t\tthis.debtList.append(customerBox)\n\t\t})\n\n\n\n\t\tthis.refreshTotal( total_debt );\n\n\n\t}\n\n\n\tasync payPosInvoice(invoice) {\n\n\t\t// Ensure the payment amount is a valid float\n\t\tconst paymentAmount = parseFloat(this.payment_amount) || 0;\n\t\tif(this.paymentAmount <= 0){\n\t\t\tfrappe.msgprint(__('The paid amount should be grant than 0'));\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis.show_waiting();\n\n\t\t\t// Call the server method to update the invoice payment\n\t\t\tconst result = await this.app_data.update_invoice_payment(invoice.name, this.payment_amount);\n\n\t\t\t// Update the payment amount and UI\n\t\t\tthis.payment_amount = result.remaining;\n\t\t\tthis.leftContainer.find(\"#debt_paymentAmount\").val(result.remaining);\n\n\t\t\t// Refresh the client's debt details\n\t\t\tawait this.refreshClientDebtPart(this.selected_client);\n\t\t} catch (error) {\n\t\t\t// Handle errors gracefully\n\t\t\tconsole.error(\"Error processing payment:\", error);\n\n\t\t\t// Optional: Notify the user about the error\n\t\t\talert(\"An error occurred while processing the payment. Please try again.\");\n\t\t} finally {\n\t\t\t// Ensure waiting spinner is hidden regardless of success or failure\n\t\t\tthis.hide_waiting();\n\t\t}\n\t}\n\n\tasync paySalesInvoice(invoice) {\n\t\ttry {\n\t\t\tthis.show_waiting();\n\n\t\t\t// Ensure the payment amount is a valid float\n\t\t\tconst paymentAmount = parseFloat(this.payment_amount) || 0;\n\n\t\t\tif(paymentAmount <= 0){\n\t\t\t\tfrappe.msgprint(__('The paid amount should be grant than 0'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Call the server method to update the invoice payment\n\t\t\tconst result = await this.app_data.update_sales_invoice_payment(invoice.name, paymentAmount);\n\n\t\t\t// add check in to the voucher.\n\t\t\tconst check_in_amount  = this.payment_amount - result.remaining;\n\t\t\tconst checkInOut         = frappe.model.get_new_doc('check_in_out')\n\t\t\tcheckInOut.creation_time = frappe.datetime.now_datetime();\n\t\t\tcheckInOut.user          = frappe.session.user;\n\t\t\tcheckInOut.check_type    = 'In';\n\t\t\tcheckInOut.is_sync       = 0 ;\n\t\t\tcheckInOut.amount        = parseFloat(check_in_amount);\n\t\t\tcheckInOut.reason_note   = 'Debt payment.';\n\t\t\t\n\t\t\t\n\t\t\tthis.app_data.saveCheckInOut(\n\t\t\t\tcheckInOut,\n\t\t\t\t(res)=>{\n\t\t\t\t\tthis.refresh_check_in_out()\n\t\t\t\t},(err)=>{\n\t\t\t\t\tconsole.log('err to save checkInOut : ' , err)\n\t\t\t\t}\n\t\t\t)\n\n\t\t\t// Ensure result is valid and contains the `remaining` field\n\t\t\tif (result && typeof result.remaining === \"number\") {\n\t\t\t\t// Update the payment amount and UI\n\t\t\t\tthis.payment_amount = result.remaining;\n\t\t\t\tthis.leftContainer.find(\"#debt_paymentAmount\").val(result.remaining);\n\n\t\t\t\t// Refresh the client's debt details\n\t\t\t\tawait this.refreshClientDebtPart(this.selected_client);\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Unexpected server response. Please try again.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Log the error for debugging purposes\n\t\t\tconsole.error(\"Error processing sales invoice payment:\", error);\n\n\t\t\t// Notify the user about the error\n\t\t\talert(\"An error occurred while processing the payment. Please try again later.\");\n\t\t} finally {\n\t\t\t// Ensure the waiting spinner is hidden regardless of success or failure\n\t\t\tthis.hide_waiting();\n\t\t}\n\t}\n\n\n\n\tasync paySelectedInvoice() {\n\t\ttry {\n\t\t\tthis.show_waiting();\n\n\t\t\t// Ensure the payment amount is a valid float\n\t\t\tconst paymentAmount = parseFloat(this.payment_amount) || 0;\n\n\t\t\t// Call the server method to update the invoice payment\n\t\t\tconst result = await this.app_data.paySelectedInvoice(this._selected_invoice , paymentAmount);\n\n\t\t\t// add check in to the voucher.\n\t\t\tconst check_in_amount    = paymentAmount - result.remaining;\n\t\t\tconst checkInOut         = frappe.model.get_new_doc('check_in_out')\n\t\t\tcheckInOut.creation_time = frappe.datetime.now_datetime();\n\t\t\tcheckInOut.user          = frappe.session.user;\n\t\t\tcheckInOut.check_type    = 'In';\n\t\t\tcheckInOut.is_sync       = 0   ;\n\t\t\tcheckInOut.amount        = parseFloat(check_in_amount);\n\t\t\tcheckInOut.reason_note   = 'Debt payment.';\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\tthis.app_data.saveCheckInOut(\n\t\t\t\tcheckInOut,\n\t\t\t\t(res)=>{\n\t\t\t\t\tthis.refresh_check_in_out()\n\t\t\t\t},(err)=>{\n\t\t\t\t\tconsole.log('err to save checkInOut : ' , err)\n\t\t\t\t}\n\t\t\t)\n\n\t\t\t// Ensure result is valid and contains the `remaining` field\n\t\t\tif (result && typeof result.remaining === \"number\") {\n\t\t\t\t// Update the payment amount and UI\n\t\t\t\tthis.payment_amount = result.remaining;\n\t\t\t\tthis.leftContainer.find(\"#debt_paymentAmount\").val(result.remaining);\n\n\t\t\t\t// Refresh the client's debt details\n\t\t\t\tawait this.refreshClientDebtPart(this.selected_client);\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Unexpected server response. Please try again.\");\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// Log the error for debugging purposes\n\t\t\tconsole.error(\"Error processing sales invoice payment:\", error);\n\n\t\t\t// Notify the user about the error\n\t\t\talert(\"An error occurred while processing the payment. Please try again later.\");\n\t\t} finally {\n\t\t\t// Ensure the waiting spinner is hidden regardless of success or failure\n\t\t\tthis.hide_waiting();\n\t\t}\n\t}\n\n\n\n\n\n}\n", "pos_ar.PointOfSale.pos_unsynced_cart = class {\n\n    constructor(\n        wrapper,\n        appData,\n        db,\n        viewDetailsCallback,\n        onDeleteCallback\n    ){\n        this.wrapper   = wrapper;\n        this.app_data  = appData;\n        this.db        = db;\n        this.view_details_callback = viewDetailsCallback ;\n        this.on_delete_callback = onDeleteCallback;\n\n        //local data\n        this.invoices = [];\n        this.filter = 'All';\n        this.selectedInvoice = null;\n        this.search_value = '';\n\n        this.start_work();\n    }\n\n    /****************************************    INIT    *******************************************************/\n    async start_work() {\n        this.prepare_unsynced_pos_cart();\n        await this.getAllUnsyncedInvoices();\n        this.setListeners();\n    }\n\n    /****************************************    UI    *******************************************************/\n    prepare_unsynced_pos_cart() {\n        this.wrapper.find('#LeftSection').append('<div id=\"unsyncedPosLeftContainer\" class=\"columnBox\" style=\"display:none;\"></div>')\n        this.wrapper.find('#RightSection').append('<div id=\"unsyncedPosRightContainer\" class=\"columnBox\" style=\"display:none;\"></div>')\n\n        this.left_container = this.wrapper.find('#unsyncedPosLeftContainer')\n        this.right_container = this.wrapper.find('#unsyncedPosRightContainer')\n\n        ///////////////////right section\n        this.right_container.append(`<div id=\"unsyncedRightContainerHeader\" class=\"rowBox align_center\"><h4 class=\"CartTitle\">Unsynced Invoices</h4></div>`)\n        \n        //search and filter\n        this.right_container.append('<div id=\"unsyncedRightSearchContainer\" class=\"rowBox align_center\"></div>');\n        this.search_container = this.right_container.find('#unsyncedRightSearchContainer');\n        \n        this.search_container.append('<select id=\"unsyncedFilterInput\" placeholder=\"Filter Status\">');\n        this.filter_input = this.search_container.find(\"#unsyncedFilterInput\")\n        this.filter_input.append('<option value=\"All\" selected>All</option><option value=\"Not Synced\">Not Synced</option><option value=\"Failed\">Failed</option>')\n        \n        this.search_container.append('<input type=\"text\" id=\"unsyncedSearchInput\" placeholder=\"Search by invoice number\">');\n        this.search_field = this.search_container.find(\"#unsyncedSearchInput\")\n\n        //invoice list\n        this.right_container.append('<div id=\"unsyncedInvoiceList\" class=\"columnBox\"></div>')\n        this.unsynced_invoice_list = this.right_container.find('#unsyncedInvoiceList')\n\n        //////////////////now left section\n        //header with status and amounts\n        const header =\n            '<div id=\"detailsUnsyncedHeader\" class=\"rowBox\">' +\n                '<div class=\"c1 columnBox\">' +\n                    '<div id=\"unsyncedCustomer\">Customer</div>' +\n                    '<div id=\"unsyncedSoldBy\"></div>' +\n                    '<div id=\"unsyncedStatus\" class=\"status\"></div>' +\n                '</div>' +\n                '<div class=\"c2 columnBox\">' +\n                    '<div id=\"unsyncedCost\">0,0000 DA</div>' +\n                    '<div id=\"unsyncedId\">ACC-PSINV-2024-ID</div>' +\n                    '<div id=\"unsyncedRealId\">POS realI</div>' +\n                '</div>' +\n            '</div>'\n        this.left_container.append(header)\n        this.details_unsynced_header = this.left_container.find('#detailsUnsyncedHeader')\n\n        // invoice details content\n        this.left_container.append('<div id=\"unsyncedContent\" class=\"columnBox\"></div>')\n        this.unsyncedContent = this.left_container.find('#unsyncedContent')\n        \n        //items section\n        this.unsyncedContent.append('<div id=\"unsyncedItemContainer\"><div class=\"posSectionTitle\">Items</div><div id=\"unsyncedItemList\"></div></div>')\n        this.itemContainer = this.unsyncedContent.find('#unsyncedItemContainer')\n        this.itemList = this.itemContainer.find('#unsyncedItemList')\n\n        //totals section\n        this.unsyncedContent.append('<div id=\"unsyncedTotalsContainer\"><div class=\"posSectionTitle\">Totals</div><div id=\"unsyncedTotalList\"></div></div>')\n        this.totalsContainer = this.unsyncedContent.find('#unsyncedTotalsContainer')\n        this.totalList = this.unsyncedContent.find('#unsyncedTotalList')\n\n        //payments section\n        this.unsyncedContent.append('<div id=\"unsyncedPaymentsContainer\"><div class=\"posSectionTitle\">Payments</div><div id=\"unsyncedMethodList\"></div></div>')\n        this.paymentsContainer = this.unsyncedContent.find('#unsyncedPaymentsContainer')\n        this.methodList = this.unsyncedContent.find('#unsyncedMethodList')\n\n        //action buttons\n        this.left_container.append('<div id=\"unsyncedActionsContainer\" class=\"rowBox align_content\">' +\n            '<div id=\"unsyncedRetryBtn\" class=\"actionBtn rowBox centerItem\">Retry Sync</div>' +\n            '<div id=\"unsyncedViewBtn\" class=\"actionBtn rowBox centerItem\">View Details</div>' +\n        '</div>')\n\n        this.actionButtonsContainer = this.left_container.find('#unsyncedActionsContainer')\n        this.retryButton = this.actionButtonsContainer.find('#unsyncedRetryBtn')\n        this.viewButton = this.actionButtonsContainer.find('#unsyncedViewBtn')\n    }\n\n    refreshData() {\n        this.unsynced_invoice_list.empty();\n        \n        console.log(\"refreshing unsynced invoice list\" , this.invoices , \"unsynced \" , this.invoices.filter(invoice => !invoice.synced))\n        const filteredList = this.invoices.filter(invoice => !invoice.synced)\n        if (!filteredList.length) {\n            this.unsynced_invoice_list.append('<div class=\"empty-state\">No unsynced invoices found</div>');\n            return;\n        }\n\n        filteredList.forEach(invoice => {\n            const invoiceContainer = document.createElement('div');\n            invoiceContainer.classList.add('posInvoiceContainer')\n            invoiceContainer.classList.add('columnBox')\n            invoiceContainer.classList.add('align_content')\n\n            //line 1\n            const l1 = document.createElement('div')\n            l1.classList.add('l1')\n            l1.classList.add('rowBox')\n            l1.classList.add('align_content')\n\n            const posName = document.createElement('div')\n            posName.classList.add('posName')\n            posName.textContent = invoice.name\n\n            const posCost = document.createElement('div')\n            posCost.classList.add('posCost')\n            posCost.textContent = format_currency(invoice.grand_total, invoice.currency)\n\n            l1.appendChild(posName)\n            l1.appendChild(posCost)\n\n            //line 2\n            const l2 = document.createElement('div')\n            l2.classList.add('l2')\n            l2.classList.add('rowBox')\n            l2.classList.add('align_content')\n\n            //l2 customer\n            const customer = document.createElement('div')\n            customer.classList.add('customer')\n            customer.classList.add('rowBox')\n            customer.classList.add('align_content')\n\n            const customerLogo = document.createElement('img')\n            customerLogo.src = '/assets/pos_ar/images/customer.png'\n            customerLogo.width = 16\n            customerLogo.height = 16\n            customerLogo.classList.add('customerLogo')\n\n            const customerName = document.createElement('div')\n            customerName.textContent = invoice.customer || 'Guest'\n            customerName.classList.add('customerName')\n\n            customer.appendChild(customerLogo)\n            customer.appendChild(customerName)\n\n            l2.appendChild(customer)\n\n            //l2 status\n            const status = document.createElement('div')\n            status.classList.add('status')\n            status.classList.add(invoice.status.toLowerCase().replace(' ', '-'))\n            status.textContent = invoice.status\n            l2.appendChild(status)\n\n            // Add delete button\n            const deleteBtn = document.createElement('button');\n            deleteBtn.classList.add('invoice-delete-btn');\n            deleteBtn.innerHTML = `<i class=\"fa fa-trash fa-lg\"></i>`;\n            l2.appendChild(deleteBtn);\n\n            // Add click event for delete button\n            deleteBtn.addEventListener('click', (e) => {\n                e.stopPropagation();  // Prevent invoice selection when clicking delete\n                this.app_data.deletePosInvoice_callback(\n                    invoice.name,\n                    ()=>{\n                        this.getAllUnsyncedInvoices()\n                        this.on_delete_callback()\n                        //this.refreshInvoiceDetails()\n                    },(err)=>{\n                        console.error('Error deleting invoice:', err);\n                        frappe.msgprint({\n                            title: __('Error'),\n                            indicator: 'red',\n                            message: __('Failed to delete invoice')\n                        });\n                    }\n                );\n            });\n\n            //add all to container\n            invoiceContainer.appendChild(l1)\n            invoiceContainer.appendChild(l2)\n\n            invoiceContainer.addEventListener('click', () => {\n                this.selectedInvoice = invoice;\n                this.refreshInvoiceDetails();\n                console.log(\"selected invoice : \" , this.selectedInvoice)\n                this.unsynced_invoice_list.find('.posInvoiceContainer').removeClass('selected');\n                $(invoiceContainer).addClass('selected');\n            })\n\n            this.unsynced_invoice_list.append(invoiceContainer);\n        });\n\n        //refresh details if needed\n        if (this.selectedInvoice) {\n            this.refreshInvoiceDetails();\n        }\n    }\n\n    refreshInvoiceDetails() {\n        // Check if selected invoice exists and is still in the invoices list\n        if (!this.selectedInvoice || !this.invoices.find(inv => inv.name === this.selectedInvoice.name)) {\n            this.selectedInvoice = null;\n            this.unsyncedContent.addClass('d-none');\n            // Clear all data\n            const header = this.details_unsynced_header;\n            header.find('#unsyncedCustomer').text('');\n            header.find('#unsyncedSoldBy').text('');\n            header.find('#unsyncedStatus').text('').removeClass();\n            header.find('#unsyncedCost').text('');\n            header.find('#unsyncedId').text('');\n            header.find('#unsyncedRealId').text('');\n            this.itemList.empty();\n            this.totalList.empty();\n            this.methodList.empty();\n            return;\n        }\n\n        this.unsyncedContent.removeClass('d-none');\n        \n        //update header\n        const header = this.details_unsynced_header;\n        header.find('#unsyncedCustomer').text(this.selectedInvoice.customer || 'Guest');\n        header.find('#unsyncedSoldBy').text(this.selectedInvoice.owner);\n        header.find('#unsyncedStatus').text(this.selectedInvoice.status)\n            .removeClass('not-synced failed')\n            .addClass(this.selectedInvoice.status.toLowerCase().replace(' ', '-'));\n        header.find('#unsyncedCost').text(format_currency(this.selectedInvoice.grand_total, this.selectedInvoice.currency));\n        header.find('#unsyncedId').text(this.selectedInvoice.name);\n        header.find('#unsyncedRealId').text(this.selectedInvoice.pos_profile);\n\n        //update items\n        this.itemList.empty();\n        this.selectedInvoice.items.forEach(item => {\n            const itemRow = document.createElement('div');\n            itemRow.classList.add('itemRow', 'rowBox');\n            \n            const itemName = document.createElement('div');\n            itemName.classList.add('itemName');\n            itemName.textContent = item.item_name;\n            \n            const itemQty = document.createElement('div');\n            itemQty.classList.add('itemQty');\n            itemQty.textContent = item.qty;\n            \n            const itemRate = document.createElement('div');\n            itemRate.classList.add('itemRate');\n            itemRate.textContent = format_currency(item.rate, this.selectedInvoice.currency);\n            \n            const itemAmount = document.createElement('div');\n            itemAmount.classList.add('itemAmount');\n            itemAmount.textContent = format_currency(item.amount, this.selectedInvoice.currency);\n            \n            itemRow.appendChild(itemName);\n            itemRow.appendChild(itemQty);\n            itemRow.appendChild(itemRate);\n            itemRow.appendChild(itemAmount);\n            \n            this.itemList.append(itemRow);\n        });\n\n        //update totals\n        this.totalList.empty();\n        const totalRow = document.createElement('div');\n        totalRow.classList.add('totalRow', 'rowBox');\n        \n        const totalLabel = document.createElement('div');\n        totalLabel.classList.add('totalLabel');\n        totalLabel.textContent = 'Grand Total';\n        \n        const totalAmount = document.createElement('div');\n        totalAmount.classList.add('totalAmount');\n        totalAmount.textContent = format_currency(this.selectedInvoice.grand_total, this.selectedInvoice.currency);\n        \n        totalRow.appendChild(totalLabel);\n        totalRow.appendChild(totalAmount);\n        this.totalList.append(totalRow);\n\n        //update payments\n        this.methodList.empty();\n        this.selectedInvoice.payments.forEach(payment => {\n            const paymentRow = document.createElement('div');\n            paymentRow.classList.add('paymentRow', 'rowBox');\n            \n            const paymentMode = document.createElement('div');\n            paymentMode.classList.add('paymentMode');\n            paymentMode.textContent = payment.mode_of_payment;\n            \n            const paymentAmount = document.createElement('div');\n            paymentAmount.classList.add('paymentAmount');\n            paymentAmount.textContent = format_currency(payment.amount, this.selectedInvoice.currency);\n            \n            paymentRow.appendChild(paymentMode);\n            paymentRow.appendChild(paymentAmount);\n            \n            this.methodList.append(paymentRow);\n        });\n    }\n\n    show_cart() {\n        this.left_container.css(\"display\", \"flex\");\n        this.right_container.css(\"display\", \"flex\");\n        this.getAllUnsyncedInvoices();\n    }\n\n    hide_cart() {\n        this.left_container.css(\"display\", \"none\");\n        this.right_container.css(\"display\", \"none\");\n    }\n\n    async getAllUnsyncedInvoices() {\n        this.invoices = await this.db.getAllPosInvoice()\n        this.refreshData();\n        this.refreshInvoiceDetails();\n    }\n\n    async retrySync(invoice) {\n\n        frappe.db.insert(\n            invoice\n        ).then(r =>{\n            const updatedPos = structuredClone(invoice)\n            updatedPos.synced = true;\n            updatedPos.real_name = r.name\n            this.appData.updatePosInvoice(updatedPos)\n            \n            //this.customer_box.setSynced();\n            //this.unsyncedPos = 0;\n            \n        }).catch(err =>{\n            console.error('Error retrying sync:', err);\n            frappe.msgprint({\n                title: __('Error'),\n                indicator: 'red',\n                message: __('Failed to sync invoice')\n            });\n        })\n    }\n\n    async deleteInvoice(invoice_name) {\n        if (!confirm('Are you sure you want to delete this unsynced invoice?')) {\n            return;\n        }\n        \n        try {\n            \n            // Remove from local list\n            //this.invoices = this.invoices.filter(inv => inv.name !== invoice_name);\n            this.refreshData();\n            frappe.show_alert({\n                message: __('Invoice deleted successfully'),\n                indicator: 'green'\n            });\n        } catch (error) {\n            frappe.show_alert({\n                message: __('Failed to delete invoice'),\n                indicator: 'red'\n            });\n        }\n    }\n\n    setListeners() {\n        this.filter_input.on('change', () => {\n            this.filter = this.filter_input.val();\n            this.refreshData();\n        });\n\n        this.search_field.on('input', () => {\n            this.search_value = this.search_field.val();\n            this.refreshData();\n        });\n\n        this.retryButton.on('click', () => {\n            if (this.selectedInvoice) {\n                this.retrySync(this.selectedInvoice);\n            }\n        });\n\n        this.viewButton.on('click', () => {\n            if (this.selectedInvoice) {\n                this.view_details_callback(this.selectedInvoice)\n            }\n        });\n    }\n}", "pos_ar.PointOfSale.posSettingsData = class{\n\n\n\tconstructor(db){\n\n\t\tthis.db = db;\n\t\t//Array of valid values\n\t\tthis.price_bases     = ['brand'   , 'priceList']\n\t\tthis.keyboard_styles = ['primery' , 'secondary']\n\n\t\tconst defaults = {\n\t\t\titemPriceBasedOn  : 'brand'     ,\n\t\t\tkeyboardStyle     : 'secondary' ,\n\t\t\tshowItemDetails   : false       ,\n\t\t\tshowItemImage     : false       ,\n\t\t\tshowDiscountField : false       ,\n\t\t\tonlineDebt        : true        ,\n\t\t\ttesting           : false,\n\t\t\tsearch_by_group   : false,\n\t\t\tsendInvoiceToOtherPos : false\n\t\t}\n\n\n\t\t//Default setting (it could be more)\n\t\tthis.db.getSettings(\n\n\t\t\t(res)=>{\n\t\t\t\tif(res && res.itemPriceBasedOn ){\n\t\t\t\t\tthis.settings = {...defaults , ...( res || {} ) }\n\t\t\t\t}else{\n\t\t\t\t\t//default\n\t\t\t\t\tthis.settings = {\n\t\t\t\t\t\titemPriceBasedOn  : 'brand'     ,\n\t\t\t\t\t\tkeyboardStyle     : 'secondary' ,\n\t\t\t\t\t\tshowItemDetails   : false       ,\n\t\t\t\t\t\tshowItemImage     : false       ,\n\t\t\t\t\t\tshowDiscountField : false       ,\n\t\t\t\t\t\tonlineDebt        : true        ,\n\t\t\t\t\t\tsearch_by_group   : false,\n\t\t\t\t\t\tsendInvoiceToOtherPos : false\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\"test result : \" , this.settings)\n\n\t\t\t},\n\t\t\t(err)=>{\n\t\t\t\tconsole.log(\"error when trying to get the setting from local, so we use the default.\")\n\t\t\t\tthis.settings = {\n\t\t\t\t\titemPriceBasedOn  : 'brand'     ,\n\t\t\t\t\tkeyboardStyle     : 'secondary' ,\n\t\t\t\t\tshowItemDetails   : false       ,\n\t\t\t\t\tshowItemImage     : false       ,\n\t\t\t\t\tshowDiscountField : false       ,\n\t\t\t\t\tonlineDebt        : true        ,\n\t\t\t\t\tsearch_by_group   : false,\n\t\t\t\t\tsendInvoiceToOtherPos : false\n\t\t\t\t}\n\n\t\t\t}\n\t\t)\n\t}\n\n\tgetAllPriceBases(){\n\t\treturn this.price_bases;\n\t}\n\tgetAllKeyboardStyles(){\n\t\treturn this.keyboard_styles;\n\t}\n\n\t//PriceItemBasedOn\n\tgetPriceBase(){\n\t\treturn this.settings.itemPriceBasedOn;\n\t}\n\tsetPriceItemBasedOn(base , onSuccess , onFailure){\n\t\tif(this.price_bases.includes(base)){\n\t\t\tthis.settings.itemPriceBasedOn = base\n\t\t\tthis.db.updateSettings_callback(\n\t\t\t\tthis.settings,\n\t\t\t\t()=>{\n\t\t\t\t\t//saved\n\t\t\t\t\tonSuccess();\n\t\t\t\t\tconsole.log(\"settings update is save successfuly\")\n\t\t\t\t},()=>{\n\t\t\t\t\tconsole.error(\"error occured when trying to save settings\")\n\t\t\t\t}\n\t\t\t)\n\t\t}else{\n\t\t\tconsole.error(\"invalide base : \" , base , \"there are just : \" , this.price_bases)\n\t\t}\n\t}\n\n\t//show item details\n\tgetShowItemDetails(){\n\t\treturn this.settings.showItemDetails;\n\t}\n\tsetShowItemDetails(show , onSuccess , onFailure){\n\t\tthis.settings.showItemDetails = show\n\t\tthis.db.updateSettings_callback(\n\t\t\tthis.settings,\n\t\t\t()=>{\n\t\t\t\t//saved\n\t\t\t\tonSuccess();\n\t\t\t\tconsole.log(\"settings update is save successfuly\")\n\t\t\t},()=>{\n\t\t\t\tconsole.error(\"error occured when trying to save settings\")\n\t\t\t}\n\t\t)\n\n\t}\n\n\n\tsetSettings( settings , onSuccess , onFailure){\n\t\tthis.settings  = settings\n\t\tthis.db.updateSettings_callback(\n\t\t\tthis.settings,\n\t\t\t()=>{\n\t\t\t\t//saved\n\t\t\t\tonSuccess();\n\t\t\t\tconsole.log(\"settings update is save successfuly\")\n\t\t\t},()=>{\n\t\t\t\tconsole.error(\"error occured when trying to save settings\")\n\t\t\t}\n\t\t)\n\n\t}\n\n\n}\n", "pos_ar.PointOfSale.posAppData = class {\n\n\tconstructor(\n\t\tdb,\n\t\tapiHandler\n\t){\n\t\tthis.db          = db;\n\t\tthis.api_handler = apiHandler;\n\n\t\tthis.since = localStorage.getItem('lastTime');\n\n\n\t\tthis.appData = {} ;\n\t}\n\n\n\tasync getAllData(){\n\t\ttry{\n\t\t\tfrappe.show_progress('Please Wait', 0, 12, 'loading deleted documents');\n\t\t\tawait this.getDeletedDocs()\n\t\t\tfrappe.show_progress('Please Wait', 1, 12, 'loading customers...');\n\t\t\tawait this.getCustomers();\n\t\t\tfrappe.show_progress('Please Wait', 2, 12, 'loading items...');\n\t\t\tawait this.getItems();\n\t\t\tfrappe.show_progress('Please Wait', 3, 12, 'loading pos profiles');\n\t\t\tawait this.getPosProfiles();\n\t\t\tfrappe.show_progress('Please Wait', 4, 12, 'loading mode of payment');\n\t\t\tawait this.getPosProfileModeOfPayments(this.appData.pos_profile)\n\t\t\tawait this.getBins();\n\t\t\tfrappe.show_progress('Please Wait', 5, 12, 'loading warehouses');\n\t\t\tawait this.getWarehouses();\n\t\t\tfrappe.show_progress('Please Wait', 6, 12, 'loading price lists');\n\t\t\tawait this.getPriceLists();\n\t\t\tfrappe.show_progress('Please Wait', 7, 12, 'loading item prices');\n\t\t\tawait this.getItemPrices();\n\t\t\tfrappe.show_progress('Please Wait', 8, 12, 'loading item groups');\n\t\t\tawait this.getItemGroups();\n\t\t\tfrappe.show_progress('Please Wait', 9, 12, 'loading invoices');\n\t\t\tawait this.getPosInvoices();\n\t\t\tfrappe.show_progress('Please Wait', 10, 12, 'loading check in out');\n\t\t\tawait this.getCheckInOuts();\n\t\t\tfrappe.show_progress('Please Wait', 11, 12, 'loading barcodes');\n\t\t\tawait this.getItemBarcodes()\n\t\t\tfrappe.show_progress('Please Wait', 12, 12, 'Completed');\n\t\t\tfrappe.hide_progress();\n\t\t\tfrappe.hide_progress();\n\t\t\tfrappe.hide_progress();\n\t\t\tfrappe.hide_progress();\n\n\t\t\tthis.since = frappe.datetime.now_datetime()\n\t\t\tlocalStorage.setItem('lastTime', frappe.datetime.now_datetime());\n\n\n\t\t\tconsole.log(\"app data : \" , this.appData)\n\t\t}catch(err){\n\t\t\tconsole.error(\"appData Class Error  : \" , err)\n\t\t\tfrappe.hide_progress();\n\t\t}\n\t\t\tfrappe.hide_progress();\n\n\n\t}\n\n\n\tasync getCustomers(){\n\t\t/*the function should combine the two the logic didnt complite yet we still working on it*/\n\t\t//get local\n\t\t//const localCustomers = await this.db.getAllCustomers();\n\t\tconst localCustomers = [];\n\t\t//get remote\n\t\tconst updatedCustomers = await this.api_handler.fetchCustomers(this.since)\n\t\t//save new customers\n\t\tawait this.db.saveCustomerList(updatedCustomers)\n\n\t\tthis.appData.customers = this.combineLocalAndUpdated(localCustomers,updatedCustomers)\n\n\t}\n\tasync getBrands(){\n\t\t//get local\n\t\t//get remote\n\t\tthis.appData.brands = await this.api_handler.fetchBrands(this.since)\n\t}\n\tasync getItems(){\n\t\t//get local\n\t\t//const localItems   = await this.db.getAllItems();\n\t\tconst localItems   = [];\n\t\t//get remote\n\t\tconst updatedItems = await this.api_handler.fetchItems(this.since)\n\t\tconsole.log(\"here is the items ::::: \" , updatedItems)\n\t\t\n\t\t//save new items\n\t\tawait this.db.saveItemList(updatedItems)\n\n\t\tthis.appData.items = this.combineLocalAndUpdated(localItems,updatedItems)\n\t}\n\tasync getPosProfiles(){\n\t\tthis.appData.pos_profile  =  await this.api_handler.fetchPosProfile(this.since)\n\t}\n\tasync getPosProfileModeOfPayments(posProfile){\n\t\tlet modeOfPaymentsIds = []\n\t\tposProfile.payments.forEach(modeId=>{\n\t\t\tmodeOfPaymentsIds.push(modeId.mode_of_payment)\n\t\t})\n\t\tthis.appData.posProfileModeOfPayments = await this.api_handler.fetchPosProfileModeOfPayments(modeOfPaymentsIds , posProfile.company)\n\t}\n\tasync getBins(){\n\t\t//get local\n\t\t//const localBins   = await this.db.getAllBin();\n\t\tconst localBins   = [];\n\t\t//get remote\n\t\tconst updatedBins = await this.api_handler.fetchBinList(this.since)\n\t\t//save new bins\n\t\tawait this.db.saveBinList(updatedBins)\n\n\t\tthis.appData.bins = this.combineLocalAndUpdated(localBins,updatedBins)\n\t}\n\tasync getWarehouses(){\n\t\t//get local\n\t\t//const localWarehouses   = await this.db.getAllWarehouse();\n\t\tconst localWarehouses   = [];\n\t\t//warehouse\n\t\tconst updatedWarehouses = await this.api_handler.fetchWarehouseList(this.since)\n\t\t//save new warehouse\n\t\tawait this.db.saveWarehouseList(updatedWarehouses);\n\t\tthis.appData.warehouses = this.combineLocalAndUpdated(localWarehouses,updatedWarehouses)\n\t}\n\tasync getPriceLists(){\n\t\t//get local\n\t\t//const localPriceLists  = await this.db.getAllPriceList();\n\t\tconst localPriceLists  = [];\n\t\t//get remote\n\t\tconst updatedPriceList = await this.api_handler.fetchPriceList(this.since)\n\t\t//save new price list\n\t\tawait this.db.savePriceLists(updatedPriceList)\n\n\t\tthis.appData.price_lists = this.combineLocalAndUpdated(localPriceLists,updatedPriceList)\n\t}\n\tasync getItemPrices(){\n\t\t//get local\n\t\t//const localItemPrices = await this.db.getAllItemPrice();\n\t\tconst localItemPrices = [];\n\t\t//get remote\n\t\tconst updateItemPrices = await this.api_handler.fetchItemPrice(this.since)\n\t\tawait this.db.saveItemPriceList(updateItemPrices);\n\n\t\tthis.appData.item_prices = this.combineLocalAndUpdated(localItemPrices,updateItemPrices)\n\t\tconsole.log()\n\t}\n\tasync getItemGroups(){\n\t\t//get local\n\t\t//const localItemGroups = await this.db.getAllItemGroup();\n\t\tconst localItemGroups = [];\n\t\t//get remote\n\t\tconst updatedItemGroups = await this.api_handler.fetchItemGroups(this.since)\n\t\tawait this.db.saveItemGroupList(updatedItemGroups)\n\n\t\tthis.appData.item_groups = this.combineLocalAndUpdated(localItemGroups,updatedItemGroups)\n\t}\n\tasync getItemBarcodes(){\n\t\tthis.appData.item_barcodes = await this.api_handler.fetchItemBarCodes()\n\t}\n\tasync getPosInvoices(){\n\t\t//get local\n\t\tthis.appData.pos_invoices = await this.db.getAllPosInvoice();\n\t}\n\tasync getCheckInOuts(){\n\t\t//get local\n\t\tthis.appData.check_in_outs = await this.db.getAllCheckInOut();\n\t}\n\n\tasync getDeletedDocs(){\n\t\t//get local\n\t\tthis.appData.deleted_documents = await this.api_handler.fetchDeletedDocs(this.since);\n\t}\n\n\n\n\tsaveCheckInOut(checkInOut,onSuccess,onFailure){\n\t\tthis.db.saveCheckInOut(checkInOut,onSuccess,onFailure)\n\t}\n\tsavePosInvoice(posInvoice){\n\t\tthis.db.savePosInvoice(posInvoice)\n\t}\n\tupdatePosInvoice(posInvoice){\n\t\tthis.db.updatePosInvoice(posInvoice)\n\t}\n\tgetNotSyncedPos(onSuccess,onFailure){\n\t\tthis.db.getNotSyncedPos(\n\t\t\t(res)=>{\n\t\t\t\tonSuccess(res)\n\t\t\t},(err)=>{\n\t\t\t\tonFailure(err)\n\t\t\t}\n\t\t)\n\t}\n\tgetNotSyncedPosNumber(onSuccess,onFailure){\n\t\tthis.db.getNotSyncedPosNumber(\n\t\t\t(res)=>{\n\t\t\t\tonSuccess(res)\n\t\t\t},(err)=>{\n\t\t\t\tonFailure(err)\n\t\t\t}\n\t\t)\n\t}\n\n\n\tasync fetchDebts(customerName){\n\t\treturn await this.api_handler.fetchDebts(customerName)\n\t}\n\tasync fetchDebtsSalesInvoices(customerName){\n\t\treturn await this.api_handler.fetchDebtsSalesInvoices(customerName)\n\t}\n\n\n\n\tasync fetchCustomerDebt( customerName){\n\t\treturn await this.api_handler.fetchCustomerDebt( customerName )\n\t}\n\n\tasync update_invoice_payment(invoiceName , amount){\n\n\t\tconst rest = await this.api_handler.update_invoice_payment( invoiceName , amount)\n\n\n\t\tawait this.getPosInvoices()\n\n\t\tthis.appData.pos_invoices.forEach(invoice=>{\n\t\t\tif(invoice.real_name == invoiceName){\n\t\t\t\tlet newInvoice = structuredClone(invoice)\n\t\t\t\tnewInvoice.outstanding_amount = rest.outstanding_amount\n\t\t\t\tnewInvoice.paid_amount        = rest.paid_amount\n\t\t\t\tnewInvoice.status             = rest.paid\n\t\t\t\tnewInvoice.real_name          = rest.real_name\n\t\t\t\tthis.db.updatePosInvoice(newInvoice)\n\t\t\t}\n\t\t})\n\n\t\treturn rest\n\t}\n\tasync update_sales_invoice_payment(invoiceName , amount){\n\n\t\tconst rest = await this.api_handler.update_sales_invoice_payment( invoiceName , amount)\n\n\n\t\trest.invoices.forEach(invoice=>{\n\t\t\tthis.appData.pos_invoices.forEach(posInvoice=>{\n\t\t\t\tif(posInvoice.real_name == invoice.name){\n\t\t\t\t\tposInvoice.consolidated_invoice = invoiceName\n\t\t\t\t\tposInvoice.start_paying         = true\n\t\t\t\t\tif(rest.status == \"Paid\"){\n\t\t\t\t\t\tposInvoice.outstanding_amount = 0\n\t\t\t\t\t\tposInvoice.paid_amount        = invoice.total\n\t\t\t\t\t\tposInvoice.grand_paid_amount  = invoice.total\n\t\t\t\t\t\tposInvoice.status             = 'Paid'\n\t\t\t\t\t}\n\t\t\t\t\tthis.db.updatePosInvoice(posInvoice)\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\n\t\t//update related data\n\t\tawait this.getPosInvoices()\n\n\t\treturn rest\n\t}\n\n\tasync paySelectedInvoice(invoices , amount){\n\t\tconst rest = await this.api_handler.pay_selected_invoice( invoices , amount)\n\n\t\trest.invoices_state_collection.forEach(invoices_status =>{\n\t\t\tinvoices_status.invoices.forEach(invoice=>{\n\t\t\t\tthis.appData.pos_invoices.forEach(posInvoice=>{\n\t\t\t\t\tif(posInvoice.real_name == invoice.name){\n\t\t\t\t\t\tposInvoice.consolidated_invoice = invoices_status.sales_invoice_name\n\t\t\t\t\t\tposInvoice.start_paying         = true\n\t\t\t\t\t\tif(invoices_status.status == \"Paid\"){\n\t\t\t\t\t\t\tposInvoice.outstanding_amount = 0\n\t\t\t\t\t\t\tposInvoice.paid_amount        = invoice.total\n\t\t\t\t\t\t\tposInvoice.grand_paid_amount  = invoice.total\n\t\t\t\t\t\t\tposInvoice.status             = 'Paid'\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.db.updatePosInvoice(posInvoice)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\n\t\treturn rest\n\t}\n\n\tasync getAllOpenedPosInvoice(){\n\t\treturn await this.db.getAllOpenedPosInvoice()\n\t}\n\n\tasync deletePosInvoice_callback(invoiceName,onSuccess,onFailure){\n\t\tthis.db.deletePosInvoice_callback(\n\t\t\tinvoiceName,\n\t\t\tonSuccess,\n\t\t\tonFailure\n\t\t)\n\t}\n\t/******************  function ***************************/\n\tcombineLocalAndUpdated(local,updated){\n\t\t// Create a map from the local data array using a unique identifier (name)\n\t\tconst combinedMap = new Map(local.map(item => [item.name, item]));\n\t\t// Loop through each item in the updated data\n\t\tthis.appData.deleted_documents.forEach(deleted=>{\n\t\t\tcombinedMap.delete( deleted.name )\n\t\t})\n\t\tupdated.forEach(updatedItem=>{\n\t\t\tcombinedMap.set(updatedItem.name , updatedItem)\n\t\t})\n\n\t\treturn Array.from(combinedMap.values())\n\t}\n\n}\n", "pos_ar.PointOfSale.FetchHandler = class FetchHandler{\n\n\tconstructor(){\n\n\t\tconsole.log(\"testing4\")\n\t}\n\n\n\tasync fetchCustomers(since) {\n\t\ttry {\n\t\t\tconst filter = { disabled : 0}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Customer', {\n                fields: ['name' , 'customer_name' , 'custom_debt' , 'default_price_list' ],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000,\n\t\t\t\torder_by : \"customer_name ASC\"\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching customers:', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\tasync fetchStockBalance(since ) {\n\t\ttry {\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n/*\t\t\tconst profile = await frappe.db.get_list('POS Profile' , {\n\t\t\t\tfields  : ['name' , 'warehouse'],\n\t\t\t\tfilters : {disabled : 0 , name : frappe.defaults.get_default(\"POS Profile\")},\n\t\t\t\tlimit   : 1\n\t\t\t})\n\n\t\t\tconst filter = { 'warehouse' : profile[0].warehouse }\n\n\t\t\tconsole.log(\"warehouse ::::: profile :::::\" , profile)\n*/\t\t\t\n\t\t\treturn await frappe.db.get_list('Stock Ledger Entry' , {\n\t\t\t\tfields : ['*'],\n\t\t\t\tlimit : 100000\n\t\t\t}) \n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching stock balance:', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\n\tasync fetchBrands(since) {\n\t\ttry {\n\t\t\tconst filter = {}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Brand', {\n\t\t\t\tfields: ['brand' ],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching customers:', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\tasync fetchItemGroups(since) {\n\t\ttry {\n\t\t\tconst filter = {}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Item Group', {\n\t\t\t\tfields: ['name', 'item_group_name' , 'parent_item_group' , 'is_group' ],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000,\n\t\t\t\torder_by: 'item_group_name ASC',\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Group :', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\n\tasync fetchItems(since) {\n\t\ttry {\n\t\t\tconst filter = {disabled : 0}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Item', {\n\t\t\t\tfields: ['name', 'item_name' , 'image' , 'brand' ,'item_group' , 'description' , 'stock_uom'   ],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000,\n\t\t\t\torder_by: 'item_name ASC',\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Group :', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\n\n\tasync fetchItemBarCodes() {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_item_barcodes',\n\t\t\t\targs: { }\n\t\t\t});\n\t\t\treturn response.message;  // The fetched item barcodes\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Barcodes:', error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\n\tasync fetchStockQty() {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_stock_availability',\n\t\t\t\targs: { }\n\t\t\t});\n\t\t\treturn response.message;  // The fetched item barcodes\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Barcodes:', error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\n\tasync fetchCustomerDebt( name ) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_customer_debt',\n\t\t\t\targs: { name }\n\t\t\t});\n\t\t\treturn response.message;  // The fetched item barcodes\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Barcodes:', error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\n\n\tasync fetchItemPrice(since) {\n\t\ttry {\n\t\t\tconst filter = {}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Item Price', {\n\t\t\t\tfields: ['name', 'item_code' , 'item_name' , 'price_list', 'price_list_rate' , 'brand'],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Group :', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\n\tasync fetchPriceList(since) {\n\t\ttry {\n\t\t\tconst filter = {selling : 1 , enabled : 1}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Price List', {\n\t\t\t\tfields: ['name', 'price_list_name' , 'currency' ],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching Item Group :', error);\n\t\t\treturn []\n\t\t}\n\t}\n\n\n\tasync fetchWarehouseList(since){\n\t\ttry{\n\t\t\tconst filter = {}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Warehouse' , {\n\t\t\t\tfields  : ['name' , 'warehouse_name'],\n\t\t\t\tfilters : filter,\n\t\t\t\tlimit : 100000\n\t\t\t})\n\t\t}\n\t\tcatch(error){\n\t\t\tconsole.error('Error fetching Warehouse list : ' , error)\n\t\t\treturn [];\n\t\t}\n\t}\n\n\n\tasync fetchPosProfile(){\n\t\ttry{\n\t\t\tconst filter = {disabled : 0}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\tconst pos = await frappe.db.get_list('POS Profile' , {\n\t\t\t\tfields  : ['name'],\n\t\t\t\tfilters : filter ,\n\t\t\t\tlimit   : 1\n\t\t\t})\n\t\t\tconst r = await frappe.db.get_doc('POS Profile', pos[0].name  )\n\t\t\treturn r\n\t\t}\n\t\tcatch(error){\n\t\t\tconsole.error('Error fetching pos profile list : ' , error)\n\t\t\treturn null;\n\t\t}\n\t}\n\n\n\n\tasync fetchPosProfileModeOfPayments(modeOfPaymentsIds , company) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: 'pos_ar.pos_ar.doctype.pos_info.pos_info.get_mode_of_payments',\n\t\t\t\targs: { }\n\t\t\t});\n\t\t\treturn response.message;  // The fetched item barcodes\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching mode_of_payments', error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\n\n\n\tasync fetchCompany(companyId){\n\t\ttry{\n\t\t\treturn await frappe.db.get_doc('Company' , companyId)\n\t\t}\n\t\tcatch(error){\n\t\t\tconsole.error('Error fetching company by companyId from the profile list : ' , error)\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync fetchSalesTaxesAndChargesTemplate(templateId){\n\t\ttry{\n\t\t\treturn await frappe.db.get_doc('Sales Taxes and Charges Template' , templateId)\n\t\t}\n\t\tcatch(error){\n\t\t\tconsole.error('Error fetching Warehouse list : ' , error)\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync fetchBinList(since){\n\t\ttry{\n\t\t\tconst filter = {}\n\t\t\t/*if(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}*/\n\t\t\treturn await frappe.db.get_list('Bin' , {\n\t\t\t\tfields  : ['name' , 'actual_qty' , 'item_code' , 'warehouse'],\n\t\t\t\tfilters : filter,\n\t\t\t\tlimit   : 1\n\t\t\t})\n\t\t}\n\t\tcatch(error){\n\t\t\tconsole.error('Error fetching Bin list : ' , error)\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tasync fetchDeletedDocs(since) {\n\t\ttry {\n\t\t\tconst filter = {}\n\t\t\tif(since){\n\t\t\t\tfilter.modified = ['>',since]\n\t\t\t}\n\t\t\treturn await frappe.db.get_list('Deleted Document', {\n\t\t\t\tfields: ['name', 'deleted_name'  ,'deleted_doctype' , 'restored' ],\n\t\t\t\tfilters: filter,\n\t\t\t\tlimit : 100000\n\t\t\t})\n\t\t} catch (error) {\n\t\t\tconsole.error('Error fetching deleted documents :', error);\n\t\t\treturn []\n\t\t}\n\t\treturn []\n\t}\n\n\n\tasync fetchDebts(customer_name) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: \"pos_ar.pos_ar.doctype.pos_info.pos_info.get_customer_debts\",\n\t\t\t\targs: { customer_name },\n\t\t\t});\n\n\t\t\tif (response.message && !response.message.error) {\n\t\t\t\treturn response.message\n\t\t\t} else {\n\t\t\t\treturn []\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching debts:\", error);\n\t\t\tfrappe.msgprint(__('Error fetching debts.'));\n\t\t}\n\t}\n\n\tasync fetchDebtsSalesInvoices(customer_name) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: \"pos_ar.pos_ar.doctype.pos_info.pos_info.get_customer_debts_sales_invoices\",\n\t\t\t\targs: { customer_name },\n\t\t\t});\n\n\t\t\tif (response.message && !response.message.error) {\n\t\t\t\tconsole.log(\"customer debts : \" , response.message)\n\t\t\t\treturn response.message\n\t\t\t} else {\n\t\t\t\treturn []\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching debts:\", error);\n\t\t\tfrappe.msgprint(__('Error fetching debts.'));\n\t\t}\n\t}\n\n\n\n\n\tasync update_invoice_payment(invoice_name , payment_amount) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: \"pos_ar.pos_ar.doctype.pos_info.pos_info.update_invoice_payment\",\n\t\t\t\targs: { invoice_name , payment_amount },\n\t\t\t});\n\t\t\tif (response.message && !response.message.error) {\n\t\t\t\treturn response.message\n\t\t\t} else {\n\t\t\t\treturn []\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching debts:\", error);\n\t\t\tfrappe.msgprint(__('Error fetching debts.'));\n\t\t}\n\t}\n\n\n\tasync update_sales_invoice_payment(invoice_name , payment_amount) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: \"pos_ar.pos_ar.doctype.pos_info.pos_info.update_sales_invoice_payment\",\n\t\t\t\targs: { invoice_name , payment_amount },\n\t\t\t});\n\t\t\tif (response.message && !response.message.error) {\n\t\t\t\treturn response.message\n\t\t\t} else {\n\t\t\t\treturn []\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching debts:\", error);\n\t\t\tfrappe.msgprint(__('Error fetching debts.'));\n\t\t}\n\t}\n\n\tasync pay_selected_invoice(invoices , payment_amount) {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: \"pos_ar.pos_ar.doctype.pos_info.pos_info.pay_selected_invoice\",\n\t\t\t\targs: { invoices , payment_amount },\n\t\t\t});\n\t\t\tif (response.message && !response.message.error) {\n\t\t\t\treturn response.message\n\t\t\t} else {\n\t\t\t\treturn []\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching debts:\", error);\n\t\t\tfrappe.msgprint(__('Error fetching debts.'));\n\t\t}\n\t}\n\n\n}\n", "pos_ar.PointOfSale.ScreenManager  = class {\n\n    constructor(settings_data) {\n\t\tthis.settings_data = settings_data;\n\n        this.screens = new Map();\n        this.activeScreen = null;\n    }\n\n    registerScreen(screenId, screenComponent) {\n        this.screens.set(screenId, screenComponent);\n    }\n\n    navigate(screenId) {\n        console.log(\"debuging 1 \" , screenId)\n\n        switch (screenId) {\n            case 'history_cart':\n                console.log(\"history_cart\")\n                //show\n\t\t\t    this.history_cart.show_cart()\n                this.customer_box.showHomeBar();\n                //hide\n\t\t\t    this.payment_cart.hideCart();\n\t\t\t    this.item_details.hide_cart();\n                this.item_selector.hideCart();\n                this.selected_item_cart.hideCart();\n\t\t\t    this.customer_box.hideSyncBar();\n                this.settings_cart.hideCart();\n\t\t\t    this.check_in_out_cart.hideCart();\n                this.debt_cart.hideCart();\n                this.unsynced_pos_cart.hide_cart();\n                break;\n            case 'settings_cart':\n                //show settings\n\t\t\t    this.settings_cart.showCart()\n    \t\t\tthis.customer_box.showHomeBar();\n\t    \t\t//hide\n\t\t    \tthis.item_selector.hideCart();\n\t\t\t    this.selected_item_cart.hideCart();\n    \t\t\tthis.item_details.hide_cart() ;\n\t    \t\tthis.payment_cart.hideCart()  ;\n\t\t    \tthis.history_cart.hide_cart() ;\n                this.check_in_out_cart.hideCart();\n    \t\t\tthis.debt_cart.hideCart();\n                this.unsynced_pos_cart.hide_cart();\n                //hide section\n                this.customer_box.hideSyncBar();\n                break;\n            case 'check_in_out_cart':\n                //show\n                this.check_in_out_cart.showCart();\n                this.customer_box.showHomeBar();\n\n                //hide\n                this.item_selector.hideCart();\n                this.selected_item_cart.hideCart();\n    \t\t\tthis.item_details.hide_cart() ;\n\t    \t\tthis.payment_cart.hideCart()  ;\n\t\t    \tthis.history_cart.hide_cart() ;\n\t\t\t    this.settings_cart.hideCart() ;\n                this.debt_cart.hideCart();\n                this.unsynced_pos_cart.hide_cart();\n\n                //hide section\n                this.customer_box.hideSyncBar();\n                break;\n            case 'home':\n                //show\n\t\t        this.item_selector.showCart()      ;\n\t\t        this.customer_box.showSyncBar()    ;\n        \t\tthis.selected_item_cart.showCart() ;\n\n\t     \t    //hide\n    \t    \tthis.payment_cart.hideCart()   ;\n        \t\tthis.customer_box.hideHomeBar();\n    \t    \tthis.item_details.hide_cart()  ;\n\t    \t    this.history_cart.hide_cart()  ;\n    \t\t    this.settings_cart.hideCart()  ;\n    \t    \tthis.debt_cart.hideCart();\n\t    \t    this.check_in_out_cart.hideCart();\n\t\t\t\tif(this.settings_data.settings.showItemDetails){\n\t\t\t\t\tthis.selected_item_cart.hideKeyboard();\n\t\t\t\t}\n                this.unsynced_pos_cart.hide_cart();\n\n\t\t\t\t//update ui\n\t\t\t\tthis.selected_item_cart.setKeyboardOrientation(\"portrait\");\n\t\t\t\tthis.selected_item_cart.cleanHeighlight();\n\n\t\t\t\t//refresh the data :\n\t\t\t\tthis.selected_item_cart.refreshTabs()\n\t\t\t\tthis.selected_item_cart.refreshSelectedItem()\n\n                break;\n\t\t\tcase 'debt_cart':\n                //show\n                this.debt_cart.showCart();\n                this.customer_box.showHomeBar();\n\n                //hide\n                this.item_selector.hideCart();\n                this.selected_item_cart.hideCart();\n                this.item_details.hide_cart();\n                this.history_cart.hide_cart();\n                this.settings_cart.hideCart();\n\t\t\t\tthis.payment_cart.hideCart();\n                this.check_in_out_cart.hideCart();\n                this.unsynced_pos_cart.hide_cart();\n                break;\n\t\t\tcase 'payment_cart':\n                //show\n\t\t\t\tthis.payment_cart.showCart();\n                //hide\n                this.item_selector.hideCart();\n                this.item_details.hide_cart();\n                this.settings_cart.hideCart();\n                this.debt_cart.hideCart();\n\t\t\t\t//change displayk\n\t\t\t\tthis.payment_cart.calculateGrandTotal()\n                this.selected_item_cart.setKeyboardOrientation(\"landscape\");\n                this.selected_item_cart.cleanHeighlight();\n                this.selected_item_cart.showKeyboard();\n                this.unsynced_pos_cart.hide_cart();\n                break;\n\t\t\tcase 'item_details':\n\t\t\t\t//show details depend on settings\n\t\t\t\tif(this.settings_data.settings.showItemDetails){\n\t\t\t\t\tthis.item_details.show_cart();\n                this.item_selector.hideCart();\n\t\t\t\t\tthis.selected_item_cart.showKeyboard();\n\t\t\t\t\t//close\n\t\t\t\t\tthis.payment_cart.hideCart();\n                this.settings_cart.hideCart();\n                this.unsynced_pos_cart.hide_cart();\n\n                //change display\n                this.selected_item_cart.setKeyboardOrientation(\"landscape\");\n\t\t\t\t}\n\n                this.selected_item_cart.makeSelectedButtonHighlighted();\n\n                break;\n            case 'unsynced_pos_cart':\n                //show\n                this.unsynced_pos_cart.show_cart();\n    \t\t\tthis.customer_box.showHomeBar();\n                //hide\n                this.history_cart.hide_cart()      ;\n                this.check_in_out_cart.hideCart()  ;\n\t\t\t\tthis.item_selector.hideCart()      ;\n\t\t        this.customer_box.hideSyncBar()    ;\n        \t\tthis.selected_item_cart.hideCart() ;\n\t\t\t\tthis.payment_cart.hideCart();\n                this.item_selector.hideCart();\n                this.item_details.hide_cart();\n                this.settings_cart.hideCart();\n                this.debt_cart.hideCart();\n\t\t\t\t//change displayk\n\t\t\t\tthis.payment_cart.calculateGrandTotal()\n\t\t\t\tthis.selected_item_cart.setKeyboardOrientation(\"landscape\");\n\t\t\t\tthis.selected_item_cart.cleanHeighlight();\n\t\t\t\tthis.selected_item_cart.showKeyboard();\n\t\n                break;\n            default:\n                break;\n        }\n\n        // Hide all screens first\n        //this.screens.forEach(screen => screen.hideCart());\n        \n        // Show the requested screen\n        //const targetScreen = this.screens.get(screenId);\n        //if (targetScreen) {\n        //    targetScreen.showCart();\n        //    this.activeScreen = screenId;\n        //}\n    }\n}"],
  "mappings": "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",
  "names": ["wrapper", "container", "topBar", "leftSection", "centerSection", "filterContainer", "companyWrapper", "posOpeningWrapper", "brandWrapper", "brandInputWrapper", "clearBtn", "newValue", "response", "company", "rightSection", "listContainer", "headerRow", "amount", "entry", "loadingSpinner", "err", "items", "grandTotal", "itemName", "item", "dataArray", "key", "value", "totalRecords", "totalQty", "sum", "totalCost", "wb", "ws", "lastRowIndex", "wbout", "blob", "url", "a", "wrapper", "e", "screen", "company", "$button", "brand", "priceList", "prices", "uniquePrices", "p", "d", "price", "values", "r", "itemName", "response", "companies", "$companyFilter", "result", "data", "error", "priceLists", "brands", "$pricingScreen", "savedOrder", "a", "b", "aIndex", "bIndex", "pl", "item", "key", "$content", "priceData", "hasDifferentPrices", "allPricesForBrand", "plist", "currentPrice", "priceClass", "max", "min", "threshold", "style", "$fixingScreen", "self", "searchTerm", "$row", "text", "filterValues", "visible", "filter", "cellText", "currentSort", "column", "columnIndex", "rows", "aVal", "bVal", "$headers", "draggedHeader", "_", "header", "$allHeaders", "draggedIndex", "dropIndex", "row", "$cells", "$draggedCell", "$dropCell", "draggedHtml", "dropHtml", "draggedData", "dropData", "currentOrder", "draggedPriceList", "dropPriceList", "newOrder", "baseIndex", "items", "item_code", "itemPriceName", "doc", "$editButton", "$priceCell", "formattedPrice", "err", "csvContent", "data_price", "pd", "encodedUri", "link", "company", "response", "error", "wrapper", "record", "openedPos", "err", "priceList", "new_pos_invoice", "date", "year", "month", "day", "hour", "minutes", "seconds", "user", "posProfile", "dialog", "profile", "response", "r", "error", "me", "denominations", "default_company", "default_pos_profile", "default_payment_method", "fetch_default_payment_method", "payments", "default_method", "pay", "denomination_fields", "total", "sum", "row", "denom", "total_amount", "balance_details", "method", "res", "e", "grid", "doc", "value", "pos", "item", "tab", "action", "key", "event", "field", "invoice", "refresh", "itemCloned", "clonedItem", "checkInOut", "settingName", "saveWithZeroRate", "menu", "result", "posInvoices", "counter", "message", "returnedPosInvoice", "oldRate", "persont", "montant", "persent", "_a", "_b", "newValue", "input", "discount_percentage", "newRate", "oldValue", "lastValue", "items", "is_return", "newItem", "status", "tabs", "failure", "allUnsyncedPos", "updatedPos", "customerId", "customer", "netTotal", "grandTotal", "allTaxes", "discount", "tax", "voucher", "check", "child", "posInvoice", "new_name", "newItems", "active", "activeElement", "mode", "price", "itemPrice", "reg", "clickedItem", "posItems", "exist", "clone", "itemId", "itemName", "qty", "rate", "discountPercentage", "discountAmount", "paidAmountDA", "wrapper", "item_list", "itemBarcodes", "item_group_list", "item_prices", "settingsData", "selectedPriceList", "getItemPrice", "autoSelect", "onItemClick", "barcode", "groupItemList_html", "group_item", "option", "seachField", "groupItemListInput", "filtered_item_list", "itemsContainer_html", "itemInput", "item", "itemBox", "event", "isNotImpty", "imageUrl", "price", "even", "value", "itemIds", "items", "item_group", "groups", "getChild", "grp", "g", "filtredItemList", "getFiltredItems", "group", "wrapper", "customersList", "selectedCustomer", "backHome", "onSync", "saveCheckInOut", "onMenuClick", "onDebtClick", "onPrintPos", "r", "style", "me", "popover", "toggleButton", "cancelBtn", "confirmBtn", "response", "invoices", "content", "searchBox", "renderInvoices", "filteredInvoices", "html", "invoice", "btn", "e", "invoiceName", "inv", "searchTerm", "event", "checkInOut", "counter", "wrapper", "settingsData", "selectedItemMaps", "priceLists", "customerList", "brandList", "salesTaxes", "invoiceData", "selectedTab", "selectedItem", "selectedField", "getItemPrice", "onSelectedItemClick", "onTabClick", "onKeyPressed", "createNewTab", "onCheckoutClick", "savePosInvoice", "db", "containerBoxStyle", "containerStyle", "btnStyle", "checkoutBtn", "tax", "taxContainer", "event", "priceList", "customer", "key", "clickedTab", "invoiceItems", "selectedItemsContainer", "item", "itemElement", "leftGroup", "rightGroup", "itemName", "itemQuantity", "itemPrice", "itemImage", "itemImageHolder", "itemImageLatter", "pos", "orientation", "discount", "quantity", "netTotal", "grandTotal", "quantityButton", "rateButton", "minusButton", "key_0", "key_1", "key_2", "key_3", "key_4", "key_5", "key_6", "key_7", "key_8", "key_9", "key_quantity", "key_minus", "key_rate", "key_remove", "key_delete", "key_point", "keyContent", "customerId", "netTotal_HTML", "saleTaxAmount", "taxPercentage", "calculatedTax", "tax_HTML", "result", "totalQuantity_HTML", "taxAmount", "grandTotal_HTML", "wrapper", "warehouse", "priceLists", "itemPrices", "binList", "selectedItem", "selectedField", "onInput", "onClose", "event", "item", "_a", "_b", "imageContainer", "name", "itemGroup", "quantity", "rate", "discountedRate", "discount_percentage", "discount_amount", "available", "uom", "priceList", "priceListRate", "image", "field", "value", "index", "currentValue", "newValue", "cursor", "newQuantity", "newRate", "newDiscount", "itemId", "price", "itemPrice", "warehouseId", "bin", "wrapper", "selectedItemMap", "selectedTab", "appData", "paymentMethods", "selectedPaymentMythod", "invoiceData", "onClose", "onComplete", "onInput", "event", "method", "selected", "amountField", "selectedBox", "mode", "me", "clickedId", "inputValue", "boxId", "key", "cashField", "newValue", "cursor", "index", "currentValue", "paidAmountDA", "id", "r", "wrapper", "db", "selectedPosProfile", "appData", "appSettings", "company", "salesTaxes", "onClick", "result", "pos", "record", "posContainer", "l1", "posName", "posCost", "consolidatedFlag", "l2", "customer", "customerLogo", "customerName", "creationTime", "_a", "_b", "_c", "item", "netTotal", "allTax", "tax", "payments", "method", "filter", "error", "event", "search", "matchesCustomer", "matchesRefNum", "matchesName", "matchesAll", "totals", "formatNumber", "num", "ancien_sold", "creation_time", "date", "time", "receiptHTML", "itemTotal", "discount", "printWindow", "db", "resolve", "reject", "request", "event", "posInvoiceStore", "checkInOutStore", "_a", "store", "itemList", "transaction", "item", "err", "result", "value", "posProfileList", "posProfile", "binList", "bin", "warehouseList", "warehouse", "priceLists", "priceList", "itemPriceList", "itemPrice", "itemGroupList", "itemGroup", "customerList", "customer", "posInvoice", "dateIndex", "invoices", "cursor", "pos", "onSuccess", "onFailure", "filtredResult", "invoice", "invoiceName", "checkInOut", "checks", "date", "records", "updatePromises", "record", "resolveUpdate", "rejectUpdate", "updateRequest", "updatedCount", "totalToUpdate", "settings", "__spreadValues", "wrapper", "settingsData", "selectedPosProfile", "onSettingsChange", "priceBase", "showItemDetailsCart", "showItemImage", "showDiscountField", "searchByGroup", "onlineDebt", "sendInvoiceToOtherPos", "keyboardStyle", "base", "style", "event", "tabs", "all_content", "tab", "index", "wrapper", "db", "header", "details", "item", "checkInOut", "checkInOutObject", "type_div", "type_img", "type_value_div", "creationTimeDiv", "amountDiv", "inAmount", "outAmount", "allAmount", "event", "res", "err", "wrapper", "appData", "refreshCheckInOut", "customer", "customerElement", "event", "value", "checkbox", "invoiceName", "invoiceOutstandingAmount", "invoiceType", "invoice_data", "invoice", "index", "total_debt", "partially_paid", "invoiceStyle", "payBtnStyle", "result", "result2", "customerBox", "paymentAmount", "error", "check_in_amount", "checkInOut", "res", "err", "wrapper", "appData", "db", "viewDetailsCallback", "onDeleteCallback", "header", "invoice", "filteredList", "invoiceContainer", "l1", "posName", "posCost", "l2", "customer", "customerLogo", "customerName", "status", "deleteBtn", "e", "err", "inv", "item", "itemRow", "itemName", "itemQty", "itemRate", "itemAmount", "totalRow", "totalLabel", "totalAmount", "payment", "paymentRow", "paymentMode", "paymentAmount", "r", "updatedPos", "invoice_name", "error", "db", "defaults", "res", "__spreadValues", "err", "base", "onSuccess", "onFailure", "show", "settings", "db", "apiHandler", "err", "localCustomers", "updatedCustomers", "localItems", "updatedItems", "posProfile", "modeOfPaymentsIds", "modeId", "localBins", "updatedBins", "localWarehouses", "updatedWarehouses", "localPriceLists", "updatedPriceList", "localItemPrices", "updateItemPrices", "localItemGroups", "updatedItemGroups", "checkInOut", "onSuccess", "onFailure", "posInvoice", "res", "customerName", "invoiceName", "amount", "rest", "invoice", "newInvoice", "invoices", "invoices_status", "local", "updated", "combinedMap", "item", "deleted", "updatedItem", "since", "filter", "error", "name", "pos", "modeOfPaymentsIds", "company", "companyId", "templateId", "customer_name", "response", "invoice_name", "payment_amount", "invoices", "settings_data", "screenId", "screenComponent"]
}
